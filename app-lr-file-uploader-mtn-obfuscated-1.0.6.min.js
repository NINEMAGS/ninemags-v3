/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2022 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
var Cs=Object.defineProperty;var Qr=(s,e,t)=>e in s?Cs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var to=(s,e)=>{for(var t in e)Cs(s,t,{get:e[t],enumerable:!0})};var d=(s,e,t)=>(Qr(s,typeof e!="symbol"?e+"":e,t),t);var Es="UploadCareLocalSettings",st=s=>window[s],As={CIRCLE:"circle",SQUARE:"square"},ue=25e6;var gs={};to(gs,{ActivityBlock:()=>b,ActivityHeader:()=>Ri,BaseComponent:()=>kt,Block:()=>_,CameraSource:()=>Le,CloudImageEditor:()=>$i,CloudImageEditorActivity:()=>ki,CloudImageEditorBlock:()=>et,Config:()=>wr,ConfirmationDialog:()=>Ie,Copyright:()=>We,CropFrame:()=>Ue,Data:()=>w,DataOutput:()=>fs,DropArea:()=>Yt,EditorCropButtonControl:()=>se,EditorFilterControl:()=>Mt,EditorImageCropper:()=>Fe,EditorImageFader:()=>Si,EditorOperationControl:()=>re,EditorScroller:()=>Be,EditorSlider:()=>De,EditorToolbar:()=>Ve,EndScreen:()=>xe,ExternalSource:()=>Xe,FileItem:()=>Jt,FilePreview:()=>ie,FileUploaderInline:()=>Je,FileUploaderMinimal:()=>Ze,FileUploaderRegular:()=>Dt,Icon:()=>Xt,Img:()=>Ti,LineLoaderUi:()=>ze,LrBtnUi:()=>ne,MessageBox:()=>Te,Modal:()=>te,MtnAcceptScreen:()=>Ye,MtnFileItem:()=>qe,PACKAGE_NAME:()=>is,PACKAGE_VERSION:()=>ss,PresenceToggle:()=>He,ProgressBar:()=>$e,ProgressBarCommon:()=>Re,Select:()=>je,ShadowWrapper:()=>ce,SimpleBtn:()=>Wt,SliderUi:()=>Ge,SourceBtn:()=>Zt,SourceList:()=>Oi,StartFrom:()=>Ae,Tabs:()=>ae,UploadCtxProvider:()=>Mr,UploadDetails:()=>ke,UploadList:()=>Oe,UploaderBlock:()=>E,UrlSource:()=>Se,Video:()=>le,connectBlocksFrom:()=>Zr,registerBlocks:()=>de,shadowed:()=>Ke,toKebabCase:()=>rt});function xs(s){return Object.prototype.toString.call(s)==="[object Object]"}var eo=/\W|_/g;function io(s){return s.split(eo).map((e,t)=>e.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+e.slice(1)).join("")}function ws(s,{ignoreKeys:e}={ignoreKeys:[]}){return Array.isArray(s)?s.map(t=>pt(t,{ignoreKeys:e})):s}function pt(s,{ignoreKeys:e}={ignoreKeys:[]}){if(Array.isArray(s))return ws(s,{ignoreKeys:e});if(!xs(s))return s;let t={};for(let i of Object.keys(s)){let r=s[i];if(e.includes(i)){t[i]=r;continue}xs(r)?r=pt(r,{ignoreKeys:e}):Array.isArray(r)&&(r=ws(r,{ignoreKeys:e})),t[io(i)]=r}return t}var so=s=>new Promise(e=>setTimeout(e,s));function Vi({libraryName:s,libraryVersion:e,userAgent:t,publicKey:i="",integration:r=""}){let o="JavaScript";if(typeof t=="string")return t;if(typeof t=="function")return t({publicKey:i,libraryName:s,libraryVersion:e,languageName:o,integration:r});let n=[s,e,i].filter(Boolean).join("/"),a=[o,r].filter(Boolean).join("; ");return`${n} (${a})`}var ro={factor:2,time:100};function oo(s,e=ro){let t=0;function i(r){let o=Math.round(e.time*e.factor**t);return r({attempt:t,retry:a=>so(a??o).then(()=>(t+=1,i(r)))})}return i(s)}var Qe=class s extends Error{constructor(t){super();d(this,"originalProgressEvent");this.name="UploadcareNetworkError",this.message="Network error",Object.setPrototypeOf(this,s.prototype),this.originalProgressEvent=t}},ei=(s,e)=>{s&&(s.aborted?Promise.resolve().then(e):s.addEventListener("abort",()=>e(),{once:!0}))},Nt=class s extends Error{constructor(t="Request canceled"){super(t);d(this,"isCancel",!0);Object.setPrototypeOf(this,s.prototype)}},no=500,Os=({check:s,interval:e=no,timeout:t,signal:i})=>new Promise((r,o)=>{let n,a;ei(i,()=>{n&&clearTimeout(n),o(new Nt("Poll cancelled"))}),t&&(a=setTimeout(()=>{n&&clearTimeout(n),o(new Nt("Timed out"))},t));let l=()=>{try{Promise.resolve(s(i)).then(c=>{c?(a&&clearTimeout(a),r(c)):n=setTimeout(l,e)}).catch(c=>{a&&clearTimeout(a),o(c)})}catch(c){a&&clearTimeout(a),o(c)}};n=setTimeout(l,0)}),T={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},ii="application/octet-stream",Ss="original",_t=({method:s,url:e,data:t,headers:i={},signal:r,onProgress:o})=>new Promise((n,a)=>{let l=new XMLHttpRequest,c=s?.toUpperCase()||"GET",u=!1;l.open(c,e,!0),i&&Object.entries(i).forEach(p=>{let[h,f]=p;typeof f<"u"&&!Array.isArray(f)&&l.setRequestHeader(h,f)}),l.responseType="text",ei(r,()=>{u=!0,l.abort(),a(new Nt)}),l.onload=()=>{if(l.status!=200)a(new Error(`Error ${l.status}: ${l.statusText}`));else{let p={method:c,url:e,data:t,headers:i||void 0,signal:r,onProgress:o},h=l.getAllResponseHeaders().trim().split(/[\r\n]+/),f={};h.forEach(function(v){let O=v.split(": "),y=O.shift(),x=O.join(": ");y&&typeof y<"u"&&(f[y]=x)});let m=l.response,g=l.status;n({request:p,data:m,headers:f,status:g})}},l.onerror=p=>{u||a(new Qe(p))},o&&typeof o=="function"&&(l.upload.onprogress=p=>{p.lengthComputable?o({isComputable:!0,value:p.loaded/p.total}):o({isComputable:!1})}),t?l.send(t):l.send()});function ao(s,...e){return s}var lo=({name:s})=>s?[s]:[],co=ao,uo=()=>new FormData,Ls=s=>!1,si=s=>typeof Blob<"u"&&s instanceof Blob,ri=s=>typeof File<"u"&&s instanceof File,oi=s=>!!s&&typeof s=="object"&&!Array.isArray(s)&&"uri"in s&&typeof s.uri=="string",Pt=s=>si(s)||ri(s)||Ls()||oi(s),ho=s=>typeof s=="string"||typeof s=="number"||typeof s>"u",po=s=>!!s&&typeof s=="object"&&!Array.isArray(s),mo=s=>!!s&&typeof s=="object"&&"data"in s&&Pt(s.data);function fo(s,e,t){if(mo(t)){let{name:i,contentType:r}=t,o=co(t.data,i,r??ii),n=lo({name:i,contentType:r});s.push([e,o,...n])}else if(po(t))for(let[i,r]of Object.entries(t))typeof r<"u"&&s.push([`${e}[${i}]`,String(r)]);else ho(t)&&t&&s.push([e,t.toString()])}function bo(s){let e=[];for(let[t,i]of Object.entries(s))fo(e,t,i);return e}function zi(s){let e=uo(),t=bo(s);for(let i of t){let[r,o,...n]=i;e.append(r,o,...n)}return e}var P=class s extends Error{constructor(t,i,r,o,n){super();d(this,"isCancel");d(this,"code");d(this,"request");d(this,"response");d(this,"headers");this.name="UploadClientError",this.message=t,this.code=i,this.request=r,this.response=o,this.headers=n,Object.setPrototypeOf(this,s.prototype)}},go=s=>{let e=new URLSearchParams;for(let[t,i]of Object.entries(s))i&&typeof i=="object"&&!Array.isArray(i)?Object.entries(i).filter(r=>r[1]??!1).forEach(r=>e.set(`${t}[${r[0]}]`,String(r[1]))):Array.isArray(i)?i.forEach(r=>{e.append(`${t}[]`,r)}):typeof i=="string"&&i?e.set(t,i):typeof i=="number"&&e.set(t,i.toString());return e.toString()},ut=(s,e,t)=>{let i=new URL(s);return i.pathname=(i.pathname+e).replace("//","/"),t&&(i.search=go(t)),i.toString()},_o="6.8.0",vo="UploadcareUploadClient",yo=_o;function Lt(s){return Vi({libraryName:vo,libraryVersion:yo,...s})}var Co="RequestThrottledError",Ts=15e3,Eo=1e3;function Ao(s){let{headers:e}=s||{};if(!e||typeof e["retry-after"]!="string")return Ts;let t=parseInt(e["retry-after"],10);return Number.isFinite(t)?t*1e3:Ts}function vt(s,e){let{retryThrottledRequestMaxTimes:t,retryNetworkErrorMaxTimes:i}=e;return oo(({attempt:r,retry:o})=>s().catch(n=>{if("response"in n&&n?.code===Co&&r<t)return o(Ao(n));if(n instanceof Qe&&r<i)return o((r+1)*Eo);throw n}))}var ks=s=>{let e="";return(si(s)||ri(s)||oi(s))&&(e=s.type),e||ii},Is=s=>{let e="";return ri(s)&&s.name?e=s.name:si(s)||Ls()?e="":oi(s)&&s.name&&(e=s.name),e||Ss};function Hi(s){return typeof s>"u"||s==="auto"?"auto":s?"1":"0"}function xo(s,{publicKey:e,fileName:t,contentType:i,baseURL:r=T.baseURL,secureSignature:o,secureExpire:n,store:a,signal:l,onProgress:c,source:u="local",integration:p,userAgent:h,retryThrottledRequestMaxTimes:f=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=T.retryNetworkErrorMaxTimes,metadata:g}){return vt(()=>_t({method:"POST",url:ut(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Lt({publicKey:e,integration:p,userAgent:h})},data:zi({file:{data:s,name:t||Is(s),contentType:i||ks(s)},UPLOADCARE_PUB_KEY:e,UPLOADCARE_STORE:Hi(a),signature:o,expire:n,source:u,metadata:g}),signal:l,onProgress:c}).then(({data:v,headers:O,request:y})=>{let x=pt(JSON.parse(v));if("error"in x)throw new P(x.error.content,x.error.errorCode,y,x,O);return x}),{retryNetworkErrorMaxTimes:m,retryThrottledRequestMaxTimes:f})}var Ni;(function(s){s.Token="token",s.FileInfo="file_info"})(Ni||(Ni={}));function wo(s,{publicKey:e,baseURL:t=T.baseURL,store:i,fileName:r,checkForUrlDuplicates:o,saveUrlForRecurrentUploads:n,secureSignature:a,secureExpire:l,source:c="url",signal:u,integration:p,userAgent:h,retryThrottledRequestMaxTimes:f=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=T.retryNetworkErrorMaxTimes,metadata:g}){return vt(()=>_t({method:"POST",headers:{"X-UC-User-Agent":Lt({publicKey:e,integration:p,userAgent:h})},url:ut(t,"/from_url/",{jsonerrors:1,pub_key:e,source_url:s,store:Hi(i),filename:r,check_URL_duplicates:o?1:void 0,save_URL_duplicates:n?1:void 0,signature:a,expire:l,source:c,metadata:g}),signal:u}).then(({data:v,headers:O,request:y})=>{let x=pt(JSON.parse(v));if("error"in x)throw new P(x.error.content,x.error.errorCode,y,x,O);return x}),{retryNetworkErrorMaxTimes:m,retryThrottledRequestMaxTimes:f})}var G;(function(s){s.Unknown="unknown",s.Waiting="waiting",s.Progress="progress",s.Error="error",s.Success="success"})(G||(G={}));var To=s=>"status"in s&&s.status===G.Error;function Oo(s,{publicKey:e,baseURL:t=T.baseURL,signal:i,integration:r,userAgent:o,retryThrottledRequestMaxTimes:n=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=T.retryNetworkErrorMaxTimes}={}){return vt(()=>_t({method:"GET",headers:e?{"X-UC-User-Agent":Lt({publicKey:e,integration:r,userAgent:o})}:void 0,url:ut(t,"/from_url/status/",{jsonerrors:1,token:s}),signal:i}).then(({data:l,headers:c,request:u})=>{let p=pt(JSON.parse(l));if("error"in p&&!To(p))throw new P(p.error.content,void 0,u,p,c);return p}),{retryNetworkErrorMaxTimes:a,retryThrottledRequestMaxTimes:n})}function So(s,{publicKey:e,baseURL:t=T.baseURL,jsonpCallback:i,secureSignature:r,secureExpire:o,signal:n,source:a,integration:l,userAgent:c,retryThrottledRequestMaxTimes:u=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:p=T.retryNetworkErrorMaxTimes}){return vt(()=>_t({method:"POST",headers:{"X-UC-User-Agent":Lt({publicKey:e,integration:l,userAgent:c})},url:ut(t,"/group/",{jsonerrors:1,pub_key:e,files:s,callback:i,signature:r,expire:o,source:a}),signal:n}).then(({data:h,headers:f,request:m})=>{let g=pt(JSON.parse(h));if("error"in g)throw new P(g.error.content,g.error.errorCode,m,g,f);return g}),{retryNetworkErrorMaxTimes:p,retryThrottledRequestMaxTimes:u})}function Rs(s,{publicKey:e,baseURL:t=T.baseURL,signal:i,source:r,integration:o,userAgent:n,retryThrottledRequestMaxTimes:a=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=T.retryNetworkErrorMaxTimes}){return vt(()=>_t({method:"GET",headers:{"X-UC-User-Agent":Lt({publicKey:e,integration:o,userAgent:n})},url:ut(t,"/info/",{jsonerrors:1,pub_key:e,file_id:s,source:r}),signal:i}).then(({data:c,headers:u,request:p})=>{let h=pt(JSON.parse(c));if("error"in h)throw new P(h.error.content,h.error.errorCode,p,h,u);return h}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function Lo(s,{publicKey:e,contentType:t,fileName:i,multipartChunkSize:r=T.multipartChunkSize,baseURL:o="",secureSignature:n,secureExpire:a,store:l,signal:c,source:u="local",integration:p,userAgent:h,retryThrottledRequestMaxTimes:f=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=T.retryNetworkErrorMaxTimes,metadata:g}){return vt(()=>_t({method:"POST",url:ut(o,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Lt({publicKey:e,integration:p,userAgent:h})},data:zi({filename:i||Ss,size:s,content_type:t||ii,part_size:r,UPLOADCARE_STORE:Hi(l),UPLOADCARE_PUB_KEY:e,signature:n,expire:a,source:u,metadata:g}),signal:c}).then(({data:v,headers:O,request:y})=>{let x=pt(JSON.parse(v));if("error"in x)throw new P(x.error.content,x.error.errorCode,y,x,O);return x.parts=Object.keys(x.parts).map(z=>x.parts[z]),x}),{retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m})}function ko(s,e,{contentType:t,signal:i,onProgress:r,retryThrottledRequestMaxTimes:o=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:n=T.retryNetworkErrorMaxTimes}){return vt(()=>_t({method:"PUT",url:e,data:s,onProgress:r,signal:i,headers:{"Content-Type":t||ii}}).then(a=>(r&&r({isComputable:!0,value:1}),a)).then(({status:a})=>({code:a})),{retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:n})}function Io(s,{publicKey:e,baseURL:t=T.baseURL,source:i="local",signal:r,integration:o,userAgent:n,retryThrottledRequestMaxTimes:a=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=T.retryNetworkErrorMaxTimes}){return vt(()=>_t({method:"POST",url:ut(t,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Lt({publicKey:e,integration:o,userAgent:n})},data:zi({uuid:s,UPLOADCARE_PUB_KEY:e,source:i}),signal:r}).then(({data:c,headers:u,request:p})=>{let h=pt(JSON.parse(c));if("error"in h)throw new P(h.error.content,h.error.errorCode,p,h,u);return h}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function Gi(s,{publicKey:e,baseURL:t,source:i,integration:r,userAgent:o,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:a,signal:l,onProgress:c}){return Os({check:u=>Rs(s,{publicKey:e,baseURL:t,signal:u,source:i,integration:r,userAgent:o,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:a}).then(p=>p.isReady?p:(c&&c({isComputable:!0,value:1}),!1)),signal:l})}function Ro(s){return"defaultEffects"in s}var ht=class{constructor(e,{baseCDN:t=T.baseCDN,fileName:i}={}){d(this,"uuid");d(this,"name",null);d(this,"size",null);d(this,"isStored",null);d(this,"isImage",null);d(this,"mimeType",null);d(this,"cdnUrl",null);d(this,"s3Url",null);d(this,"originalFilename",null);d(this,"imageInfo",null);d(this,"videoInfo",null);d(this,"contentInfo",null);d(this,"metadata",null);d(this,"s3Bucket",null);d(this,"defaultEffects",null);let{uuid:r,s3Bucket:o}=e,n=ut(t,`${r}/`),a=o?ut(`https://${o}.s3.amazonaws.com/`,`${r}/${e.filename}`):null;this.uuid=r,this.name=i||e.filename,this.size=e.size,this.isStored=e.isStored,this.isImage=e.isImage,this.mimeType=e.mimeType,this.cdnUrl=n,this.originalFilename=e.originalFilename,this.imageInfo=e.imageInfo,this.videoInfo=e.videoInfo,this.contentInfo=e.contentInfo,this.metadata=e.metadata||null,this.s3Bucket=o||null,this.s3Url=a,Ro(e)&&(this.defaultEffects=e.defaultEffects)}},$o=(s,{publicKey:e,fileName:t,baseURL:i,secureSignature:r,secureExpire:o,store:n,contentType:a,signal:l,onProgress:c,source:u,integration:p,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,baseCDN:g,metadata:v})=>xo(s,{publicKey:e,fileName:t,contentType:a,baseURL:i,secureSignature:r,secureExpire:o,store:n,signal:l,onProgress:c,source:u,integration:p,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,metadata:v}).then(({file:O})=>Gi(O,{publicKey:e,baseURL:i,source:u,integration:p,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,onProgress:c,signal:l})).then(O=>new ht(O,{baseCDN:g})),Uo=(s,{publicKey:e,fileName:t,baseURL:i,signal:r,onProgress:o,source:n,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:u,baseCDN:p})=>Rs(s,{publicKey:e,baseURL:i,signal:r,source:n,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:u}).then(h=>new ht(h,{baseCDN:p,fileName:t})).then(h=>(o&&o({isComputable:!0,value:1}),h)),Mo=(s,{signal:e}={})=>{let t=null,i=null,r=s.map(()=>new AbortController),o=n=>()=>{i=n,r.forEach((a,l)=>l!==n&&a.abort())};return ei(e,()=>{r.forEach(n=>n.abort())}),Promise.all(s.map((n,a)=>{let l=o(a);return Promise.resolve().then(()=>n({stopRace:l,signal:r[a].signal})).then(c=>(l(),c)).catch(c=>(t=c,null))})).then(n=>{if(i===null)throw t;return n[i]})},Do=window.WebSocket,Pi=class{constructor(){d(this,"events",Object.create({}))}emit(e,t){this.events[e]?.forEach(i=>i(t))}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){t?this.events[e]=this.events[e].filter(i=>i!==t):this.events[e]=[]}},No=(s,e)=>s==="success"?{status:G.Success,...e}:s==="progress"?{status:G.Progress,...e}:{status:G.Error,...e},Fi=class{constructor(e,t=3e4){d(this,"key");d(this,"disconnectTime");d(this,"ws");d(this,"queue",[]);d(this,"isConnected",!1);d(this,"subscribers",0);d(this,"emmitter",new Pi);d(this,"disconnectTimeoutId",null);this.key=e,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){let e=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new Do(e),this.ws.addEventListener("error",t=>{this.emmitter.emit("error",new Error(t.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(t=>this.send(t.event,t.data)),this.queue=[]}),this.ws.addEventListener("message",t=>{let i=JSON.parse(t.data.toString());switch(i.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(i.channel,No(i.event,JSON.parse(i.data)))}})}}disconnect(){let e=()=>{this.ws?.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{e()},this.disconnectTime):e()}send(e,t){let i=JSON.stringify({event:e,data:t});this.ws?.send(i)}subscribe(e,t){this.subscribers+=1,this.connect();let i=`task-status-${e}`,r={event:"pusher:subscribe",data:{channel:i}};this.emmitter.on(i,t),this.isConnected?this.send(r.event,r.data):this.queue.push(r)}unsubscribe(e){this.subscribers-=1;let t=`task-status-${e}`,i={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(i.event,i.data):this.queue=this.queue.filter(r=>r.data.channel!==t),this.subscribers===0&&this.disconnect()}onError(e){return this.emmitter.on("error",e),()=>this.emmitter.off("error",e)}},Mi=null,Xi=s=>{if(!Mi){let e=typeof window>"u"?0:3e4;Mi=new Fi(s,e)}return Mi},Po=s=>{Xi(s).connect()};function Fo({token:s,publicKey:e,baseURL:t,integration:i,userAgent:r,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:n,onProgress:a,signal:l}){return Os({check:c=>Oo(s,{publicKey:e,baseURL:t,integration:i,userAgent:r,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:n,signal:c}).then(u=>{switch(u.status){case G.Error:return new P(u.error,u.errorCode);case G.Waiting:return!1;case G.Unknown:return new P(`Token "${s}" was not found.`);case G.Progress:return a&&(u.total==="unknown"?a({isComputable:!1}):a({isComputable:!0,value:u.done/u.total})),!1;case G.Success:return a&&a({isComputable:!0,value:u.done/u.total}),u;default:throw new Error("Unknown status")}}),signal:l})}var Bo=({token:s,pusherKey:e,signal:t,onProgress:i})=>new Promise((r,o)=>{let n=Xi(e),a=n.onError(o),l=()=>{a(),n.unsubscribe(s)};ei(t,()=>{l(),o(new Nt("pusher cancelled"))}),n.subscribe(s,c=>{switch(c.status){case G.Progress:{i&&(c.total==="unknown"?i({isComputable:!1}):i({isComputable:!0,value:c.done/c.total}));break}case G.Success:{l(),i&&i({isComputable:!0,value:c.done/c.total}),r(c);break}case G.Error:l(),o(new P(c.msg,c.error_code))}})}),Vo=(s,{publicKey:e,fileName:t,baseURL:i,baseCDN:r,checkForUrlDuplicates:o,saveUrlForRecurrentUploads:n,secureSignature:a,secureExpire:l,store:c,signal:u,onProgress:p,source:h,integration:f,userAgent:m,retryThrottledRequestMaxTimes:g,pusherKey:v=T.pusherKey,metadata:O})=>Promise.resolve(Po(v)).then(()=>wo(s,{publicKey:e,fileName:t,baseURL:i,checkForUrlDuplicates:o,saveUrlForRecurrentUploads:n,secureSignature:a,secureExpire:l,store:c,signal:u,source:h,integration:f,userAgent:m,retryThrottledRequestMaxTimes:g,metadata:O})).catch(y=>(Xi(v)?.disconnect(),Promise.reject(y))).then(y=>y.type===Ni.FileInfo?y:Mo([({signal:x})=>Fo({token:y.token,publicKey:e,baseURL:i,integration:f,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:p,signal:x}),({signal:x})=>Bo({token:y.token,pusherKey:v,signal:x,onProgress:p})],{signal:u})).then(y=>{if(y instanceof P)throw y;return y}).then(y=>Gi(y.uuid,{publicKey:e,baseURL:i,integration:f,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:p,signal:u})).then(y=>new ht(y,{baseCDN:r})),Di=new WeakMap,zo=async s=>{if(Di.has(s))return Di.get(s);let e=await fetch(s.uri).then(t=>t.blob());return Di.set(s,e),e},$s=async s=>{if(ri(s)||si(s))return s.size;if(oi(s))return(await zo(s)).size;throw new Error("Unknown file type. Cannot determine file size.")},Ho=(s,e=T.multipartMinFileSize)=>s>=e,Us=s=>{let e="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",t=new RegExp(e);return!Pt(s)&&t.test(s)},ji=s=>{let e="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",t=new RegExp(e);return!Pt(s)&&t.test(s)},Go=(s,e)=>new Promise((t,i)=>{let r=[],o=!1,n=e.length,a=[...e],l=()=>{let c=e.length-a.length,u=a.shift();u&&u().then(p=>{o||(r[c]=p,n-=1,n?l():t(r))}).catch(p=>{o=!0,i(p)})};for(let c=0;c<s;c++)l()}),Xo=(s,e,t,i)=>{let r=i*e,o=Math.min(r+i,t);return s.slice(r,o)},jo=async(s,e,t)=>i=>Xo(s,i,e,t),Ko=(s,e,{publicKey:t,contentType:i,onProgress:r,signal:o,integration:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})=>ko(s,e,{publicKey:t,contentType:i,onProgress:r,signal:o,integration:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l}),Wo=async(s,{publicKey:e,fileName:t,fileSize:i,baseURL:r,secureSignature:o,secureExpire:n,store:a,signal:l,onProgress:c,source:u,integration:p,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,contentType:g,multipartChunkSize:v=T.multipartChunkSize,maxConcurrentRequests:O=T.maxConcurrentRequests,baseCDN:y,metadata:x})=>{let z=i??await $s(s),ct,St=(U,H)=>{if(!c)return;ct||(ct=Array(U).fill(0));let Q=it=>it.reduce((dt,Ui)=>dt+Ui,0);return it=>{it.isComputable&&(ct[H]=it.value,c({isComputable:!0,value:Q(ct)/U}))}};return g||(g=ks(s)),Lo(z,{publicKey:e,contentType:g,fileName:t||Is(s),baseURL:r,secureSignature:o,secureExpire:n,store:a,signal:l,source:u,integration:p,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,metadata:x}).then(async({uuid:U,parts:H})=>{let Q=await jo(s,z,v);return Promise.all([U,Go(O,H.map((it,dt)=>()=>Ko(Q(dt),it,{publicKey:e,contentType:g,onProgress:St(H.length,dt),signal:l,integration:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m})))])}).then(([U])=>Io(U,{publicKey:e,baseURL:r,source:u,integration:p,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m})).then(U=>U.isReady?U:Gi(U.uuid,{publicKey:e,baseURL:r,source:u,integration:p,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,onProgress:c,signal:l})).then(U=>new ht(U,{baseCDN:y}))};async function Ki(s,{publicKey:e,fileName:t,baseURL:i=T.baseURL,secureSignature:r,secureExpire:o,store:n,signal:a,onProgress:l,source:c,integration:u,userAgent:p,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:f,contentType:m,multipartMinFileSize:g,multipartChunkSize:v,maxConcurrentRequests:O,baseCDN:y=T.baseCDN,checkForUrlDuplicates:x,saveUrlForRecurrentUploads:z,pusherKey:ct,metadata:St}){if(Pt(s)){let U=await $s(s);return Ho(U,g)?Wo(s,{publicKey:e,contentType:m,multipartChunkSize:v,fileSize:U,fileName:t,baseURL:i,secureSignature:r,secureExpire:o,store:n,signal:a,onProgress:l,source:c,integration:u,userAgent:p,maxConcurrentRequests:O,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:f,baseCDN:y,metadata:St}):$o(s,{publicKey:e,fileName:t,contentType:m,baseURL:i,secureSignature:r,secureExpire:o,store:n,signal:a,onProgress:l,source:c,integration:u,userAgent:p,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:f,baseCDN:y,metadata:St})}if(ji(s))return Vo(s,{publicKey:e,fileName:t,baseURL:i,baseCDN:y,checkForUrlDuplicates:x,saveUrlForRecurrentUploads:z,secureSignature:r,secureExpire:o,store:n,signal:a,onProgress:l,source:c,integration:u,userAgent:p,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:f,pusherKey:ct,metadata:St});if(Us(s))return Uo(s,{publicKey:e,fileName:t,baseURL:i,signal:a,onProgress:l,source:c,integration:u,userAgent:p,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:f,baseCDN:y});throw new TypeError(`File uploading from "${s}" is not supported`)}var Bi=class{constructor(e,{baseCDN:t=T.baseCDN}={}){d(this,"uuid");d(this,"filesCount");d(this,"totalSize");d(this,"isStored");d(this,"isImage");d(this,"cdnUrl");d(this,"files");d(this,"createdAt");d(this,"storedAt",null);this.uuid=e.id,this.filesCount=e.filesCount;let i=e.files.filter(Boolean);this.totalSize=Object.values(i).reduce((r,o)=>r+o.size,0),this.isStored=!!e.datetimeStored,this.isImage=!!Object.values(i).filter(r=>r.isImage).length,this.cdnUrl=e.cdnUrl,this.files=i.map(r=>new ht(r,{baseCDN:t})),this.createdAt=e.datetimeCreated,this.storedAt=e.datetimeStored}},qo=s=>{for(let e of s)if(!Pt(e))return!1;return!0},Yo=s=>{for(let e of s)if(!Us(e))return!1;return!0},Zo=s=>{for(let e of s)if(!ji(e))return!1;return!0};function Ms(s,{publicKey:e,fileName:t,baseURL:i=T.baseURL,secureSignature:r,secureExpire:o,store:n,signal:a,onProgress:l,source:c,integration:u,userAgent:p,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:f,contentType:m,multipartChunkSize:g=T.multipartChunkSize,baseCDN:v=T.baseCDN,checkForUrlDuplicates:O,saveUrlForRecurrentUploads:y,jsonpCallback:x}){if(!qo(s)&&!Zo(s)&&!Yo(s))throw new TypeError(`Group uploading from "${s}" is not supported`);let z,ct=!0,St=s.length,U=(H,Q)=>{if(!l)return;z||(z=Array(H).fill(0));let it=dt=>dt.reduce((Ui,Jr)=>Ui+Jr)/H;return dt=>{if(!dt.isComputable||!ct){ct=!1,l({isComputable:!1});return}z[Q]=dt.value,l({isComputable:!0,value:it(z)})}};return Promise.all(s.map((H,Q)=>Pt(H)||ji(H)?Ki(H,{publicKey:e,fileName:t,baseURL:i,secureSignature:r,secureExpire:o,store:n,signal:a,onProgress:U(St,Q),source:c,integration:u,userAgent:p,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:f,contentType:m,multipartChunkSize:g,baseCDN:v,checkForUrlDuplicates:O,saveUrlForRecurrentUploads:y}).then(it=>it.uuid):H)).then(H=>So(H,{publicKey:e,baseURL:i,jsonpCallback:x,secureSignature:r,secureExpire:o,signal:a,source:c,integration:u,userAgent:p,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:f}).then(Q=>new Bi(Q,{baseCDN:v})).then(Q=>(l&&l({isComputable:!0,value:1}),Q)))}var ti=class{constructor(e){d(this,"_concurrency",1);d(this,"_pending",[]);d(this,"_running",0);d(this,"_resolvers",new Map);d(this,"_rejectors",new Map);this._concurrency=e}_run(){let e=this._concurrency-this._running;for(let t=0;t<e;t++){let i=this._pending.shift();if(!i)return;let r=this._resolvers.get(i),o=this._rejectors.get(i);if(!r||!o)throw new Error("Unexpected behavior: resolver or rejector is undefined");this._running+=1,i().finally(()=>{this._resolvers.delete(i),this._rejectors.delete(i),this._running-=1,this._run()}).then(n=>r(n)).catch(n=>o(n))}}add(e){return new Promise((t,i)=>{this._resolvers.set(e,t),this._rejectors.set(e,i),this._pending.push(e),this._run()})}get pending(){return this._pending.length}get running(){return this._running}set concurrency(e){this._concurrency=e,this._run()}get concurrency(){return this._concurrency}};var Jo=Object.defineProperty,Qo=(s,e,t)=>e in s?Jo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,qi=(s,e,t)=>(Qo(s,typeof e!="symbol"?e+"":e,t),t);function tn(s){let e=t=>{var i;for(let r in t)((i=t[r])==null?void 0:i.constructor)===Object&&(t[r]=e(t[r]));return{...t}};return e(s)}var w=class{constructor(s){s.constructor===Object?this.store=tn(s):(this._storeIsProxy=!0,this.store=s),this.callbackMap=Object.create(null)}static warn(s,e){console.warn(`Symbiote Data: cannot ${s}. Prop name: `+e)}read(s){return!this._storeIsProxy&&!this.store.hasOwnProperty(s)?(w.warn("read",s),null):this.store[s]}has(s){return this._storeIsProxy?this.store[s]!==void 0:this.store.hasOwnProperty(s)}add(s,e,t=!1){!t&&Object.keys(this.store).includes(s)||(this.store[s]=e,this.notify(s))}pub(s,e){if(!this._storeIsProxy&&!this.store.hasOwnProperty(s)){w.warn("publish",s);return}this.store[s]=e,this.notify(s)}multiPub(s){for(let e in s)this.pub(e,s[e])}notify(s){this.callbackMap[s]&&this.callbackMap[s].forEach(e=>{e(this.store[s])})}sub(s,e,t=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(s)?(w.warn("subscribe",s),null):(this.callbackMap[s]||(this.callbackMap[s]=new Set),this.callbackMap[s].add(e),t&&e(this.store[s]),{remove:()=>{this.callbackMap[s].delete(e),this.callbackMap[s].size||delete this.callbackMap[s]},callback:e})}static registerCtx(s,e=Symbol()){let t=w.globalStore.get(e);return t?console.warn('State: context UID "'+e+'" already in use'):(t=new w(s),w.globalStore.set(e,t)),t}static deleteCtx(s){w.globalStore.delete(s)}static getCtx(s,e=!0){return w.globalStore.get(s)||(e&&console.warn('State: wrong context UID - "'+s+'"'),null)}};w.globalStore=new Map;var A=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),Ps="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",en=Ps.length-1,pe=class{static generate(s="XXXXXXXXX-XXX"){let e="";for(let t=0;t<s.length;t++)e+=s[t]==="-"?s[t]:Ps.charAt(Math.random()*en);return e}};function Fs(s,e,t){let i=!0,r,o=e.split(".");return o.forEach((n,a)=>{a<o.length-1?s=s[n]:r=n}),s?s[r]=t:i=!1,i}function sn(s){return s.split("-").map((e,t)=>e&&t?e[0].toUpperCase()+e.slice(1):e).join("").split("_").map((e,t)=>e&&t?e.toUpperCase():e).join("")}function rn(s,e){[...s.querySelectorAll(`[${A.REPEAT_ATTR}]`)].forEach(t=>{let i=t.getAttribute(A.REPEAT_ITEM_TAG_ATTR),r;if(i&&(r=window.customElements.get(i)),!r){r=class extends e.BaseComponent{constructor(){super(),i||(this.style.display="contents")}};let n=t.innerHTML;r.template=n,r.reg(i)}for(;t.firstChild;)t.firstChild.remove();let o=t.getAttribute(A.REPEAT_ATTR);e.sub(o,n=>{if(!n){for(;t.firstChild;)t.firstChild.remove();return}let a=[...t.children],l,c=u=>{u.forEach((h,f)=>{if(a[f])if(a[f].set$)setTimeout(()=>{a[f].set$(h)});else for(let m in h)a[f][m]=h[m];else{l||(l=new DocumentFragment);let m=new r;Object.assign(m.init$,h),l.appendChild(m)}}),l&&t.appendChild(l);let p=a.slice(u.length,a.length);for(let h of p)h.remove()};if(n.constructor===Array)c(n);else if(n.constructor===Object){let u=[];for(let p in n){let h=n[p];Object.defineProperty(h,"_KEY_",{value:p,enumerable:!0}),u.push(h)}c(u)}else console.warn("Symbiote repeat data type error:"),console.log(n)}),t.removeAttribute(A.REPEAT_ATTR),t.removeAttribute(A.REPEAT_ITEM_TAG_ATTR)})}var Ds="__default__";function on(s,e){if(e.shadowRoot)return;let t=[...s.querySelectorAll("slot")];if(!t.length)return;let i={};t.forEach(r=>{let o=r.getAttribute("name")||Ds;i[o]={slot:r,fr:document.createDocumentFragment()}}),e.initChildren.forEach(r=>{var o;let n=Ds;r instanceof Element&&r.hasAttribute("slot")&&(n=r.getAttribute("slot"),r.removeAttribute("slot")),(o=i[n])==null||o.fr.appendChild(r)}),Object.values(i).forEach(r=>{if(r.fr.childNodes.length)r.slot.parentNode.replaceChild(r.fr,r.slot);else if(r.slot.childNodes.length){let o=document.createDocumentFragment();o.append(...r.slot.childNodes),r.slot.parentNode.replaceChild(o,r.slot)}else r.slot.remove()})}function nn(s,e){[...s.querySelectorAll(`[${A.EL_REF_ATTR}]`)].forEach(t=>{let i=t.getAttribute(A.EL_REF_ATTR);e.ref[i]=t,t.removeAttribute(A.EL_REF_ATTR)})}function an(s,e){[...s.querySelectorAll(`[${A.BIND_ATTR}]`)].forEach(t=>{let r=t.getAttribute(A.BIND_ATTR).split(";");[...t.attributes].forEach(o=>{if(o.name.startsWith("-")&&o.value){let n=sn(o.name.replace("-",""));r.push(n+":"+o.value),t.removeAttribute(o.name)}}),r.forEach(o=>{if(!o)return;let n=o.split(":").map(u=>u.trim()),a=n[0],l;a.indexOf(A.ATTR_BIND_PRFX)===0&&(l=!0,a=a.replace(A.ATTR_BIND_PRFX,""));let c=n[1].split(",").map(u=>u.trim());for(let u of c){let p;u.startsWith("!!")?(p="double",u=u.replace("!!","")):u.startsWith("!")&&(p="single",u=u.replace("!","")),e.sub(u,h=>{p==="double"?h=!!h:p==="single"&&(h=!h),l?h?.constructor===Boolean?h?t.setAttribute(a,""):t.removeAttribute(a):t.setAttribute(a,h):Fs(t,a,h)||(t[A.SET_LATER_KEY]||(t[A.SET_LATER_KEY]=Object.create(null)),t[A.SET_LATER_KEY][a]=h)})}}),t.removeAttribute(A.BIND_ATTR)})}var ni="{{",he="}}",ln="skip-text";function cn(s){let e,t=[],i=document.createTreeWalker(s,NodeFilter.SHOW_TEXT,{acceptNode:r=>{var o;return!((o=r.parentElement)!=null&&o.hasAttribute(ln))&&r.textContent.includes(ni)&&r.textContent.includes(he)&&1}});for(;e=i.nextNode();)t.push(e);return t}var dn=function(s,e){cn(s).forEach(i=>{let r=[],o;for(;i.textContent.includes(he);)i.textContent.startsWith(ni)?(o=i.textContent.indexOf(he)+he.length,i.splitText(o),r.push(i)):(o=i.textContent.indexOf(ni),i.splitText(o)),i=i.nextSibling;r.forEach(n=>{let a=n.textContent.replace(ni,"").replace(he,"");n.textContent="",e.sub(a,l=>{n.textContent=l})})})},un=[rn,on,nn,an,dn],ai="'",Bt='"',hn=/\\([0-9a-fA-F]{1,6} ?)/g;function pn(s){return(s[0]===Bt||s[0]===ai)&&(s[s.length-1]===Bt||s[s.length-1]===ai)}function mn(s){return(s[0]===Bt||s[0]===ai)&&(s=s.slice(1)),(s[s.length-1]===Bt||s[s.length-1]===ai)&&(s=s.slice(0,-1)),s}function fn(s){let e="",t="";for(var i=0;i<s.length;i++){let r=s[i+1];s[i]==="\\"&&r==='"'?(e+='\\"',i++):s[i]==='"'&&t!=="\\"?e+='\\"':e+=s[i],t=s[i]}return e}function bn(s){let e=s;pn(s)&&(e=mn(e),e=e.replace(hn,(t,i)=>String.fromCodePoint(parseInt(i.trim(),16))),e=e.replaceAll(`\\
`,"\\n"),e=fn(e),e=Bt+e+Bt);try{return JSON.parse(e)}catch{throw new Error(`Failed to parse CSS property value: ${e}. Original input: ${s}`)}}var Ns=0,Ft=null,mt=null,yt=class extends HTMLElement{constructor(){super(),qi(this,"updateCssData",()=>{var s;this.dropCssDataCache(),(s=this.__boundCssProps)==null||s.forEach(e=>{let t=this.getCssData(this.__extractCssName(e),!0);t!==null&&this.$[e]!==t&&(this.$[e]=t)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return yt}initCallback(){}__initCallback(){var s;this.__initialized||(this.__initialized=!0,(s=this.initCallback)==null||s.call(this))}render(s,e=this.renderShadow){let t;if((e||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let r=this.getAttribute(A.USE_TPL);if(r){let o=this.getRootNode(),n=o?.querySelector(r)||document.querySelector(r);n?s=n.content.cloneNode(!0):console.warn(`Symbiote template "${r}" is not found...`)}}if(this.processInnerHtml)for(let r of this.tplProcessors)r(this,this);if(s||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),s?.constructor===DocumentFragment)t=s;else if(s?.constructor===String){let r=document.createElement("template");r.innerHTML=s,t=r.content.cloneNode(!0)}else this.constructor.__tpl&&(t=this.constructor.__tpl.content.cloneNode(!0));for(let r of this.tplProcessors)r(t,this)}let i=()=>{t&&(e&&this.shadowRoot.appendChild(t)||this.appendChild(t)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){e=!0;let r=document.createElement("link");r.rel="stylesheet",r.href=this.constructor.__shadowStylesUrl,r.onload=i,this.shadowRoot.prepend(r)}else i()}addTemplateProcessor(s){this.tplProcessors.add(s)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=pe.generate(),this.style.setProperty(A.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(A.CSS_CTX_PROP,!0)}get ctxName(){var s;let e=((s=this.getAttribute(A.CTX_NAME_ATTR))==null?void 0:s.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=e,e}get localCtx(){return this.__localCtx||(this.__localCtx=w.registerCtx({},this)),this.__localCtx}get nodeCtx(){return w.getCtx(this.ctxName,!1)||w.registerCtx({},this.ctxName)}static __parseProp(s,e){let t,i;if(s.startsWith(A.EXT_DATA_CTX_PRFX))t=e.nodeCtx,i=s.replace(A.EXT_DATA_CTX_PRFX,"");else if(s.includes(A.NAMED_DATA_CTX_SPLTR)){let r=s.split(A.NAMED_DATA_CTX_SPLTR);t=w.getCtx(r[0]),i=r[1]}else t=e.localCtx,i=s;return{ctx:t,name:i}}sub(s,e,t=!0){let i=o=>{this.isConnected&&e(o)},r=yt.__parseProp(s,this);r.ctx.has(r.name)?this.allSubs.add(r.ctx.sub(r.name,i,t)):window.setTimeout(()=>{this.allSubs.add(r.ctx.sub(r.name,i,t))})}notify(s){let e=yt.__parseProp(s,this);e.ctx.notify(e.name)}has(s){let e=yt.__parseProp(s,this);return e.ctx.has(e.name)}add(s,e,t=!1){let i=yt.__parseProp(s,this);i.ctx.add(i.name,e,t)}add$(s,e=!1){for(let t in s)this.add(t,s[t],e)}get $(){if(!this.__stateProxy){let s=Object.create(null);this.__stateProxy=new Proxy(s,{set:(e,t,i)=>{let r=yt.__parseProp(t,this);return r.ctx.pub(r.name,i),!0},get:(e,t)=>{let i=yt.__parseProp(t,this);return i.ctx.read(i.name)}})}return this.__stateProxy}set$(s,e=!1){for(let t in s){let i=s[t];e||![String,Number,Boolean].includes(i?.constructor)?this.$[t]=i:this.$[t]!==i&&(this.$[t]=i)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(A.CTX_OWNER_ATTR)&&this.getAttribute(A.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let s=this.constructor.__attrDesc;if(s)for(let e of Object.values(s))Object.keys(this.init$).includes(e)||(this.init$[e]="");for(let e in this.init$)if(e.startsWith(A.EXT_DATA_CTX_PRFX))this.nodeCtx.add(e.replace(A.EXT_DATA_CTX_PRFX,""),this.init$[e],this.__ctxOwner);else if(e.includes(A.NAMED_DATA_CTX_SPLTR)){let t=e.split(A.NAMED_DATA_CTX_SPLTR),i=t[0].trim(),r=t[1].trim();if(i&&r){let o=w.getCtx(i,!1);o||(o=w.registerCtx({},i)),o.add(r,this.init$[e])}}else this.localCtx.add(e,this.init$[e]);for(let e in this.cssInit$)this.bindCssData(e,this.cssInit$[e]);this.__dataCtxInitialized=!0}connectedCallback(){var s;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let e=(s=this.getAttribute(A.CTX_NAME_ATTR))==null?void 0:s.trim();if(e&&this.style.setProperty(A.CSS_CTX_PROP,`'${e}'`),this.__initDataCtx(),this[A.SET_LATER_KEY]){for(let t in this[A.SET_LATER_KEY])Fs(this,t,this[A.SET_LATER_KEY][t]);delete this[A.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let t of un)this.addTemplateProcessor(t);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let t=this.getRootNode();if(!t)return;if(t?.querySelector(`link[${A.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let r=this.constructor.__rootStylesLink.cloneNode(!0);r.setAttribute(A.ROOT_STYLE_ATTR_NAME,this.constructor.is),r.onload=()=>{this.render()},t.nodeType===Node.DOCUMENT_NODE?t.head.appendChild(r):t.prepend(r)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let s of this.allSubs)s.remove(),this.allSubs.delete(s);for(let s of this.tplProcessors)this.tplProcessors.delete(s);mt?.delete(this.updateCssData),mt?.size||(Ft?.disconnect(),Ft=null,mt=null)},100)))}static reg(s,e=!1){s||(Ns++,s=`${A.AUTO_TAG_PRFX}-${Ns}`),this.__tag=s;let t=window.customElements.get(s);if(t){!e&&t!==this&&console.warn([`Element with tag name "${s}" already registered.`,`You're trying to override it with another class "${this.name}".`,"This is most likely a mistake.","New element will not be registered."].join(` `));return}window.customElements.define(s,e?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(s){this.observedAttributes=Object.keys(s),this.__attrDesc=s}attributeChangedCallback(s,e,t){var i;if(e===t)return;let r=(i=this.constructor.__attrDesc)==null?void 0:i[s];r?this.__dataCtxInitialized?this.$[r]=t:this.init$[r]=t:this[s]=t}getCssData(s,e=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(s)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let t=this.__computedStyle.getPropertyValue(s).trim();try{this.__cssDataCache[s]=bn(t)}catch{!e&&console.warn(`CSS Data error: ${s}`),this.__cssDataCache[s]=null}}return this.__cssDataCache[s]}__extractCssName(s){return s.split("--").map((e,t)=>t===0?"":e).join("--")}__initStyleAttrObserver(){mt||(mt=new Set),mt.add(this.updateCssData),Ft||(Ft=new MutationObserver(s=>{s[0].type==="attributes"&&mt.forEach(e=>{e()})}),Ft.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(s,e=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(s);let t=this.getCssData(this.__extractCssName(s),!0);t===null&&(t=e),this.add(s,t),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(s,e,t){let i="__"+s;this[i]=this[s],Object.defineProperty(this,s,{set:r=>{this[i]=r,t?window.setTimeout(()=>{e?.(r)}):e?.(r)},get:()=>this[i]}),this[s]=this[i]}static set shadowStyles(s){let e=new Blob([s],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(e)}static set rootStyles(s){if(!this.__rootStylesLink){let e=new Blob([s],{type:"text/css"}),t=URL.createObjectURL(e),i=document.createElement("link");i.href=t,i.rel="stylesheet",this.__rootStylesLink=i}}},kt=yt;qi(kt,"template");var Wi=class{static _print(s){console.warn(s)}static setDefaultTitle(s){this.defaultTitle=s}static setRoutingMap(s){Object.assign(this.appMap,s);for(let e in this.appMap)!this.defaultRoute&&this.appMap[e].default===!0?this.defaultRoute=e:!this.errorRoute&&this.appMap[e].error===!0&&(this.errorRoute=e)}static set routingEventName(s){this.__routingEventName=s}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let s={route:null,options:{}};return window.location.search.split(this.separator).forEach(t=>{if(t.includes("?"))s.route=t.replace("?","");else if(t.includes("=")){let i=t.split("=");s.options[i[0]]=decodeURI(i[1])}else s.options[t]=!0}),s}static notify(){let s=this.readAddressBar(),e=this.appMap[s.route];if(e&&e.title&&(document.title=e.title),s.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!e&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!e&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!e){this._print(`Route "${s.route}" not found...`);return}let t=new CustomEvent(Wi.routingEventName,{detail:{route:s.route,options:Object.assign(e||{},s.options)}});window.dispatchEvent(t)}static reflect(s,e={}){let t=this.appMap[s];if(!t){this._print("Wrong route: "+s);return}let i="?"+s;for(let o in e)e[o]===!0?i+=this.separator+o:i+=this.separator+o+`=${e[o]}`;let r=t.title||this.defaultTitle||"";window.history.pushState(null,r,i),document.title=r}static applyRoute(s,e={}){this.reflect(s,e),this.notify()}static setSeparator(s){this._separator=s}static get separator(){return this._separator||"&"}static createRouterData(s,e){this.setRoutingMap(e);let t=w.registerCtx({route:null,options:null,title:null},s);return window.addEventListener(this.routingEventName,i=>{var r;t.multiPub({route:i.detail.route,options:i.detail.options,title:((r=i.detail.options)==null?void 0:r.title)||this.defaultTitle||""})}),Wi.notify(),this.initPopstateListener(),t}static initPopstateListener(){this.__onPopstate||(this.__onPopstate=()=>{this.notify()},window.addEventListener("popstate",this.__onPopstate))}static removePopstateListener(){window.removeEventListener("popstate",this.__onPopstate),this.__onPopstate=null}};Wi.appMap=Object.create(null);function Yi(s,e){for(let t in e)t.includes("-")?s.style.setProperty(t,e[t]):s.style[t]=e[t]}function gn(s,e){for(let t in e)e[t].constructor===Boolean?e[t]?s.setAttribute(t,""):s.removeAttribute(t):s.setAttribute(t,e[t])}function me(s={tag:"div"}){let e=document.createElement(s.tag);if(s.attributes&&gn(e,s.attributes),s.styles&&Yi(e,s.styles),s.properties)for(let t in s.properties)e[t]=s.properties[t];return s.processors&&s.processors.forEach(t=>{t(e)}),s.children&&s.children.forEach(t=>{let i=me(t);e.appendChild(i)}),e}var Bs="idb-store-ready",_n="symbiote-db",vn="symbiote-idb-update_",yn=class{_notifyWhenReady(s=null){window.dispatchEvent(new CustomEvent(Bs,{detail:{dbName:this.name,storeName:this.storeName,event:s}}))}get _updEventName(){return vn+this.name}_getUpdateEvent(s){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:s}})}_notifySubscribers(s){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,s),window.dispatchEvent(this._getUpdateEvent(s))}constructor(s,e){this.name=s,this.storeName=e,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=t=>{this.db=t.target.result,this.objStore=this.db.createObjectStore(e,{keyPath:"_key"}),this.objStore.transaction.oncomplete=i=>{this._notifyWhenReady(i)}},this.request.onsuccess=t=>{this.db=t.target.result,this._notifyWhenReady(t)},this.request.onerror=t=>{console.error(t)},this._subscriptionsMap={},this._updateHandler=t=>{t.key===this.name&&this._subscriptionsMap[t.newValue]&&this._subscriptionsMap[t.newValue].forEach(async r=>{r(await this.read(t.newValue))})},this._localUpdateHandler=t=>{this._updateHandler(t.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(s){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(s);return new Promise((i,r)=>{t.onsuccess=o=>{var n;(n=o.target.result)!=null&&n._value?i(o.target.result._value):(i(null),console.warn(`IDB: cannot read "${s}"`))},t.onerror=o=>{r(o)}})}write(s,e,t=!1){let i={_key:s,_value:e},o=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(i);return new Promise((n,a)=>{o.onsuccess=l=>{t||this._notifySubscribers(s),n(l.target.result)},o.onerror=l=>{a(l)}})}delete(s,e=!1){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(s);return new Promise((r,o)=>{i.onsuccess=n=>{e||this._notifySubscribers(s),r(n)},i.onerror=n=>{o(n)}})}getAll(){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((t,i)=>{e.onsuccess=r=>{let o=r.target.result;t(o.map(n=>n._value))},e.onerror=r=>{i(r)}})}subscribe(s,e){this._subscriptionsMap[s]||(this._subscriptionsMap[s]=new Set);let t=this._subscriptionsMap[s];return t.add(e),{remove:()=>{t.delete(e),t.size||delete this._subscriptionsMap[s]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,Vs.clear(this.name)}},Vs=class{static get readyEventName(){return Bs}static open(s=_n,e="store"){let t=s+"/"+e;return this._reg[t]||(this._reg[t]=new yn(s,e)),this._reg[t]}static clear(s){window.indexedDB.deleteDatabase(s);for(let e in this._reg)e.split("/")[0]===s&&delete this._reg[e]}};qi(Vs,"_reg",Object.create(null));var S=Object.freeze({UPLOAD_START:"upload-start",REMOVE:"remove",UPLOAD_PROGRESS:"upload-progress",UPLOAD_FINISH:"upload-finish",UPLOAD_ERROR:"upload-error",VALIDATION_ERROR:"validation-error",CLOUD_MODIFICATION:"cloud-modification",DATA_OUTPUT:"data-output",DONE_FLOW:"done-flow",INIT_FLOW:"init-flow"}),Cn=Object.freeze({[S.UPLOAD_START]:"LR_UPLOAD_START",[S.REMOVE]:"LR_REMOVE",[S.UPLOAD_PROGRESS]:"LR_UPLOAD_PROGRESS",[S.UPLOAD_FINISH]:"LR_UPLOAD_FINISH",[S.UPLOAD_ERROR]:"LR_UPLOAD_ERROR",[S.VALIDATION_ERROR]:"LR_VALIDATION_ERROR",[S.CLOUD_MODIFICATION]:"LR_CLOUD_MODIFICATION",[S.DATA_OUTPUT]:"LR_DATA_OUTPUT",[S.DONE_FLOW]:"LR_DONE_FLOW",[S.INIT_FLOW]:"LR_INIT_FLOW"}),li=class{constructor(e){d(this,"_timeoutStore",new Map);d(this,"_targets",new Set);this._getCtxName=e}bindTarget(e){this._targets.add(e)}unbindTarget(e){this._targets.delete(e)}_dispatch(e,t){for(let r of this._targets)r.dispatchEvent(new CustomEvent(e,{detail:t}));let i=Cn[e];window.dispatchEvent(new CustomEvent(i,{detail:{ctx:this._getCtxName(),type:i,data:t}}))}emit(e,t,{debounce:i}={}){if(typeof i!="number"&&!i){this._dispatch(e,t);return}this._timeoutStore.has(e)&&window.clearTimeout(this._timeoutStore.get(e));let r=typeof i=="number"?i:20,o=window.setTimeout(()=>{this._dispatch(e,t),this._timeoutStore.delete(e)},r);this._timeoutStore.set(e,o)}};function L(s,e){let t,i=(...r)=>{clearTimeout(t),t=setTimeout(()=>s(...r),e)};return i.cancel=()=>{clearTimeout(t)},i}var zs="--uploadcare-blocks-window-height",It=class{static registerClient(e){this.clientsRegistry.size===0&&this.attachTracker(),this.clientsRegistry.add(e)}static unregisterClient(e){this.clientsRegistry.delete(e),this.clientsRegistry.size===0&&this.detachTracker()}static attachTracker(){window.addEventListener("resize",this.flush,{passive:!0,capture:!0}),this.flush()}static detachTracker(){window.removeEventListener("resize",this.flush,{capture:!0}),document.documentElement.style.removeProperty(zs)}};d(It,"clientsRegistry",new Set),d(It,"flush",L(()=>{document.documentElement.style.setProperty(zs,`${window.innerHeight}px`)},100));var ci=(s,e)=>new Intl.PluralRules(s).select(e);var En=s=>s,Zi="{{",Gs="}}",Hs="plural:";function fe(s,e,t={}){let{openToken:i=Zi,closeToken:r=Gs,transform:o=En}=t;for(let n in e){let a=e[n]?.toString();s=s.replaceAll(i+n+r,typeof a=="string"?o(a):a)}return s}function Xs(s){let e=[],t=s.indexOf(Zi);for(;t!==-1;){let i=s.indexOf(Gs,t),r=s.substring(t+2,i);if(r.startsWith(Hs)){let o=s.substring(t+2,i).replace(Hs,""),n=o.substring(0,o.indexOf("(")),a=o.substring(o.indexOf("(")+1,o.indexOf(")"));e.push({variable:r,pluralKey:n,countVariable:a})}t=s.indexOf(Zi,i)}return e}var rt=s=>s.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g)?.map(e=>e.toLowerCase()).join("-");var di=({element:s,attribute:e,onSuccess:t,onTimeout:i,timeout:r=300})=>{let o=s.getAttribute(e);if(o!==null){t(o);return}let n=new MutationObserver(c=>{let u=c[c.length-1];l(u)});n.observe(s,{attributes:!0,attributeFilter:[e]});let a=setTimeout(()=>{n.disconnect(),i()},r),l=c=>{let u=s.getAttribute(e);c.type==="attributes"&&c.attributeName===e&&u!==null&&(clearTimeout(a),n.disconnect(),t(u))}};var js=new Set;function be(s){js.has(s)||(js.add(s),console.warn(s))}var Ji=()=>({"*blocksRegistry":new Set,"*eventEmitter":null}),Qi=s=>({...Ji(),"*currentActivity":"","*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{s.set$({"*modalActive":!1,"*currentActivity":""})},"*headerTitle":window.UploadCareLocales?.actions.uploadImages||"Upload images"}),ui=s=>({...Qi(s),"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null,"*uploadMetadata":null,"*uploadQueue":new ti(1),"*uploadCollection":null});function Ks(s,e){[...s.querySelectorAll("[l10n]")].forEach(t=>{let i=t.getAttribute("l10n"),r="textContent";if(i.includes(":")){let n=i.split(":");r=n[0],i=n[1]}let o="l10n:"+i;e.__l10nKeys.push(o),e.add(o,i),e.sub(o,n=>{t[r]=e.l10n(n)}),t.removeAttribute("l10n")})}var X=s=>`*cfg/${s}`;var ts="lr-",_=class extends kt{constructor(){super();d(this,"requireCtxName",!1);d(this,"allowCustomTemplate",!0);d(this,"init$",Ji());d(this,"updateCtxCssData",()=>{be("Using CSS variables for configuration is deprecated. Please use `lr-config` instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/");let t=this.$["*blocksRegistry"];for(let i of t)i.isConnected&&i.updateCssData()});this.activityType=null,this.addTemplateProcessor(Ks),this.__l10nKeys=[]}l10n(t,i={}){if(!t)return"";let r=this.getCssData("--l10n-"+t,!0)||t,o=Xs(r);for(let a of o)i[a.variable]=this.pluralize(a.pluralKey,Number(i[a.countVariable]));return fe(r,i)}pluralize(t,i){let r=this.l10n("locale-name")||"en-US",o=ci(r,i);return this.l10n(`${t}__${o}`)}emit(t,i,r){let o=this.has("*eventEmitter")&&this.$["*eventEmitter"];o&&o.emit(t,i,r)}applyL10nKey(t,i){let r="l10n:"+t;this.$[r]=i,this.__l10nKeys.push(t)}hasBlockInCtx(t){let i=this.$["*blocksRegistry"];for(let r of i)if(t(r))return!0;return!1}setOrAddState(t,i){this.add$({[t]:i},!0)}setActivity(t){if(this.hasBlockInCtx(i=>i.activityType===t)){this.$["*currentActivity"]=t;return}console.warn(`Activity type "${t}" not found in the context`)}connectedCallback(){let t=this.constructor.className;t&&this.classList.toggle(`${ts}${t}`,!0),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?di({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback(),It.registerClient(this)}disconnectedCallback(){super.disconnectedCallback(),It.unregisterClient(this)}initCallback(){this.$["*blocksRegistry"].add(this),this.$["*eventEmitter"]||(this.$["*eventEmitter"]=new li(()=>this.ctxName))}destroyCallback(){let t=this.$["*blocksRegistry"];t.delete(this),w.deleteCtx(this),t.size===0&&setTimeout(()=>{this.destroyCtxCallback()},0)}destroyCtxCallback(){w.deleteCtx(this.ctxName)}fileSizeFmt(t,i=2){let r=["B","KB","MB","GB","TB"],o=c=>this.getCssData("--l10n-unit-"+c.toLowerCase(),!0)||c;if(t===0)return`0 ${o(r[0])}`;let n=1024,a=i<0?0:i,l=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/n**l).toFixed(a))+" "+o(r[l])}proxyUrl(t){let i=this.cfg.secureDeliveryProxy;return i?fe(i,{previewUrl:t},{transform:r=>window.encodeURIComponent(r)}):t}parseCfgProp(t){return{ctx:this.nodeCtx,name:t.replace("*","")}}get cfg(){if(!this.__cfgProxy){let t=Object.create(null);this.__cfgProxy=new Proxy(t,{set:(i,r,o)=>{if(typeof r!="string")return!1;let n=X(r);return this.$[n]=o,!0},get:(i,r)=>{let o=X(r),n=this.parseCfgProp(o);return n.ctx.has(n.name)?n.ctx.read(n.name):(be("Using CSS variables for configuration is deprecated. Please use `lr-config` instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.getCssData(`--cfg-${rt(r)}`))}})}return this.__cfgProxy}subConfigValue(t,i){let r=this.parseCfgProp(X(t));r.ctx.has(r.name)?this.sub(X(t),i):(this.bindCssData(`--cfg-${rt(t)}`),this.sub(`--cfg-${rt(t)}`,i))}static reg(t){if(!t){super.reg();return}super.reg(t.startsWith(ts)?t:ts+t)}};d(_,"StateConsumerScope",null),d(_,"className","");var Ws="active",ge="___ACTIVITY_IS_ACTIVE___",tt=class tt extends _{constructor(){super(...arguments);d(this,"historyTracked",!1);d(this,"init$",Qi(this));d(this,"_debouncedHistoryFlush",L(this._historyFlush.bind(this),10))}_deactivate(){let t=tt._activityRegistry[this.activityKey];this[ge]=!1,this.removeAttribute(Ws),t?.deactivateCallback?.()}_activate(){let t=tt._activityRegistry[this.activityKey];this.$["*historyBack"]=this.historyBack.bind(this),this[ge]=!0,this.setAttribute(Ws,""),t?.activateCallback?.(),this._debouncedHistoryFlush()}initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",t=>{this.setAttribute("current-activity",t)}),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",t=>{this.activityType!==t&&this[ge]?this._deactivate():this.activityType===t&&!this[ge]&&this._activate(),t||(this.$["*history"]=[])}),this.has("*modalActive")&&this.sub("*modalActive",t=>{!t&&this.activityType===this.$["*currentActivity"]&&(this.$["*currentActivity"]=null)}))}_historyFlush(){let t=this.$["*history"];t&&(t.length>10&&(t=t.slice(t.length-11,t.length-1)),this.historyTracked&&t[t.length-1]!==this.activityType&&t.push(this.activityType),this.$["*history"]=t)}_isActivityRegistered(){return this.activityType&&!!tt._activityRegistry[this.activityKey]}get isActivityActive(){return this[ge]}get couldOpenActivity(){return!0}registerActivity(t,i={}){let{onActivate:r,onDeactivate:o}=i;tt._activityRegistry||(tt._activityRegistry=Object.create(null)),tt._activityRegistry[this.activityKey]={activateCallback:r,deactivateCallback:o}}unregisterActivity(){this.isActivityActive&&this._deactivate(),tt._activityRegistry[this.activityKey]=void 0}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity(),Object.keys(tt._activityRegistry).length===0&&(this.$["*currentActivity"]=null)}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let t=this.$["*history"];if(t){let i=t.pop();for(;i===this.activityType;)i=t.pop();let r=!!i;i&&(r=[...this.$["*blocksRegistry"]].find(a=>a.activityType===i)?.couldOpenActivity??!1),i=r?i:void 0,this.$["*currentActivity"]=i,this.$["*history"]=t,i||this.setOrAddState("*modalActive",!1)}}};d(tt,"_activityRegistry",Object.create(null));var b=tt;b.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",MTN_ACCEPT_SCREEN:"mtn-accept-screen",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details",END_SCREEN:"end-screen"});var _e=33.333333333333336,C=1,es=24,qs=6;function ft(s,e){for(let t in e)s.setAttributeNS(null,t,e[t].toString())}function Y(s,e={}){let t=document.createElementNS("http://www.w3.org/2000/svg",s);return ft(t,e),t}function Ys(s,e,t){let{x:i,y:r,width:o,height:n}=s,a=e.includes("w")?0:1,l=e.includes("n")?0:1,c=[-1,1][a],u=[-1,1][l],p=[i+a*o+1.5*c,r+l*n+1.5*u-24*t*u],h=[i+a*o+1.5*c,r+l*n+1.5*u],f=[i+a*o-24*t*c+1.5*c,r+l*n+1.5*u];return{d:`M ${p[0]} ${p[1]} L ${h[0]} ${h[1]} L ${f[0]} ${f[1]}`,center:h}}function Zs(s,e,t){let{x:i,y:r,width:o,height:n}=s,a=["n","s"].includes(e)?.5:{w:0,e:1}[e],l=["w","e"].includes(e)?.5:{n:0,s:1}[e],c=[-1,1][a],u=[-1,1][l],p,h;["n","s"].includes(e)?(p=[i+a*o-34*t/2,r+l*n+1.5*u],h=[i+a*o+34*t/2,r+l*n+1.5*u]):(p=[i+a*o+1.5*c,r+l*n-34*t/2],h=[i+a*o+1.5*c,r+l*n+34*t/2]);let f=`M ${p[0]} ${p[1]} L ${h[0]} ${h[1]}`,m=[h[0]-(h[0]-p[0])/2,h[1]-(h[1]-p[1])/2];return{d:f,center:m}}function Js(s){return s===""?"move":["e","w"].includes(s)?"ew-resize":["n","s"].includes(s)?"ns-resize":["nw","se"].includes(s)?"nwse-resize":"nesw-resize"}function Qs({rect:s,delta:[e,t],imageBox:i}){return zt({...s,x:s.x+e,y:s.y+t},i)}function zt(s,e){let{x:t}=s,{y:i}=s;return s.x<e.x?t=e.x:s.x+s.width>e.x+e.width&&(t=e.x+e.width-s.width),s.y<e.y?i=e.y:s.y+s.height>e.y+e.height&&(i=e.y+e.height-s.height),{...s,x:t,y:i}}function An({rect:s,delta:e,aspectRatio:t,imageBox:i}){let[,r]=e,{y:o,width:n,height:a}=s;o+=r,a-=r,t&&(n=a*t);let l=s.x+s.width/2-n/2;return o<=i.y&&(o=i.y,a=s.y+s.height-o,t&&(n=a*t,l=s.x+s.width/2-n/2)),l<=i.x&&(l=i.x,o=s.y+s.height-a),l+n>=i.x+i.width&&(l=Math.max(i.x,i.x+i.width-n),n=i.x+i.width-l,t&&(a=n/t),o=s.y+s.height-a),a<C&&(a=C,t&&(n=a*t,l=s.x+s.width/2-n/2),o=s.y+s.height-a),n<C&&(n=C,t&&(a=n/t,l=s.x+s.width/2-n/2),o=s.y+s.height-a),{x:l,y:o,width:n,height:a}}function xn({rect:s,delta:e,aspectRatio:t,imageBox:i}){let[r]=e,{x:o,width:n,height:a}=s;o+=r,n-=r,t&&(a=n/t);let l=s.y+s.height/2-a/2;return o<=i.x&&(o=i.x,n=s.x+s.width-o,t&&(a=n/t,l=s.y+s.height/2-a/2)),l<=i.y&&(l=i.y,o=s.x+s.width-n),l+a>=i.y+i.height&&(l=Math.max(i.y,i.y+i.height-a),a=i.y+i.height-l,t&&(n=a*t),o=s.x+s.width-n),a<C&&(a=C,t&&(n=a*t),l=s.y+s.height/2-a/2,o=s.x+s.width-n),n<C&&(n=C,t&&(a=n/t),l=s.y+s.height/2-a/2,o=s.x+s.width-n),{x:o,y:l,width:n,height:a}}function wn({rect:s,delta:e,aspectRatio:t,imageBox:i}){let[,r]=e,{y:o,width:n,height:a}=s;a+=r,t&&(n=a*t);let l=s.x+s.width/2-n/2;return o+a>=i.y+i.height&&(a=i.y+i.height-o,t&&(n=a*t),l=s.x+s.width/2-n/2),l<=i.x&&(l=i.x,o=s.y),l+n>=i.x+i.width&&(l=Math.max(i.x,i.x+i.width-n),n=i.x+i.width-l,t&&(a=n/t),o=s.y),a<C&&(a=C,t&&(n=a*t),l=s.x+s.width/2-n/2),n<C&&(n=C,t&&(a=n/t),l=s.x+s.width/2-n/2),{x:l,y:o,width:n,height:a}}function Tn({rect:s,delta:e,aspectRatio:t,imageBox:i}){let[r]=e,{x:o,width:n,height:a}=s;n+=r,t&&(a=n/t);let l=s.y+s.height/2-a/2;return o+n>=i.x+i.width&&(n=i.x+i.width-o,t&&(a=n/t),l=s.y+s.height/2-a/2),l<=i.y&&(l=i.y,o=s.x),l+a>=i.y+i.height&&(l=Math.max(i.y,i.y+i.height-a),a=i.y+i.height-l,t&&(n=a*t),o=s.x),a<C&&(a=C,t&&(n=a*t),l=s.y+s.height/2-a/2),n<C&&(n=C,t&&(a=n/t),l=s.y+s.height/2-a/2),{x:o,y:l,width:n,height:a}}function On({rect:s,delta:e,aspectRatio:t,imageBox:i}){let[r,o]=e,{x:n,y:a,width:l,height:c}=s;return n+r<i.x&&(r=i.x-n),a+o<i.y&&(o=i.y-a),n+=r,l-=r,a+=o,c-=o,t&&Math.abs(l/c)>t?(o=l/t-c,c+=o,a-=o,a<=i.y&&(c=c-(i.y-a),l=c*t,n=s.x+s.width-l,a=i.y)):t&&(r=c*t-l,l=l+r,n-=r,n<=i.x&&(l=l-(i.x-n),c=l/t,n=i.x,a=s.y+s.height-c)),c<C&&(c=C,t&&(l=c*t),n=s.x+s.width-l,a=s.y+s.height-c),l<C&&(l=C,t&&(c=l/t),n=s.x+s.width-l,a=s.y+s.height-c),{x:n,y:a,width:l,height:c}}function Sn({rect:s,delta:e,aspectRatio:t,imageBox:i}){let[r,o]=e,{x:n,y:a,width:l,height:c}=s;return n+l+r>i.x+i.width&&(r=i.x+i.width-n-l),a+o<i.y&&(o=i.y-a),l+=r,a+=o,c-=o,t&&Math.abs(l/c)>t?(o=l/t-c,c+=o,a-=o,a<=i.y&&(c=c-(i.y-a),l=c*t,n=s.x,a=i.y)):t&&(r=c*t-l,l+=r,n+l>=i.x+i.width&&(l=i.x+i.width-n,c=l/t,n=i.x+i.width-l,a=s.y+s.height-c)),c<C&&(c=C,t&&(l=c*t),a=s.y+s.height-c),l<C&&(l=C,t&&(c=l/t),a=s.y+s.height-c),{x:n,y:a,width:l,height:c}}function Ln({rect:s,delta:e,aspectRatio:t,imageBox:i}){let[r,o]=e,{x:n,y:a,width:l,height:c}=s;return n+r<i.x&&(r=i.x-n),a+c+o>i.y+i.height&&(o=i.y+i.height-a-c),n+=r,l-=r,c+=o,t&&Math.abs(l/c)>t?(o=l/t-c,c+=o,a+c>=i.y+i.height&&(c=i.y+i.height-a,l=c*t,n=s.x+s.width-l,a=i.y+i.height-c)):t&&(r=c*t-l,l+=r,n-=r,n<=i.x&&(l=l-(i.x-n),c=l/t,n=i.x,a=s.y)),c<C&&(c=C,t&&(l=c*t),n=s.x+s.width-l),l<C&&(l=C,t&&(c=l/t),n=s.x+s.width-l),{x:n,y:a,width:l,height:c}}function kn({rect:s,delta:e,aspectRatio:t,imageBox:i}){let[r,o]=e,{x:n,y:a,width:l,height:c}=s;return n+l+r>i.x+i.width&&(r=i.x+i.width-n-l),a+c+o>i.y+i.height&&(o=i.y+i.height-a-c),l+=r,c+=o,t&&Math.abs(l/c)>t?(o=l/t-c,c+=o,a+c>=i.y+i.height&&(c=i.y+i.height-a,l=c*t,n=s.x,a=i.y+i.height-c)):t&&(r=c*t-l,l+=r,n+l>=i.x+i.width&&(l=i.x+i.width-n,c=l/t,n=i.x+i.width-l,a=s.y)),c<C&&(c=C,t&&(l=c*t)),l<C&&(l=C,t&&(c=l/t)),{x:n,y:a,width:l,height:c}}function tr({direction:s,...e}){switch(s){case"n":return An(e);case"w":return xn(e);case"s":return wn(e);case"e":return Tn(e);case"nw":return On(e);case"ne":return Sn(e);case"sw":return Ln(e);case"se":return kn(e);default:return e.rect}}function er(s,[e,t]){return s.x<=e&&e<=s.x+s.width&&s.y<=t&&t<=s.y+s.height}function ir(s,e){return s.x>=e.x&&s.y>=e.y&&s.x+s.width<=e.x+e.width&&s.y+s.height<=e.y+e.height}function sr(s,e){return Math.abs(s.width/s.height-e)<.1}function Ht({width:s,height:e},t){let i=t/90%2!==0;return{width:i?e:s,height:i?s:e}}function rr(s,e,t){let i=s/e,r,o;i>t?(r=Math.round(e*t),o=e):(r=s,o=Math.round(s/t));let n=Math.round((s-r)/2),a=Math.round((e-o)/2);return n+r>s&&(r=s-n),a+o>e&&(o=e-a),{x:n,y:a,width:r,height:o}}function Gt(s){return{x:Math.round(s.x),y:Math.round(s.y),width:Math.round(s.width),height:Math.round(s.height)}}function Ct(s,e,t){return Math.min(Math.max(s,e),t)}var pi=s=>{if(!s)return[];let[e,t]=s.split(":").map(Number);if(!Number.isFinite(e)||!Number.isFinite(t)){console.error(`Invalid crop preset: ${s}`);return}return[{type:"aspect-ratio",width:e,height:t}]};var Z=Object.freeze({LOCAL:"local",DROP_AREA:"drop-area",URL_TAB:"url-tab",CAMERA:"camera",EXTERNAL:"external",API:"js-api"});var or=s=>s?s.split(",").map(e=>e.trim()):[],Rt=s=>s?s.join(","):"";var is="blocks",ss="0.30.8";function nr(s){return Vi({...s,libraryName:is,libraryVersion:ss})}var ar=s=>{if(typeof s!="string"||!s)return"";let e=s.trim();return e.startsWith("-/")?e=e.slice(2):e.startsWith("/")&&(e=e.slice(1)),e.endsWith("/")&&(e=e.slice(0,e.length-1)),e},mi=(...s)=>s.filter(e=>typeof e=="string"&&e).map(e=>ar(e)).join("/-/"),M=(...s)=>{let e=mi(...s);return e?`-/${e}/`:""};function lr(s){let e=new URL(s),t=e.pathname+e.search+e.hash,i=t.lastIndexOf("http"),r=t.lastIndexOf("/"),o="";return i>=0?o=t.slice(i):r>=0&&(o=t.slice(r+1)),o}function cr(s){let e=new URL(s),{pathname:t}=e,i=t.indexOf("/"),r=t.indexOf("/",i+1);return t.substring(i+1,r)}function dr(s){let e=ur(s),t=new URL(e),i=t.pathname.indexOf("/-/");return i===-1?[]:t.pathname.substring(i).split("/-/").filter(Boolean).map(o=>ar(o))}function ur(s){let e=new URL(s),t=lr(s),i=hr(t)?pr(t).pathname:t;return e.pathname=e.pathname.replace(i,""),e.search="",e.hash="",e.toString()}function hr(s){return s.startsWith("http")}function pr(s){let e=new URL(s);return{pathname:e.origin+e.pathname||"",search:e.search||"",hash:e.hash||""}}var I=(s,e,t)=>{let i=new URL(ur(s));if(t=t||lr(s),i.pathname.startsWith("//")&&(i.pathname=i.pathname.replace("//","/")),hr(t)){let r=pr(t);i.pathname=i.pathname+(e||"")+(r.pathname||""),i.search=r.search,i.hash=r.hash}else i.pathname=i.pathname+(e||"")+(t||"");return i.toString()},Et=(s,e)=>{let t=new URL(s);return t.pathname=e+"/",t.toString()};var D=(s,e=",")=>s.trim().split(e).map(t=>t.trim()).filter(t=>t.length>0);var ve=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],mr=[".svg",".svgz","image/svg+xml","image/svg+xml-compressed"],fi=s=>s?s.filter(e=>typeof e=="string").map(e=>D(e)).flat():[],rs=(s,e,t=[])=>e.some(i=>i.endsWith("*")?(i=i.replace("*",""),t.some(r=>s.startsWith(r))?!1:s.startsWith(i)):t.some(r=>s===r)?!1:s===i),fr=(s,e,t=[])=>e.some(i=>!i.startsWith(".")||t.some(r=>s.toLowerCase().endsWith(r.toLowerCase()))?!1:s.toLowerCase().endsWith(i.toLowerCase())),ye=s=>{let e=s?.type;return e?rs(e,ve):!1};var nt=1e3,$t=Object.freeze({AUTO:"auto",BYTE:"byte",KB:"kb",MB:"mb",GB:"gb",TB:"tb",PB:"pb"}),Ce=s=>Math.ceil(s*100)/100,Ee=(s,e=$t.AUTO)=>{let t=e===$t.AUTO;if(e===$t.BYTE||t&&s<nt**1){let i=ci("en-US",s),r={one:"byte",other:"bytes"}[i];return`${s} ${r}`}return e===$t.KB||t&&s<nt**2?`${Ce(s/nt**1)} KB`:e===$t.MB||t&&s<nt**3?`${Ce(s/nt**2)} MB`:e===$t.GB||t&&s<nt**4?`${Ce(s/nt**3)} GB`:e===$t.TB||t&&s<nt**5?`${Ce(s/nt**4)} TB`:`${Ce(s/nt**5)} PB`};var br="[Typed State] Wrong property name: ",In="[Typed State] Wrong property type: ",bi=class{constructor(e,t){this.__typedSchema=e,this.__ctxId=t||pe.generate(),this.__schema=Object.keys(e).reduce((i,r)=>(i[r]=e[r].value,i),{}),this.__data=w.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(e,t){if(!this.__typedSchema.hasOwnProperty(e)){console.warn(br+e);return}let i=this.__typedSchema[e];if(t?.constructor===i.type||t instanceof i.type||i.nullable&&t===null){this.__data.pub(e,t);return}console.warn(In+e)}setMultipleValues(e){for(let t in e)this.setValue(t,e[t])}getValue(e){if(!this.__typedSchema.hasOwnProperty(e)){console.warn(br+e);return}return this.__data.read(e)}subscribe(e,t){return this.__data.sub(e,t)}remove(){w.deleteCtx(this.__ctxId)}};var gi=class{constructor(e){this.__typedSchema=e.typedSchema,this.__ctxId=e.ctxName||pe.generate(),this.__data=w.registerCtx({},this.__ctxId),this.__watchList=e.watchList||[],this.__subsMap=Object.create(null),this.__propertyObservers=new Set,this.__collectionObservers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let t=Object.create(null);this.__notifyObservers=(i,r)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[i]||(t[i]=new Set),t[i].add(r),this.__observeTimeout=window.setTimeout(()=>{Object.keys(t).length!==0&&(this.__propertyObservers.forEach(o=>{o({...t})}),t=Object.create(null))})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{let e=new Set(this.__added),t=new Set(this.__removed);this.__added.clear(),this.__removed.clear();for(let i of this.__collectionObservers)i?.([...this.__items],e,t)})}observeCollection(e){return this.__collectionObservers.add(e),this.notify(),()=>{this.unobserveCollection(e)}}unobserveCollection(e){this.__collectionObservers?.delete(e)}add(e){let t=new bi(this.__typedSchema);for(let i in e)t.setValue(i,e[i]);return this.__data.add(t.uid,t),this.__added.add(t),this.__watchList.forEach(i=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(i,()=>{this.__notifyObservers(i,t.uid)}))}),this.__items.add(t.uid),this.notify(),t}duplicate(e){let t=this.read(e);return this.add({externalUrl:t.getValue("cdnUrl"),fileName:null,silentUpload:!1,source:"url-tab"})}read(e){return this.__data.read(e)}readProp(e,t){return this.read(e).getValue(t)}publishProp(e,t,i){this.read(e).setValue(t,i)}remove(e){this.__removed.add(this.__data.read(e)),this.__items.delete(e),this.notify(),this.__data.pub(e,null),delete this.__subsMap[e]}clearAll(){this.__items.forEach(e=>{this.remove(e)})}observeProperties(e){return this.__propertyObservers.add(e),()=>{this.unobserveProperties(e)}}unobserveProperties(e){this.__propertyObservers?.delete(e)}findItems(e){let t=[];return this.__items.forEach(i=>{let r=this.read(i);e(r)&&t.push(i)}),t}items(){return[...this.__items]}indexOf(e){return[...this.__items].indexOf(e)}get size(){return this.__items.size}destroy(){w.deleteCtx(this.__ctxId),this.__propertyObservers=null,this.__collectionObservers=null;for(let e in this.__subsMap)this.__subsMap[e].forEach(t=>{t.remove()}),delete this.__subsMap[e]}};var gr=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null,nullable:!0},fileSize:{type:Number,value:null,nullable:!0},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null,nullable:!0},uploadError:{type:Error,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},validationMultipleLimitMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:ht,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0},silentUpload:{type:Boolean,value:!1},source:{type:String,value:!1,nullable:!0},fullPath:{type:String,value:null,nullable:!0}});var E=class s extends b{constructor(){super(...arguments);d(this,"couldBeCtxOwner",!1);d(this,"isCtxOwner",!1);d(this,"init$",ui(this));d(this,"__initialUploadMetadata",null);d(this,"_validators",[this._validateIsImage.bind(this),this._validateFileType.bind(this),this._validateMaxSizeLimit.bind(this)]);d(this,"_debouncedRunValidators",L(this._runValidators.bind(this),100));d(this,"_flushOutputItems",L(()=>{let t=this.getOutputData();t.length===this.uploadCollection.size&&(this.emit(S.DATA_OUTPUT,t),this.$["*outputData"]=t)},100));d(this,"_handleCollectonUpdate",(t,i,r)=>{this._runValidators();for(let o of r)o?.getValue("abortController")?.abort(),o?.setValue("abortController",null),URL.revokeObjectURL(o?.getValue("thumbUrl"));this.$["*uploadList"]=t.map(o=>({uid:o})),this._flushOutputItems()});d(this,"_handleCollectionPropertiesUpdate",t=>{this._flushOutputItems();let i=this.uploadCollection,r=[...new Set(Object.values(t).map(o=>[...o]).flat())].map(o=>i.read(o)).filter(Boolean);for(let o of r)this._runValidatorsForEntry(o);if(t.uploadProgress){let o=0,n=i.findItems(l=>!l.getValue("uploadError"));n.forEach(l=>{o+=i.readProp(l,"uploadProgress")});let a=Math.round(o/n.length);this.$["*commonProgress"]=a,this.emit(S.UPLOAD_PROGRESS,a,{debounce:!0})}if(t.fileInfo){this.cfg.cropPreset&&this.setInitialCrop();let o=i.findItems(a=>!!a.getValue("fileInfo")),n=i.findItems(a=>!!a.getValue("uploadError")||!!a.getValue("validationErrorMsg"));if(i.size-n.length===o.length){let a=this.getOutputData(l=>!!l.getValue("fileInfo")&&!l.getValue("silentUpload"));a.length>0&&this.emit(S.UPLOAD_FINISH,a,{debounce:!0})}}t.uploadError&&i.findItems(n=>!!n.getValue("uploadError")).forEach(n=>{this.emit(S.UPLOAD_ERROR,i.readProp(n,"uploadError"))}),t.validationErrorMsg&&i.findItems(n=>!!n.getValue("validationErrorMsg")).forEach(n=>{this.emit(S.VALIDATION_ERROR,i.readProp(n,"validationErrorMsg"))}),t.cdnUrlModifiers&&i.findItems(n=>!!n.getValue("cdnUrlModifiers")).forEach(n=>{this.emit(S.CLOUD_MODIFICATION,i.readProp(n,"cdnUrlModifiers"))})})}setUploadMetadata(t){be("setUploadMetadata is deprecated. Use `metadata` instance property on `lr-config` block instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.connectedOnce?this.$["*uploadMetadata"]=t:this.__initialUploadMetadata=t}get hasCtxOwner(){return this.hasBlockInCtx(t=>t instanceof s?t.isCtxOwner&&t.isConnected&&t!==this:!1)}initCallback(){if(super.initCallback(),!this.$["*uploadCollection"]){let t=new gi({typedSchema:gr,watchList:["uploadProgress","fileInfo","uploadError","validationErrorMsg","validationMultipleLimitMsg","cdnUrlModifiers"]});this.$["*uploadCollection"]=t}!this.hasCtxOwner&&this.couldBeCtxOwner&&this.initCtxOwner()}destroyCtxCallback(){this._unobserveCollectionProperties?.(),this._unobserveCollection?.(),this.uploadCollection.destroy(),this.$["*uploadCollection"]=null,super.destroyCtxCallback()}initCtxOwner(){this.isCtxOwner=!0,this._unobserveCollection=this.uploadCollection.observeCollection(this._handleCollectonUpdate),this._unobserveCollectionProperties=this.uploadCollection.observeProperties(this._handleCollectionPropertiesUpdate),this.subConfigValue("maxLocalFileSizeBytes",()=>this._debouncedRunValidators()),this.subConfigValue("multipleMin",()=>this._debouncedRunValidators()),this.subConfigValue("multipleMax",()=>this._debouncedRunValidators()),this.subConfigValue("multiple",()=>this._debouncedRunValidators()),this.subConfigValue("imgOnly",()=>this._debouncedRunValidators()),this.subConfigValue("accept",()=>this._debouncedRunValidators()),this.subConfigValue("maxConcurrentRequests",t=>{this.$["*uploadQueue"].concurrency=Number(t)||1}),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata)}addFileFromUrl(t,{silent:i,fileName:r,source:o}={}){this.uploadCollection.add({externalUrl:t,fileName:r??null,silentUpload:i??!1,source:o??Z.API})}addFileFromUuid(t,{silent:i,fileName:r,source:o}={}){this.uploadCollection.add({uuid:t,fileName:r??null,silentUpload:i??!1,source:o??Z.API})}addFileFromObject(t,{silent:i,fileName:r,source:o,fullPath:n}={}){this.uploadCollection.add({file:t,isImage:ye(t),mimeType:t.type,fileName:r??t.name,fileSize:t.size,silentUpload:i??!1,source:o??Z.API,fullPath:n??null})}addFiles(t){console.warn("`addFiles` method is deprecated. Please use `addFileFromObject`, `addFileFromUrl` or `addFileFromUuid` instead."),t.forEach(i=>{this.uploadCollection.add({file:i,isImage:ye(i),mimeType:i.type,fileName:i.name,fileSize:i.size})})}uploadAll(){this.$["*uploadTrigger"]={}}openSystemDialog(t={}){let i=Rt(fi([this.cfg.accept??"",...this.cfg.imgOnly?ve:[]]));this.cfg.accept&&this.cfg.imgOnly&&console.warn("There could be a mistake.\nBoth `accept` and `imgOnly` parameters are set.\nThe value of `accept` will be concatenated with the internal image mime types list.");let r=this.cfg.multipleMax-this.uploadCollection.size;r<=0||(this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=this.cfg.multiple,t.captureCamera?(this.fileInput.capture="",this.fileInput.accept=Rt(ve)):this.fileInput.accept=i,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{[...this.fileInput.files].slice(0,r).forEach(o=>this.addFileFromObject(o,{source:Z.LOCAL})),this.$["*currentActivity"]=b.activities.UPLOAD_LIST,this.setOrAddState("*modalActive",!0),this.fileInput.value="",this.fileInput=null})}get sourceList(){let t=[];return this.cfg.sourceList&&(t=D(this.cfg.sourceList)),t}initFlow(t=!1){if(this.uploadCollection.size>0&&!t)this.set$({"*currentActivity":b.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0);else if(this.sourceList?.length===1){let i=this.sourceList[0];i==="local"?(this.$["*currentActivity"]=b.activities.UPLOAD_LIST,this?.openSystemDialog()):(Object.values(s.extSrcList).includes(i)?this.set$({"*currentActivityParams":{externalSourceType:i},"*currentActivity":b.activities.EXTERNAL}):this.$["*currentActivity"]=i,this.setOrAddState("*modalActive",!0))}else this.set$({"*currentActivity":b.activities.START_FROM}),this.setOrAddState("*modalActive",!0);this.emit(S.INIT_FLOW)}doneFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setOrAddState("*modalActive",!1),this.emit(S.DONE_FLOW)}get uploadCollection(){return this.$["*uploadCollection"]}_validateFileType(t){let i=this.cfg.imgOnly,r=this.cfg.accept,o=fi([...i?ve:[],r]),n=fi([...i?mr:[]]);if(!o.length)return;let a=t.getValue("mimeType"),l=t.getValue("fileName");if(!a||!l)return;let c=rs(a,o,n),u=fr(l,o,n);if(!c&&!u)return this.l10n("file-type-not-allowed")}_validateMaxSizeLimit(t){let i=this.cfg.maxLocalFileSizeBytes,r=t.getValue("fileSize");if(i&&r&&r>i)return this.l10n("files-max-size-limit-error",{maxFileSize:Ee(i)})}_validateMultipleLimit(t){let i=this.uploadCollection.items(),r=i.indexOf(t.uid),o=this.cfg.multiple?this.cfg.multipleMin:1,n=this.cfg.multiple?this.cfg.multipleMax:1;if(o&&i.length<o)return this.l10n("files-count-minimum",{count:o});if(n&&r>=n)return this.l10n("files-count-allowed",{count:n})}_validateIsImage(t){let i=this.cfg.imgOnly,r=t.getValue("isImage");if(!(!i||r)&&!(!t.getValue("fileInfo")&&t.getValue("externalUrl"))&&!(!t.getValue("fileInfo")&&!t.getValue("mimeType")))return this.l10n("images-only-accepted")}_runValidatorsForEntry(t){for(let i of this._validators){let r=i(t);if(r){t.setValue("validationErrorMsg",r);return}}t.setValue("validationErrorMsg",null)}_runValidators(){for(let t of this.uploadCollection.items())setTimeout(()=>{let i=this.uploadCollection.read(t);i&&this._runValidatorsForEntry(i)})}setInitialCrop(){let t=pi(this.cfg.cropPreset);if(t){let[i]=t,r=this.uploadCollection.findItems(o=>o.getValue("fileInfo")&&o.getValue("isImage")&&!o.getValue("cdnUrlModifiers")).map(o=>this.uploadCollection.read(o));for(let o of r){let n=o.getValue("fileInfo"),{width:a,height:l}=n.imageInfo,c=i.width/i.height,u=rr(a,l,c),p=M(`crop/${u.width}x${u.height}/${u.x},${u.y}`,"preview");o.setMultipleValues({cdnUrlModifiers:p,cdnUrl:I(o.getValue("cdnUrl"),p)})}}}async getMetadataFor(t){let i=this.cfg.metadata??this.$["*uploadMetadata"];if(typeof i=="function"){let r=this.getOutputItem(t);return await i(r)}return i}getUploadClientOptions(){return{store:this.cfg.store,publicKey:this.cfg.pubkey,baseCDN:this.cfg.cdnCname,baseURL:this.cfg.baseUrl,userAgent:nr,integration:this.cfg.userAgentIntegration,secureSignature:this.cfg.secureSignature,secureExpire:this.cfg.secureExpire,retryThrottledRequestMaxTimes:this.cfg.retryThrottledRequestMaxTimes,multipartMinFileSize:this.cfg.multipartMinFileSize,multipartChunkSize:this.cfg.multipartChunkSize,maxConcurrentRequests:this.cfg.multipartMaxConcurrentRequests,multipartMaxAttempts:this.cfg.multipartMaxAttempts,checkForUrlDuplicates:!!this.cfg.checkForUrlDuplicates,saveUrlForRecurrentUploads:!!this.cfg.saveUrlForRecurrentUploads}}getOutputItem(t){let i=w.getCtx(t).store,r=i.fileInfo||{name:i.fileName,originalFilename:i.fileName,size:i.fileSize,isImage:i.isImage,mimeType:i.mimeType};return{...r,file:i.file,externalUrl:i.externalUrl,cdnUrlModifiers:i.cdnUrlModifiers,cdnUrl:i.cdnUrl??r.cdnUrl??null,validationErrorMessage:i.validationErrorMsg,uploadError:i.uploadError,isUploaded:!!i.uuid&&!!i.fileInfo,isValid:!i.validationErrorMsg&&!i.uploadError,fullPath:i.fullPath,uploadProgress:i.uploadProgress}}getOutputData(t){return(t?this.uploadCollection.findItems(t):this.uploadCollection.items()).map(o=>this.getOutputItem(o))}};E.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});E.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...E.extSrcList});var W=Object.freeze({brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0,mirror:!1,flip:!1}),vr=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function Rn(s,e){if(typeof e=="number"){let t=e;return W[s]!==t?`${s}/${t}`:""}if(typeof e=="boolean"){let t=e;return W[s]!==t?`${s}`:""}if(s==="filter"&&e){let{name:t,amount:i}=e;return W.filter===i?"":`${s}/${t}/${i}`}if(s==="crop"&&e){let{dimensions:t,coords:i}=e;return`${s}/${t.join("x")}/${i.join(",")}`}return""}function At(s){return mi(...vr.filter(e=>typeof s[e]<"u"&&s[e]!==null).map(e=>{let t=s[e];return Rn(e,t)}).filter(e=>!!e))}var _i=mi("format/auto","progressive/yes"),bt=([s])=>typeof s<"u"?Number(s):void 0,_r=()=>!0,$n=([s,e])=>({name:s,amount:typeof e<"u"?Number(e):100}),Un=([s,e])=>{if(!/\d+x\d+/.test(s)||!/\d+,\d+/.test(e))throw new Error("Crop by aspect ratio, percentage or alignment shortcuts is not supported.");return{dimensions:D(s,"x").map(Number),coords:D(e).map(Number)}},Mn=Object.freeze({enhance:bt,brightness:bt,exposure:bt,gamma:bt,contrast:bt,saturation:bt,vibrance:bt,warmth:bt,filter:$n,mirror:_r,flip:_r,rotate:bt,crop:Un});function yr(s){let e={};for(let t of s){let[i,...r]=t.split("/");if(!vr.includes(i))continue;let o=i,n=Mn[o];try{let a=n(r);e[o]=a}catch(a){console.warn([`Failed to parse URL operation "${t}". It will be ignored.`,a instanceof Error?`Error message: "${a.message}"`:a,"If you need this functionality, please feel free to open an issue at https://github.com/uploadcare/blocks/issues/new"].join(` `))}}return e}var R=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),j=[R.CROP,R.TUNING,R.FILTERS],Cr=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],Er=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],Ar=["rotate","mirror","flip"],J=Object.freeze({brightness:{zero:W.brightness,range:[-100,100],keypointsNumber:2,label:window.UploadCareLocales?.editor.brightness||"Brightness"},exposure:{zero:W.exposure,range:[-500,500],keypointsNumber:2,label:window.UploadCareLocales?.editor.exposure||"Exposure"},gamma:{zero:W.gamma,range:[0,1e3],keypointsNumber:2,label:window.UploadCareLocales?.editor.gamma||"Gamma"},contrast:{zero:W.contrast,range:[-100,500],keypointsNumber:2,label:window.UploadCareLocales?.editor.contrast||"Contrast"},saturation:{zero:W.saturation,range:[-100,500],keypointsNumber:1,label:window.UploadCareLocales?.editor.saturation||"Saturation"},vibrance:{zero:W.vibrance,range:[-100,500],keypointsNumber:1,label:window.UploadCareLocales?.editor.vibrance||"Vibrance"},warmth:{zero:W.warmth,range:[-100,100],keypointsNumber:1,label:window.UploadCareLocales?.editor.warmth||"Warmth"},enhance:{zero:W.enhance,range:[0,100],keypointsNumber:1,label:window.UploadCareLocales?.editor.enhance||"Enhance"},filter:{zero:W.filter,range:[0,100],keypointsNumber:1,label:void 0}});var Dn="https://ucarecdn.com",Nn="https://upload.uploadcare.com",Pn="https://social.uploadcare.com",xt={pubkey:"",multiple:!0,multipleMin:0,multipleMax:0,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",store:"auto",cameraMirror:!1,sourceList:"local, url, camera, dropbox, gdrive",cloudImageEditorTabs:Rt(j),maxLocalFileSizeBytes:10*1024*1024,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:Dn,baseUrl:Nn,socialBaseUrl:Pn,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:1,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",metadata:null,ninemagskey:""};var F=s=>String(s),at=s=>{let e=Number(s);if(Number.isNaN(e))throw new Error(`Invalid number: "${s}"`);return e},k=s=>{if(typeof s>"u"||s===null)return!1;if(typeof s=="boolean")return s;if(s==="true"||s==="")return!0;if(s==="false")return!1;throw new Error(`Invalid boolean: "${s}"`)},Fn=s=>s==="auto"?s:k(s),Bn={pubkey:F,multiple:k,multipleMin:at,multipleMax:at,confirmUpload:k,imgOnly:k,accept:F,externalSourcesPreferredTypes:F,store:Fn,cameraMirror:k,sourceList:F,maxLocalFileSizeBytes:at,thumbSize:at,showEmptyList:k,useLocalImageEditor:k,useCloudImageEditor:k,cloudImageEditorTabs:F,removeCopyright:k,cropPreset:F,modalScrollLock:k,modalBackdropStrokes:k,sourceListWrap:k,remoteTabSessionKey:F,cdnCname:F,baseUrl:F,socialBaseUrl:F,secureSignature:F,secureExpire:F,secureDeliveryProxy:F,retryThrottledRequestMaxTimes:at,multipartMinFileSize:at,multipartChunkSize:at,maxConcurrentRequests:at,multipartMaxConcurrentRequests:at,multipartMaxAttempts:at,checkForUrlDuplicates:k,saveUrlForRecurrentUploads:k,groupOutput:k,userAgentIntegration:F,ninemagskey:F},xr=(s,e)=>{if(!(typeof e>"u"||e===null))try{return Bn[s](e)}catch(t){return console.error(`Invalid value for config key "${s}".`,t),xt[s]}};var vi=Object.keys(xt),Vn=["metadata"],zn=s=>Vn.includes(s),yi=vi.filter(s=>!zn(s)),Hn={...Object.fromEntries(yi.map(s=>[rt(s),s])),...Object.fromEntries(yi.map(s=>[s.toLowerCase(),s]))},Gn={...Object.fromEntries(vi.map(s=>[rt(s),X(s)])),...Object.fromEntries(vi.map(s=>[s.toLowerCase(),X(s)]))},Ci=class extends _{constructor(){super();d(this,"requireCtxName",!0);this.init$={...this.init$,...Object.fromEntries(Object.entries(xt).map(([t,i])=>[X(t),i]))}}initCallback(){super.initCallback();let t=this;for(let i of yi)this.sub(X(i),r=>{r!==xt[i]&&(t[i]=r)},!1);for(let i of vi){let r="__"+i;t[r]=t[i],Object.defineProperty(this,i,{set:o=>{if(t[r]=o,yi.includes(i)){let n=[...new Set([rt(i),i.toLowerCase()])];for(let a of n)typeof o>"u"||o===null?this.removeAttribute(a):this.setAttribute(a,o.toString())}this.$[X(i)]!==o&&(typeof o>"u"||o===null?this.$[X(i)]=xt[i]:this.$[X(i)]=o)},get:()=>this.$[X(i)]}),typeof t[i]<"u"&&t[i]!==null&&(t[i]=t[r])}}attributeChangedCallback(t,i,r){if(i===r)return;let o=Hn[t],a=xr(o,r)??xt[o],l=this;l[o]=a}};Ci.bindAttributes(Gn);var wr=Ci;var Xt=class extends _{constructor(){super(...arguments);d(this,"init$",{...this.init$,name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",t=>{if(!t)return;let i=this.getCssData(`--icon-${t}`);i&&(this.$.path=i)}),this.sub("path",t=>{if(!t)return;t.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=t):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${t}"></path>`)}),this.sub("size",t=>{this.$.viewBox=`0 0 ${t} ${t}`})}};Xt.template=`<svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>`;Xt.bindAttributes({name:"name",size:"size"});var Xn="https://ucarecdn.com",jt=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:Xn},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{},"cdn-operations":{},progressive:{},quality:{},"is-background-for":{}});var Tr=s=>[...new Set(s)];var Or=s=>Object.entries(s).filter(([e,t])=>t!==void 0&&t!=="").map(([e,t])=>e==="cdn-operations"?t:`${e}/${t}`);var Kt="--lr-img-",os="unresolved";var ns=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),as=3e3,ls=5e3;var Sr=Object.create(null);for(let s in jt)Sr[Kt+s]=jt[s]?.default||"";var Ei=class extends kt{constructor(){super(...arguments);d(this,"cssInit$",Sr)}$$(t){return this.$[Kt+t]}set$$(t){for(let i in t)this.$[Kt+i]=t[i]}sub$$(t,i){this.sub(Kt+t,r=>{r===null||r===""||i(r)})}initIntersection(t,i){let r={root:null,rootMargin:"0px"};this._isnObserver=new IntersectionObserver(o=>{o.forEach(n=>{n.isIntersecting&&(i(),this._isnObserver.unobserve(t))})},r),this._isnObserver.observe(t),this._observed||(this._observed=new Set),this._observed.add(t)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach(t=>{this._isnObserver.unobserve(t)}),this._isnObserver=null),w.deleteCtx(this)}static get observedAttributes(){return Object.keys(jt)}attributeChangedCallback(t,i,r){window.setTimeout(()=>{this.$[Kt+t]=r})}};var wi=class extends Ei{_fmtAbs(e){return!e.includes("//")&&!ns&&(e=new URL(e,document.baseURI).href),e}_validateSize(e){if(e.trim()!==""){let t=e.match(/\d+/)[0],i=e.match(/[a-zA-Z]+/)[0],r=parseInt(t,10);if(Number(r)>ls&&this.hasFormatJPG)return ls+i;if(Number(r)>as&&!this.hasFormatJPG)return as+i}return e}_getCdnModifiers(e,t){let i={format:this.$$("format"),quality:this.$$("quality"),resize:this._validateSize(e),blur:t,"cdn-operations":this.$$("cdn-operations")};return M(...Or(i))}_getUrlBase(e=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(ns&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let t=this._getCdnModifiers(e);if(this.$$("src").startsWith(this.$$("cdn-cname")))return I(this.$$("src"),t);if(this.$$("cdn-cname")&&this.$$("uuid"))return this._proxyUrl(I(Et(this.$$("cdn-cname"),this.$$("uuid")),t));if(this.$$("uuid"))return this._proxyUrl(I(Et(this.$$("cdn-cname"),this.$$("uuid")),t));if(this.$$("proxy-cname"))return this._proxyUrl(I(this.$$("proxy-cname"),t,this._fmtAbs(this.$$("src"))));if(this.$$("pubkey"))return this._proxyUrl(I(`https://${this.$$("pubkey")}.ucr.io/`,t,this._fmtAbs(this.$$("src"))))}_proxyUrl(e){return this.$$("secure-delivery-proxy")?fe(this.$$("secure-delivery-proxy"),{previewUrl:e},{transform:i=>window.encodeURIComponent(i)}):e}_getElSize(e,t=1,i=!0){let r=e.getBoundingClientRect(),o=t*Math.round(r.width),n=i?"":t*Math.round(r.height);return o||n?`${o||""}x${n||""}`:null}_setupEventProxy(e){let t=r=>{r.stopPropagation();let o=new Event(r.type,r);this.dispatchEvent(o)},i=["load","error"];for(let r of i)e.addEventListener(r,t)}get img(){return this._img||(this._img=new Image,this._setupEventProxy(this.img),this._img.setAttribute(os,""),this.img.onload=()=>{this.img.removeAttribute(os)},this.initAttributes(),this.appendChild(this._img)),this._img}get bgSelector(){return this.$$("is-background-for")}initAttributes(){[...this.attributes].forEach(e=>{jt[e.name]||this.img.setAttribute(e.name,e.value)})}get breakpoints(){if(this.$$("breakpoints")){let e=D(this.$$("breakpoints"));return Tr(e.map(t=>parseInt(t,10)))}else return null}get hasFormatJPG(){return this.$$("format").toLowerCase()==="jpeg"}renderBg(e){let t=new Set;t.add(`url("${this._getUrlBase(this._getElSize(e))}") 1x`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,2))}") ${2}x`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,3))}") ${3}x`);let i=`image-set(${[...t].join(", ")})`;e.style.setProperty("background-image",i),e.style.setProperty("background-image","-webkit-"+i)}getSrcset(){let e=new Set;return this.breakpoints?this.breakpoints.forEach(t=>{e.add(this._getUrlBase(t+"x")+` ${this._validateSize(t+"w")}`),this.$$("hi-res-support")&&e.add(this._getUrlBase(t*2+"x")+` ${this._validateSize(t*2+"w")}`),this.$$("ultra-res-support")&&e.add(this._getUrlBase(t*3+"x")+` ${this._validateSize(t*3+"w")}`)}):(e.add(this._getUrlBase(this._getElSize(this.img))+" 1x"),this.$$("hi-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,2))+" 2x"),this.$$("ultra-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,3))+" 3x")),[...e].join()}getSrc(){return this._getUrlBase()}init(){this.bgSelector?[...document.querySelectorAll(this.bgSelector)].forEach(e=>{this.$$("intersection")?this.initIntersection(e,()=>{this.renderBg(e)}):this.renderBg(e)}):this.$$("intersection")?this.initIntersection(this.img,()=>{this.img.srcset=this.getSrcset(),this.img.src=this.getSrc()}):(this.img.srcset=this.getSrcset(),this.img.src=this.getSrc())}};var Ti=class extends wi{initCallback(){super.initCallback(),this.sub$$("src",()=>{this.init()}),this.sub$$("uuid",()=>{this.init()}),this.sub$$("lazy",e=>{this.$$("is-background-for")||(this.img.loading=e?"lazy":"eager")})}};var Wt=class extends E{constructor(){super();d(this,"couldBeCtxOwner",!0);d(this,"allowCustomTemplate",!0);this.init$={...this.init$,"*simpleButtonText":"","*simpleButtonDisabled":null,"*hideIcon":!1,withDropZone:!0,onClick:()=>{this.initFlow()}}}initCallback(){super.initCallback();let t=document.querySelectorAll(st(this.cfg.ninemagskey).bind_btn_selector);t&&t.forEach(i=>{i.addEventListener("click",()=>{this.initFlow()})}),this.defineAccessor("dropzone",i=>{typeof i>"u"||(this.$.withDropZone=k(i))}),this.subConfigValue("multiple",i=>{this.$["*simpleButtonText"]=i?this.l10n("upload-files"):this.l10n("upload-file"),this.l10n("upload-disabled")==="true"&&(this.$["*simpleButtonText"]=this.l10n("upload-disabled-text")||this.$["*simpleButtonText"],this.$["*simpleButtonDisabled"]="disabled",this.$["*hideIcon"]=!0)})}};Wt.template="";Wt.bindAttributes({dropzone:null});var Ae=class extends b{constructor(){super(...arguments);d(this,"historyTracked",!0);d(this,"activityType","start-from")}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}};Ae.template='<div class="content"><slot></slot></div>';var xe=class extends b{constructor(){super();d(this,"historyTracked",!0);d(this,"activityType","end-screen");this.init$={...this.init$,onContinue:()=>{this.$["*uploadCollection"]?.clearAll(),this.$["*currentActivity"]=b.activities.START_FROM,this.$["*closeModal"]()},goToCheckout:()=>{window.location.href="//"+window.location.host+"/cart"}}}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}};xe.template=`<div class="end-screen"><div class="end-screen__text"><p>${window.UploadCareLocales?.end_screen?.text||"Product has been successfully added to the shopping cart"}</p></div><div class="end-screen__btns"><button class="secondary-btn" type="button" set="onclick: onContinue"> ${window.UploadCareLocales?.end_screen?.continueBtn||"GET MORE MAGNETS"} </button><button class="primary-btn" type="button" set="onclick: goToCheckout"> ${window.UploadCareLocales?.end_screen?.checkoutBtn||"SECURE CHECKOUT"} </button></div></div>`;function jn(s){return new Promise(e=>{typeof window.FileReader!="function"&&e(!1);try{let t=new FileReader;t.onerror=()=>{e(!0)};let i=r=>{r.type!=="loadend"&&t.abort(),e(!1)};t.onloadend=i,t.onprogress=i,t.readAsDataURL(s)}catch{e(!1)}})}function Kn(s,e){return new Promise(t=>{let i=0,r=[],o=a=>{a||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),t(null)),a.isFile?(i++,a.file(l=>{i--;let c=new File([l],l.name,{type:l.type||e});r.push({type:"file",file:c,fullPath:a.fullPath}),i===0&&t(r)})):a.isDirectory&&n(a.createReader())},n=a=>{i++,a.readEntries(l=>{i--;for(let c of l)o(c);i===0&&t(r)})};o(s)})}function Lr(s){let e=[],t=[];for(let i=0;i<s.items.length;i++){let r=s.items[i];if(r)if(r.kind==="file"){let o=r.type;if(typeof r.webkitGetAsEntry=="function"||typeof r.getAsEntry=="function"){let a=typeof r.webkitGetAsEntry=="function"?r.webkitGetAsEntry():r.getAsEntry();t.push(Kn(a,o).then(l=>{l&&e.push(...l)}));continue}let n=r.getAsFile();n&&t.push(jn(n).then(a=>{a||e.push({type:"file",file:n})}))}else r.kind==="string"&&r.type.match("^text/uri-list")&&t.push(new Promise(o=>{r.getAsString(n=>{e.push({type:"url",url:n}),o(void 0)})}))}return Promise.all(t).then(()=>e)}var B={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3},kr=["focus"],Wn=100,cs=new Map;function qn(s,e){let t=Math.max(Math.min(s[0],e.x+e.width),e.x),i=Math.max(Math.min(s[1],e.y+e.height),e.y);return Math.sqrt((s[0]-t)*(s[0]-t)+(s[1]-i)*(s[1]-i))}function ds(s){let e=0,t=document.body,i=new Set,r=m=>i.add(m),o=B.INACTIVE,n=m=>{s.shouldIgnore()&&m!==B.INACTIVE||(o!==m&&i.forEach(g=>g(m)),o=m)},a=()=>e>0;r(m=>s.onChange(m));let l=()=>{e=0,n(B.INACTIVE)},c=()=>{e+=1,o===B.INACTIVE&&n(B.ACTIVE)},u=()=>{e-=1,a()||n(B.INACTIVE)},p=m=>{m.preventDefault(),e=0,n(B.INACTIVE)},h=m=>{if(s.shouldIgnore())return;a()||(e+=1);let g=[m.x,m.y],v=s.element.getBoundingClientRect(),O=Math.floor(qn(g,v)),y=O<Wn,x=m.composedPath().includes(s.element);cs.set(s.element,O);let z=Math.min(...cs.values())===O;x&&z?(m.preventDefault(),n(B.OVER)):n(y&&z?B.NEAR:B.ACTIVE)},f=async m=>{if(s.shouldIgnore())return;m.preventDefault();let g=await Lr(m.dataTransfer);s.onItems(g),n(B.INACTIVE)};return t.addEventListener("drop",p),t.addEventListener("dragleave",u),t.addEventListener("dragenter",c),t.addEventListener("dragover",h),s.element.addEventListener("drop",f),kr.forEach(m=>{window.addEventListener(m,l)}),()=>{cs.delete(s.element),t.removeEventListener("drop",p),t.removeEventListener("dragleave",u),t.removeEventListener("dragenter",c),t.removeEventListener("dragover",h),s.element.removeEventListener("drop",f),kr.forEach(m=>{window.removeEventListener(m,l)})}}var Ir="lr-drop-area",qt=`${Ir}/registry`,Yt=class extends E{constructor(){super(),this.init$={...this.init$,state:B.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isEnabled:!0,isVisible:!0,text:this.l10n("drop-files-here"),[qt]:null}}isActive(){if(!this.$.isEnabled)return!1;let e=this.getBoundingClientRect(),t=e.width>0&&e.height>0,i=e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth),r=window.getComputedStyle(this),o=r.visibility!=="hidden"&&r.display!=="none";return t&&o&&i}initCallback(){super.initCallback(),this.$[qt]||(this.$[qt]=new Set),this.$[qt].add(this),this.defineAccessor("disabled",t=>{this.set$({isEnabled:!k(t)})}),this.defineAccessor("clickable",t=>{this.set$({isClickable:k(t)})}),this.defineAccessor("with-icon",t=>{this.set$({withIcon:k(t)})}),this.defineAccessor("fullscreen",t=>{this.set$({isFullscreen:k(t)})}),this.defineAccessor("text",t=>{typeof t=="string"?this.set$({text:this.l10n(t)||t}):this.set$({text:this.l10n("drop-files-here")})}),this._destroyDropzone=ds({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:t=>{this.$.state=t},onItems:t=>{t.length&&(t.forEach(i=>{i.type==="url"?this.addFileFromUrl(i.url,{source:Z.DROP_AREA}):i.type==="file"&&this.addFileFromObject(i.file,{source:Z.DROP_AREA,fullPath:i.fullPath})}),this.uploadCollection.size&&(this.set$({"*currentActivity":b.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0)))}});let e=this.ref["content-wrapper"];e&&(this._destroyContentWrapperDropzone=ds({element:e,onChange:t=>{let i=Object.entries(B).find(([,r])=>r===t)?.[0].toLowerCase();i&&e.setAttribute("drag-state",i)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",t=>{let i=Object.entries(B).find(([,r])=>r===t)?.[0].toLowerCase();i&&this.setAttribute("drag-state",i)}),this.subConfigValue("sourceList",t=>{let i=D(t);this.$.isEnabled=i.includes(E.sourceTypes.LOCAL),this.$.isVisible=this.$.isEnabled||!this.querySelector("[data-default-slot]")}),this.sub("isVisible",t=>{this.toggleAttribute("hidden",!t)}),this.sub("isClickable",t=>{this.toggleAttribute("clickable",t)}),this.$.isClickable&&(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return!this.$.isEnabled||!this._couldHandleFiles()?!0:this.$.isFullscreen?[...this.$[qt]].filter(i=>i!==this).filter(i=>i.isActive()).length>0:!1}_couldHandleFiles(){let e=this.cfg.multiple,t=this.cfg.multipleMax,i=this.uploadCollection.size;return!(e&&t&&i>=t||!e&&i>0)}destroyCallback(){super.destroyCallback();let e=this.$[qt];e&&(e.delete(this),e.size===0&&w.deleteCtx(Ir)),this._destroyDropzone?.(),this._destroyContentWrapperDropzone?.(),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}};Yt.template=`<slot><div data-default-slot hidden></div><div ref="content-wrapper" class="content-wrapper" set="@hidden: !isVisible"><span class="info-text wide-screen drag-and-drop-text" >${window.UploadCareLocales?.text?.dragAndDropImages||"Drag & Drop Images"}</span ><svg id="splash-drop-icon" width="128" height="128" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="drop-area-icon" ><path fill="#96999d" d="m2.4181 18.932-.88153-2.6572c-.15261-.47904-.11194-.99876.11334-1.4482.22542-.44773.61956-.78751 1.0956-.9445l10.376-3.6535c1.0084-.31165 2.0787.2517 2.3927 1.2593l2.5187 7.6819-3.3372-1.2593c-.30284-.11333-.64271.01615-.79338.30224l-2.8713 5.6922-2.6194-1.2593c-.25747-.12309-.56528-.061529-.7556.15112l-3.0217 2.8349-1.3349-4.1054zm13.599-11.504 2.2046-4.1762c.48035-.90871 1.5959-1.2713 2.5187-.81856l8.9412 4.6343c.44898.23275.785.63688.9319 1.1208.15189.4749.11119.99045-.11334 1.4356l-3.778 7.1908-1.3979-3.2994c-.12273-.30199-.45918-.45643-.76819-.35261l-6.5233 2.0779-1.423-4.2565c-.26042-.79413-.82707-1.4514-1.5742-1.826-.74599-.37996-1.6147-.43909-2.4053-.16371l-10.275 3.6283c-.79626.25664-1.4549.82441-1.826 1.5742-.39061.74691-.45443 1.6222-.17631 2.4179l.86894 2.7201.89412 2.5942 2.6068 7.8204c.26042.79413.82707 1.4514 1.5742 1.826.43924.21468.92155.32664 1.4104.32743.33841.001.67464-.05428.99487-.16371l10.364-3.6409c.79626-.25664 1.4549-.82441 1.826-1.5742.39061-.74691.45443-1.6222.17631-2.4179l-.10074-.30224h.06297c1.544.79997 3.4442.19665 4.2439-1.3475l6.3722-12.291c.79997-1.544.19665-3.4442-1.3475-4.2439l-8.9412-4.6343c-1.544-.79997-3.4442-.19665-4.2439 1.3475l-2.2046 4.2139m9.5717 7.6741 1.5742 3.778-1.889 3.6395c-.48035.90871-1.5959 1.2713-2.5187.81856l-1.2593-.62966-1.889-5.6796zm-4.7099 11.435c-.22542.44773-.61956.78751-1.0956.9445l-10.376 3.6535c-.97969.33024-2.0446-.17712-2.4053-1.146l-.7556-2.4053 3.1477-3.0994 2.7453 1.3727c.1533.06298.32524.06298.47854 0 .16013-.04975.29241-.16378.3652-.31483l2.9342-5.8559 3.778 1.4734.71782 2.1409.60448 1.7882c.14485.4823.09513 1.0021-.13853 1.4482zM8.4285 2.461h.61539v.61539a.61539.61539 0 0 0 1.2308 0V2.461h.61539a.61539.61539 0 0 0 0-1.2308h-.61539V.61481a.61539.61539 0 0 0-1.2308 0v.61539H8.4285a.61539.61539 0 0 0 0 1.2308zM24.429 29.538h-.61539v-.61539a.61539.61539 0 0 0-1.2308 0v.61539h-.61539a.61539.61539 0 0 0 0 1.2308h.61539v.61539a.61539.61539 0 0 0 1.2308 0v-.61539h.61539a.61539.61539 0 0 0 0-1.2308zM3.6591 7.6918a2 2 0 1 0-2-2 2 2 0 0 0 2 2zm0-3a1 1 0 1 1-1 1 1 1 0 0 1 1-1zM29 23a2 2 0 1 0 2 2 2 2 0 0 0-2-2zm0 3a1 1 0 1 1 1-1 1 1 0 0 1-1 1z" ></path><circle cx="6.0883" cy="17.303" r="1.875" fill="#96999d"></circle><circle cx="20.641" cy="8.0821" r="1.875" fill="#96999d"></circle></svg><button type="button" class="primary-btn lr-upload-from-gallery-btn"><lr-icon name="add"></lr-icon ><span >${window.innerWidth<950?window.UploadCareLocales?.text.uploadMobile||"Upload From Gallery":window.UploadCareLocales?.text?.uploadPC||"Upload From PC"}</span ></button></div></slot>`;Yt.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null});var Yn="src-type-",Zt=class extends E{constructor(){super(...arguments);d(this,"couldBeCtxOwner",!0);d(this,"_registeredTypes",{});d(this,"init$",{...this.init$,iconName:"default"})}initTypes(){this.registerType({type:E.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:E.sourceTypes.URL,activity:b.activities.URL,textKey:"from-url"}),this.registerType({type:E.sourceTypes.CAMERA,activity:b.activities.CAMERA,onClick:()=>{var i=document.createElement("input").capture!==void 0;return i&&this.openSystemDialog({captureCamera:!0}),!i}}),this.registerType({type:"draw",activity:b.activities.DRAW,icon:"edit-draw"});for(let t of Object.values(E.extSrcList))this.registerType({type:t,activity:b.activities.EXTERNAL,activityParams:{externalSourceType:t}})}initCallback(){super.initCallback(),this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",t=>{t&&this.applyType(t)})}registerType(t){this._registeredTypes[t.type]=t}getType(t){return this._registeredTypes[t]}applyType(t){let i=this._registeredTypes[t];if(!i){console.warn("Unsupported source type: "+t);return}let{textKey:r=t,icon:o=t,activity:n,onClick:a,activityParams:l={}}=i;this.applyL10nKey("src-type",`${Yn}${r}`),this.$.iconName=o,this.onclick=c=>{(a?a(c):!!n)&&this.set$({"*currentActivityParams":l,"*currentActivity":n})}}};Zt.template='<lr-icon set="@name: iconName"></lr-icon>';Zt.bindAttributes({type:null});var Oi=class extends _{initCallback(){super.initCallback(),this.subConfigValue("sourceList",e=>{let t=D(e).filter(r=>r!=="local"),i="";t.forEach(r=>{i+=`<lr-source-btn type="${r}"></lr-source-btn>`}),this.cfg.sourceListWrap?this.innerHTML=i:this.outerHTML=i})}};function Rr(s){let e=new Blob([s],{type:"image/svg+xml"});return URL.createObjectURL(e)}function $r(s="#fff",e="rgba(0, 0, 0, .1)"){return Rr(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="20" height="20" fill="${s}" /><rect x="0" y="0" width="10" height="10" fill="${e}" /><rect x="10" y="10" width="10" height="10" fill="${e}" /></svg>`)}function we(s="hsl(209, 21%, 65%)",e=32,t=32){return Rr(`<svg width="${e}" height="${t}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" fill="${s}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/></svg>`)}function Ur(s,e=40){if(s.type==="image/svg+xml")return URL.createObjectURL(s);let t=document.createElement("canvas"),i=t.getContext("2d"),r=new Image,o=new Promise((n,a)=>{r.onload=()=>{let l=r.height/r.width;l>1?(t.width=e,t.height=e*l):(t.height=e,t.width=e/l),i.fillStyle="rgb(240, 240, 240)",i.fillRect(0,0,t.width,t.height),i.drawImage(r,0,0,t.width,t.height),t.toBlob(c=>{if(!c){a();return}let u=URL.createObjectURL(c);n(u)})},r.onerror=l=>{a(l)}});return r.src=URL.createObjectURL(s),o}var V=Object.freeze({FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3),LIMIT_OVERFLOW:Symbol(4)}),Jt=class s extends E{constructor(){super();d(this,"couldBeCtxOwner",!0);d(this,"pauseRender",!0);d(this,"_entrySubs",new Set);d(this,"_entry",null);d(this,"_isIntersecting",!1);d(this,"_debouncedGenerateThumb",L(this._generateThumbnail.bind(this),100));d(this,"_debouncedCalculateState",L(this._calculateState.bind(this),100));d(this,"_renderedOnce",!1);d(this,"_debouncedHandleCollectionUpdate",L(()=>{this.isConnected&&(this.$.isDuplciateDisabled=this.uploadCollection.size>=this.cfg.multipleMax,this.$.fileIndex=`${this.uploadCollection.indexOf(this.$.uid)+1}/${this.cfg.multipleMax}`)},0));this.init$={...this.init$,uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,loadingClass:"thumb--loading",progressVisible:!1,progressUnknown:!1,fileIndex:"",badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,isLimitOverflow:!1,isDuplciateDisabled:!1,state:V.IDLE,"*uploadTrigger":null,onEdit:t=>{t?.stopPropagation(),this.$.isFinished&&(this.set$({"*focusedEntry":this._entry}),this.hasBlockInCtx(i=>i.activityType===b.activities.DETAILS)?this.$["*currentActivity"]=b.activities.DETAILS:this.$["*currentActivity"]=b.activities.CLOUD_IMG_EDIT)},onDuplicate:t=>{t?.stopPropagation(),this.uploadCollection.size<this.cfg.multipleMax&&this.uploadCollection.duplicate(this.$.uid)},onRemove:t=>{t?.stopPropagation();let i=this._entry.getValue("uuid");if(i){let r=this.getOutputData(o=>o.getValue("uuid")===i);this.emit(S.REMOVE,r,{debounce:!0})}this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}}}_reset(){for(let t of this._entrySubs)t.remove();this._debouncedGenerateThumb.cancel(),this._debouncedCalculateState.cancel(),this._entrySubs=new Set,this._entry=null}_observerCallback(t){let[i]=t;this._isIntersecting=i.isIntersecting,i.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),i.intersectionRatio===0?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){if(!this._entry)return;let t=this._entry,i=V.IDLE;t.getValue("uploadError")||t.getValue("validationErrorMsg")?i=V.FAILED:t.getValue("validationMultipleLimitMsg")?i=V.LIMIT_OVERFLOW:t.getValue("isUploading")?i=V.UPLOADING:t.getValue("fileInfo")&&(i=V.FINISHED,t.setValue("loadingClass","")),this.$.state=i}async _generateThumbnail(){if(!this._entry)return;let t=this._entry;if(t.getValue("fileInfo")&&t.getValue("isImage")){let i=this.proxyUrl(I(Et(this.cfg.cdnCname,this._entry.getValue("uuid")),M(t.getValue("cdnUrlModifiers"),""))),r=t.getValue("thumbUrl");r!==i&&(t.setValue("thumbUrl",i),r?.startsWith("blob:")&&URL.revokeObjectURL(r));return}if(!t.getValue("thumbUrl"))if(t.getValue("file")?.type.includes("image"))try{let i=await Ur(t.getValue("file"),this.cfg.thumbSize);t.setValue("thumbUrl",i)}catch{let r=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",we(r))}else if(t.getValue("externalUrl")){let i=await t.getValue("externalUrl");t.setValue("thumbUrl",i)}else{let i=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",we(i))}}_subEntry(t,i){let r=this._entry.subscribe(t,o=>{this.isConnected&&i(o)});this._entrySubs.add(r)}_handleEntryId(t){this._reset();let i=this.uploadCollection?.read(t);this._entry=i,i&&(this._subEntry("uploadProgress",r=>{this.$.progressValue=r}),this._subEntry("fileName",r=>{this.$.itemName=r||i.getValue("externalUrl")||this.l10n("file-no-name"),this._debouncedCalculateState()}),this._subEntry("externalUrl",r=>{this.$.itemName=i.getValue("fileName")||r||this.l10n("file-no-name")}),this._subEntry("uuid",r=>{this._debouncedCalculateState(),r&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",r=>{if(r){let o=new Image;o.src=r,o.onload=()=>{this.$.thumbUrl=`url(${r})`}}else this.$.thumbUrl=""}),this._subEntry("validationMultipleLimitMsg",()=>this._debouncedCalculateState()),this._subEntry("validationErrorMsg",()=>this._debouncedCalculateState()),this._subEntry("uploadError",()=>this._debouncedCalculateState()),this._subEntry("isUploading",()=>this._debouncedCalculateState()),this._subEntry("fileSize",()=>this._debouncedCalculateState()),this._subEntry("mimeType",()=>this._debouncedCalculateState()),this._subEntry("isImage",()=>this._debouncedCalculateState()),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",t=>{this._handleEntryId(t)}),this.sub("state",t=>{this._handleState(t)}),this.uploadCollection.observeCollection(this._debouncedHandleCollectionUpdate),this.subConfigValue("useCloudImageEditor",()=>this._debouncedCalculateState()),this.onclick=()=>{s.activeInstances.forEach(t=>{t===this?t.setAttribute("focused",""):t.removeAttribute("focused")})},this.$["*uploadTrigger"]=null,this.sub("*uploadTrigger",t=>{t&&setTimeout(()=>this.isConnected&&this.upload())}),s.activeInstances.add(this)}_handleState(t){let r=(o=>o===this.l10n("files-max-size-limit-error",{maxFileSize:Ee(ue)})?this.l10n("file-single-max-size-limit-error",{maxFileSize:Ee(ue)}):o)(this._entry.getValue("uploadError")?.message||this._entry.getValue("validationErrorMsg")||this._entry.getValue("validationMultipleLimitMsg"));this.set$({isFailed:t===V.FAILED,isLimitOverflow:t===V.LIMIT_OVERFLOW,isUploading:t===V.UPLOADING,isFinished:t===V.FINISHED,progressVisible:t===V.UPLOADING&&!r,isEditable:this.cfg.useCloudImageEditor&&this._entry?.getValue("isImage")&&this._entry?.getValue("cdnUrl"),errorText:r}),t===V.FAILED||t===V.LIMIT_OVERFLOW?this.$.badgeIcon="badge-error":t===V.FINISHED&&(this.$.badgeIcon="badge-success"),t===V.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._debouncedHandleCollectionUpdate),s.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),this._observer?.disconnect()}async upload(){let t=this._entry;if(!this.uploadCollection.read(t.uid)||t.getValue("fileInfo")||t.getValue("isUploading")||t.getValue("uploadError")||t.getValue("validationErrorMsg")||t.getValue("validationMultipleLimitMsg"))return;let i=this.getOutputData(r=>!r.getValue("fileInfo"));this.emit(S.UPLOAD_START,i,{debounce:!0}),this._debouncedCalculateState(),t.setValue("isUploading",!0),t.setValue("uploadError",null),t.setValue("validationErrorMsg",null),t.setValue("validationMultipleLimitMsg",null),!t.getValue("file")&&t.getValue("externalUrl")&&(this.$.progressUnknown=!0);try{let r=new AbortController;t.setValue("abortController",r);let o=async()=>{let a=this.getUploadClientOptions();return Ki(t.getValue("file")||t.getValue("externalUrl")||t.getValue("uuid"),{...a,fileName:t.getValue("fileName"),source:t.getValue("source"),onProgress:l=>{if(l.isComputable){let c=l.value*100;t.setValue("uploadProgress",c)}this.$.progressUnknown=!l.isComputable},signal:r.signal,metadata:await this.getMetadataFor(t.uid)})},n=await this.$["*uploadQueue"].add(o);t.setMultipleValues({fileInfo:n,isUploading:!1,fileName:n.originalFilename,fileSize:n.size,isImage:n.isImage,mimeType:n.contentInfo?.mime?.mime??n.mimeType,uuid:n.uuid,cdnUrl:n.cdnUrl}),t===this._entry&&this._debouncedCalculateState()}catch(r){console.warn("Upload error",r),t.setMultipleValues({abortController:null,isUploading:!1,uploadProgress:0}),t===this._entry&&this._debouncedCalculateState(),r instanceof P?r.isCancel||(console.log(r),t.setValue("uploadError",r)):t.setValue("uploadError",new Error("Unexpected error"))}}};Jt.template=`<div class="mobile">${window.UploadCareLocales?.text?.image||"Image"} {{fileIndex}}</div><div class="inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @limit-overflow: isLimitOverflow; @focused: isFocused;" ><div class="thumb" set="style.backgroundImage: thumbUrl; @uploading: !isFinished; onclick: onEdit;"></div><div class="file-actions" style="left: 0; padding-right: 0;"><button type="button" class="remove-btn mini-btn" set="onclick: onRemove;"><lr-icon name="remove-file"></lr-icon></button></div><div class="file-actions" style="padding-left: 0;"><button type="button" class="duplicate-btn mini-btn" set="onclick: onDuplicate; @hidden: !isEditable; @disabled: isDuplciateDisabled"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M8,7 L8,5.50100238 C8,4.1202905 9.11928813,3.00100238 10.5,3.00100238 L16.4720225,3.00100238 C16.6047688,2.99258291 16.7429463,3.03684187 16.8535534,3.14744899 L19.8535534,6.14744899 C19.9641605,6.25805611 20.0084195,6.39623363 20,6.52897986 L20,14.5010024 C20,15.8817143 18.8807119,17.0010024 17.5,17.0010024 L16,17.0010024 L16,18.5 C16,19.8807119 14.8807119,21 13.5,21 L6.5,21 C5.11928813,21 4,19.8807119 4,18.5 L4,9.5 C4,8.11928813 5.11928813,7 6.5,7 L8,7 Z M8,8 L6.5,8 C5.67157288,8 5,8.67157288 5,9.5 L5,18.5 C5,19.3284271 5.67157288,20 6.5,20 L13.5,20 C14.3284271,20 15,19.3284271 15,18.5 L15,17.0010024 L12.5,17.0010024 C12.2238576,17.0010024 12,16.7771448 12,16.5010024 C12,16.22486 12.2238576,16.0010024 12.5,16.0010024 L17.5,16.0010024 C18.3284271,16.0010024 19,15.3294295 19,14.5010024 L19,7.00100238 L16.5,7.00100238 C16.2238576,7.00100238 16,6.77714475 16,6.50100238 L16,4.00100238 L10.5,4.00100238 C9.67157288,4.00100238 9,4.67257525 9,5.50100238 L9,10.5000237 C9,10.7761595 8.77614767,11.0000118 8.50001183,11.0000118 L8.5,11.0000118 C8.22385571,11.0000053 8,10.7761443 8,10.5 L8,8 Z M17,6.00100238 L18.2928932,6.00100238 L17,4.70810916 L17,6.00100238 Z M13.2928932,10 L11.5,10 C11.2238576,10 11,9.77614237 11,9.5 C11,9.22385763 11.2238576,9 11.5,9 L14.5,9 C14.7761424,9 15,9.22385763 15,9.5 L15,12.5 C15,12.7761424 14.7761424,13 14.5,13 C14.2238576,13 14,12.7761424 14,12.5 L14,10.7071068 L8.85355339,15.8535534 C8.65829124,16.0488155 8.34170876,16.0488155 8.14644661,15.8535534 C7.95118446,15.6582912 7.95118446,15.3417088 8.14644661,15.1464466 L13.2928932,10 L13.2928932,10 Z" /></svg </button><button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable"><lr-icon name="edit-file"></lr-icon></button></div><button type="button" class="upload-btn mini-btn" set="onclick: onUpload;"><lr-icon name="upload"></lr-icon></button><div set="@hidden: !errorText" class="file-error-text"><div><lr-icon name="error"></lr-icon></div><div class="mobile"> {{errorText}} </div></div><lr-progress-bar class="progress-bar" set="value: progressValue; visible: progressVisible; unknown: progressUnknown; @hidden: !progressVisible" ></lr-progress-bar></div><div class="file-actions-mobile"><button type="button" class="remove-btn mini-btn" set="onclick: onRemove;"><span class="mini-btn__content"><lr-icon name="remove-file"></lr-icon><span>${window.UploadCareLocales?.actions?.delete||"Delete"}</span></span></button><button type="button" class="duplicate-btn mini-btn" set="onclick: onDuplicate; @hidden: !isEditable; @disabled: isDuplciateDisabled"><span class="mini-btn__content"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M8,7 L8,5.50100238 C8,4.1202905 9.11928813,3.00100238 10.5,3.00100238 L16.4720225,3.00100238 C16.6047688,2.99258291 16.7429463,3.03684187 16.8535534,3.14744899 L19.8535534,6.14744899 C19.9641605,6.25805611 20.0084195,6.39623363 20,6.52897986 L20,14.5010024 C20,15.8817143 18.8807119,17.0010024 17.5,17.0010024 L16,17.0010024 L16,18.5 C16,19.8807119 14.8807119,21 13.5,21 L6.5,21 C5.11928813,21 4,19.8807119 4,18.5 L4,9.5 C4,8.11928813 5.11928813,7 6.5,7 L8,7 Z M8,8 L6.5,8 C5.67157288,8 5,8.67157288 5,9.5 L5,18.5 C5,19.3284271 5.67157288,20 6.5,20 L13.5,20 C14.3284271,20 15,19.3284271 15,18.5 L15,17.0010024 L12.5,17.0010024 C12.2238576,17.0010024 12,16.7771448 12,16.5010024 C12,16.22486 12.2238576,16.0010024 12.5,16.0010024 L17.5,16.0010024 C18.3284271,16.0010024 19,15.3294295 19,14.5010024 L19,7.00100238 L16.5,7.00100238 C16.2238576,7.00100238 16,6.77714475 16,6.50100238 L16,4.00100238 L10.5,4.00100238 C9.67157288,4.00100238 9,4.67257525 9,5.50100238 L9,10.5000237 C9,10.7761595 8.77614767,11.0000118 8.50001183,11.0000118 L8.5,11.0000118 C8.22385571,11.0000053 8,10.7761443 8,10.5 L8,8 Z M17,6.00100238 L18.2928932,6.00100238 L17,4.70810916 L17,6.00100238 Z M13.2928932,10 L11.5,10 C11.2238576,10 11,9.77614237 11,9.5 C11,9.22385763 11.2238576,9 11.5,9 L14.5,9 C14.7761424,9 15,9.22385763 15,9.5 L15,12.5 C15,12.7761424 14.7761424,13 14.5,13 C14.2238576,13 14,12.7761424 14,12.5 L14,10.7071068 L8.85355339,15.8535534 C8.65829124,16.0488155 8.34170876,16.0488155 8.14644661,15.8535534 C7.95118446,15.6582912 7.95118446,15.3417088 8.14644661,15.1464466 L13.2928932,10 L13.2928932,10 Z" /></svg><span>${window.UploadCareLocales?.actions.duplicate||"Duplicate"}</span></span></button><button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable"><span class="mini-btn__content"><lr-icon name="edit-file"></lr-icon><span>${window.UploadCareLocales?.actions?.edit||"Edit"}</span></span></button></div>`;Jt.activeInstances=new Set;var Qt,wt=(Qt=class{},d(Qt,"activities",{START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",MTN_ACCEPT_SCREEN:"mtn-accept-screen",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details",END_SCREEN:"end-screen"}),d(Qt,"reg",()=>{}),d(Qt,"is","sym-1"),d(Qt,"bindAttributes",()=>{}),Qt);var te=class extends _{constructor(){super();d(this,"_closeDialog",()=>{this.setOrAddState("*modalActive",!1)});d(this,"_handleDialogClose",()=>{this._closeDialog()});d(this,"_handleDialogMouseDown",t=>{this._mouseDownTarget=t.target});d(this,"_handleDialogMouseUp",t=>{this.$["*currentActivity"]===wt.activities.END_SCREEN&&t.target===this.ref.dialog&&t.target===this._mouseDownTarget&&(this.$["*uploadCollection"]?.clearAll(),this.$["*currentActivity"]=wt.activities.START_FROM,this._closeDialog())});this.init$={...this.init$,"*modalActive":!1,isOpen:!1,isHeaderHidden:!1,closeClicked:this._handleDialogClose}}show(){this.ref.dialog.showModal?this.ref.dialog.showModal():this.ref.dialog.setAttribute("open","")}hide(){this.ref.dialog.close?this.ref.dialog.close():this.ref.dialog.removeAttribute("open")}initCallback(){if(super.initCallback(),typeof HTMLDialogElement=="function")this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.addEventListener("mouseup",this._handleDialogMouseUp);else{this.setAttribute("dialog-fallback","");let t=document.createElement("div");t.className="backdrop",this.appendChild(t)}this.sub("*modalActive",t=>{this.$.isOpen!==t&&(this.$.isOpen=t),t&&this.cfg.modalScrollLock?document.body.style.overflow="hidden":document.body.style.overflow=""}),this.subConfigValue("modalBackdropStrokes",t=>{t?this.setAttribute("strokes",""):this.removeAttribute("strokes")}),this.sub("isOpen",t=>{t?this.show():this.hide()}),this.sub("*currentActivity",t=>{t===wt.activities.UPLOAD_LIST?this.$["*headerTitle"]=window.UploadCareLocales?.text?.dialog_title||"Product preview":t===wt.activities.END_SCREEN?this.$["*headerTitle"]="":this.$["*headerTitle"]=window.UploadCareLocales?.actions.uploadImages||"Upload images",this.$.isHeaderHidden=!(t===wt.activities.UPLOAD_LIST||t===wt.activities.START_FROM||t===wt.activities.END_SCREEN)})}destroyCallback(){super.destroyCallback(),document.body.style.overflow="",this._mouseDownTarget=void 0,this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("mousedown",this._handleDialogMouseDown)}};d(te,"StateConsumerScope","modal");te.template=`<dialog ref="dialog" set="@data-current-activity: *currentActivity"><lr-activity-header set="@hidden: isHeaderHidden"><span class="header-text">{{*headerTitle}}</span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><slot></slot></dialog>`;var ee=class{constructor(){d(this,"caption","");d(this,"text","");d(this,"iconName","");d(this,"isError",!1)}},Te=class extends _{constructor(){super(...arguments);d(this,"init$",{...this.init$,iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}})}initCallback(){super.initCallback(),this.sub("*message",t=>{t?(this.setAttribute("active",""),this.set$({captionTxt:t.caption||"",msgTxt:t.text||"",iconName:t.isError?"error":"info"}),t.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")})}};Te.template=`<div class="heading"><lr-icon set="@name: iconName"></lr-icon><div class="caption">{{captionTxt}}</div><button type="button" set="onclick: onClose"><lr-icon name="close"></lr-icon></button></div><div class="msg">{{msgTxt}}</div>`;var Oe=class extends E{constructor(){super();d(this,"couldBeCtxOwner",!0);d(this,"historyTracked",!0);d(this,"activityType",b.activities.UPLOAD_LIST);d(this,"_debouncedHandleCollectionUpdate",L(()=>{this.isConnected&&(this._updateUploadsState(),this._updateCountLimitMessage(),!this.couldOpenActivity&&this.$["*currentActivity"]===this.activityType&&this.historyBack())},0));this.init$={...this.init$,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,addMoreBtnLoading:!1,atcBtnEnabled:!1,atcBtnVisible:!1,headerText:window.UploadCareLocales?.text.accept||"Product Preview","*headerTitle":window.UploadCareLocales?.text.dialog_title||"Product Preview",errorText:"",validationErrorMsg:null,validationErrorMsgFirstLine:null,validationErrorMsgSecondLine:null,addMoreCount:0,addMoreCountVisible:!1,acceptMessage:window[Es]?.accept_message,hasFiles:!1,fullUploadList:[],maxStyleVar:"",filesAmount:0,showCancelAlert:!1,addToCartText:this.l10n("btn_atc_text"),maxUploadAmount:st(this.cfg.ninemagskey).multiple_max,onAdd:()=>{this.initFlow(!0)},onAtc:()=>{this.onAtcBtn()},onUpload:()=>{this.uploadAll(),this._updateUploadsState()},onDone:()=>{this.doneFlow()},onCancel:()=>{this.set$({showCancelAlert:!1});let t=this.getOutputData(i=>!!i.getValue("fileInfo"));this.emit(S.REMOVE,t,{debounce:!0}),this.uploadCollection.clearAll()},onCancelAlert:()=>{this.set$({showCancelAlert:!0})},onCancelClear:()=>{this.set$({showCancelAlert:!1})}}}onAtcBtn(){this.set$({message:null,errorText:"",atcBtnEnabled:!1,addMoreCountVisible:!1});let t=st(this.cfg.ninemagskey),i=t.variant_id,r=t.lineItemsJson,o=t.quantity;if(Object.keys(r).length===0){setTimeout(()=>{this.onAtcBtn()},1e3);return}let n={items:[{quantity:o||1,id:i,properties:r}]};if(st(this.cfg.ninemagskey).cart_props_func)try{let a=st(this.cfg.ninemagskey).cart_props_func();n.items[0]={...n.items[0],...a}}catch(a){console.log(a)}fetch(window.Shopify.routes.root+"cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(a=>{st(this.cfg.ninemagskey).with_cart_redirect?window.location.href="//"+window.location.host+"/cart":this.set$({"*currentActivity":b.activities.END_SCREEN})})}_validateFilesCount(){let t=!!this.cfg.multiple,i=t?this.cfg.multipleMin??0:1,r=t?this.cfg.multipleMax??0:1,o=this.uploadCollection.size,n=Math.ceil(Math.sqrt(r));this.set$({maxStyleVar:"--grid-side:"+n});let a=i?o<i:!1,l=r?o>r:!1;return{passed:!a&&!l,tooFew:a,tooMany:l,min:i,max:r,exact:r===o}}_updateCountLimitMessage(){let t=this.uploadCollection.size,i=this._validateFilesCount();if(t&&!i.passed){let r=new ee,o=i.tooFew?"files-count-limit-error-too-few":"files-count-limit-error-too-many";if(i.min===i.max){o="files-count-limit-error-min-eq-max",this.set$({message:r,errorText:"",atcBtnEnabled:!1,atcBtnVisible:!1,addMoreCount:i.min-t,addMoreCountVisible:i.min-t>0});return}r.caption=this.l10n("files-count-limit-error-title"),r.text=this.l10n(o,{min:i.min,max:i.max,total:t}),r.isError=!0,this.set$({message:r,errorText:r.text,atcBtnEnabled:!1,atcBtnVisible:!1,addMoreCount:i.min-t,addMoreCountVisible:i.min-t>0})}else this.set$({message:null,errorText:"",atcBtnEnabled:!!(this.$.doneBtnVisible&&this.$.doneBtnEnabled),atcBtnVisible:!!(this.$.doneBtnVisible&&this.$.doneBtnEnabled),addMoreCountVisible:!1})}_updateUploadsState(){let t=this.uploadCollection.items(),r={total:t.length,succeed:0,uploading:0,failed:0,limitOverflow:0};this.set$({validationErrorMsg:null});for(let m of t){let g=this.uploadCollection.read(m);if(g.getValue("validationErrorMsg")){let v=this.validationErrorMsg?this.validationErrorMsg+`${g.getValue("validationErrorMsg")} `:`${g.getValue("validationErrorMsg")} `;this.set$({validationErrorMsg:v,validationErrorMsgFirstLine:v?.split(".")?.[0],validationErrorMsgSecondLine:v?.split(".")?.[1]})}g.getValue("fileInfo")&&!g.getValue("validationErrorMsg")&&g.getValue("cdnUrl")&&(r.succeed+=1),g.getValue("isUploading")&&(r.uploading+=1),(g.getValue("validationErrorMsg")||g.getValue("uploadError"))&&(r.failed+=1),g.getValue("validationMultipleLimitMsg")&&(r.limitOverflow+=1)}let{passed:o,tooMany:n,exact:a}=this._validateFilesCount(),l=r.failed===0&&r.limitOverflow===0,c=!1,u=!1,p=!1;r.total-r.succeed-r.uploading-r.failed>0&&o?c=!0:(u=!0,p=r.total===r.succeed&&o&&l),(()=>this.set$({doneBtnVisible:u,doneBtnEnabled:p,uploadBtnVisible:c,addMoreBtnEnabled:r.total===0||!n&&!a,addMoreBtnVisible:!a||this.cfg.multiple})).apply(this)}get couldOpenActivity(){return this.cfg.showEmptyList||this.uploadCollection.size>0}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.subConfigValue("multiple",this._debouncedHandleCollectionUpdate),this.subConfigValue("multipleMin",this._debouncedHandleCollectionUpdate),this.subConfigValue("multipleMax",this._debouncedHandleCollectionUpdate),this.sub("*currentActivity",t=>{!this.couldOpenActivity&&t===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observeProperties(this._debouncedHandleCollectionUpdate),this.sub("*uploadList",t=>{this._debouncedHandleCollectionUpdate(),this.$.fullUploadList=t.slice(),this.cfg.multipleMax>t.length&&[...Array(this.cfg.multipleMax-t.length).keys()].forEach(()=>{this.$.fullUploadList.push({empty:!0})}),this.set$({hasFiles:t.length>0,filesAmount:t.length}),this.cfg.confirmUpload||this.add$({"*uploadTrigger":{}},!0)})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._debouncedHandleCollectionUpdate)}};Oe.template=`<div class="no-files" set="@hidden: hasFiles"><slot name="empty"><span l10n="no-files"></span></slot></div><div class="accept-block wide-screen"><div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item" set="@style: maxStyleVar"></div><div class="accept-block__content"><div class="accept-block__text"><h2>{{headerText}}</h2><div class="accept-block__message"><h3> ${window.UploadCareLocales?.text.upload_message_text||'Click the "Settings" icon near a picture to resize or crop it'} </h3><p class="accept-message__icon accept-message__icon--2"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" class="accept-message__icon--2__box" viewbox="0 0 100 100" ><rect x="0" y="0" width="100" height="100" style="fill: var(--clr-accent-light);" /><rect x="10" y="10" width="80" height="80" style="fill: var(--clr-accent);" /><line stroke-dasharray="4.5, 4.5" x1="10" y1="10" x2="90" y2="10" stroke="#ffffff" /><line stroke-dasharray="4.5, 4.5" x1="90" y1="10" x2="90" y2="90" stroke="#ffffff" /><line stroke-dasharray="4.5, 4.5" x1="10" y1="90" x2="90" y2="90" stroke="#ffffff" /><line stroke-dasharray="4.5, 4.5" x1="10" y1="10" x2="10" y2="90" stroke="#ffffff" /></svg> ${window.UploadCareLocales?.text.area_message_text||"Area beyond the dotted lines will wrap around the edges of your magnets"} </p></div><div class="accept-block__error selected-amount"> ${window.UploadCareLocales?.text?.selected||"Selected"} {{filesAmount}}/{{maxUploadAmount}} </div><div class="accept-block__error" set="@hidden: !errorText">{{errorText}}</div><div class="accept-block__error" set="@hidden: !validationErrorMsg">{{validationErrorMsg}}</div></div><div class="accept-block__btns"><button set="onclick: onAtc; @disabled: !atcBtnEnabled; @hidden: !atcBtnVisible" class="atc-button primary-btn"> {{addToCartText}} </button><button type="button" class="add-more-btn primary-btn" set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: atcBtnVisible" ><span class="loader" set="@hidden: addMoreBtnEnabled"></span><div set="@hidden: !addMoreBtnEnabled"><lr-icon name="add"></lr-icon><span >${(window.UploadCareLocales?.actions.add_more_btn||"Add {{amount}} more").replace("{{amount}}",'<span set="@hidden: !addMoreCountVisible">{{addMoreCount}}</span>')}</span ></div></button></div></div></div><div class="accept-block mobile"><div class="accept-block__text"><h2 class="wide-screen">{{headerText}}</h2><div class="accept-block__message"><p class="accept-message__icon accept-message__icon--2"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" class="accept-message__icon--2__box" viewbox="0 0 100 100" ><rect x="0" y="0" width="100" height="100" style="fill: var(--clr-accent-light);" /><rect x="10" y="10" width="80" height="80" style="fill: var(--clr-accent);" /><line stroke-dasharray="4.5, 4.5" x1="10" y1="10" x2="90" y2="10" stroke="#ffffff" /><line stroke-dasharray="4.5, 4.5" x1="90" y1="10" x2="90" y2="90" stroke="#ffffff" /><line stroke-dasharray="4.5, 4.5" x1="10" y1="90" x2="90" y2="90" stroke="#ffffff" /><line stroke-dasharray="4.5, 4.5" x1="10" y1="10" x2="10" y2="90" stroke="#ffffff" /></svg> ${window.UploadCareLocales?.text.area_message_text||"Area beyond the dotted lines will wrap around the edges of your magnets"} </p></div></div><div class="accept-block__btns"><div class="accept-block__text mobile"><div class="accept-block__error" set="@hidden: !validationErrorMsg"> {{validationErrorMsgFirstLine}}.<br />{{validationErrorMsgSecondLine}}. </div></div><button set="onclick: onAtc; @hidden: !atcBtnVisible; @disabled: !atcBtnEnabled" class="atc-button primary-btn mobile" > {{addToCartText}} </button><button type="button" class="add-more-btn primary-btn mobile" set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: atcBtnVisible" ><span class="loader" set="@hidden: addMoreBtnEnabled"></span><div set="@hidden: !addMoreBtnEnabled"><lr-icon name="add"></lr-icon><span >${(window.UploadCareLocales?.actions.add_more_btn||"Add {{amount}} more").replace("{{amount}}",'<span set="@hidden: !addMoreCountVisible">{{addMoreCount}}</span>')}</span ></div></button></div><div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item" set="@style: maxStyleVar"></div></div><lr-drop-area ghost></lr-drop-area>`;var Se=class extends E{constructor(){super(...arguments);d(this,"couldBeCtxOwner",!0);d(this,"activityType",b.activities.URL);d(this,"init$",{...this.init$,importDisabled:!0,onUpload:t=>{t.preventDefault();let i=this.ref.input.value;this.addFileFromUrl(i,{source:Z.URL_TAB}),this.$["*currentActivity"]=b.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:t=>{let i=t.target.value;this.set$({importDisabled:!i})}})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.ref.input.value="",this.ref.input.focus()}})}};Se.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div><lr-icon name="url"></lr-icon><span l10n="caption-from-url"></span></div><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><form><div class="content"><input placeholder="https://" class="url-input" type="text" ref="input" set="oninput: onInput" /><button type="submit" class="url-upload-btn primary-btn" set="onclick: onUpload; @disabled: importDisabled"> ${window.UploadCareLocales?.actions.import_btn||"Import"} </button></div></form>`;var us=()=>typeof navigator.permissions<"u";var Le=class extends E{constructor(){super(...arguments);d(this,"couldBeCtxOwner",!0);d(this,"activityType",b.activities.CAMERA);d(this,"_unsubPermissions",null);d(this,"init$",{...this.init$,video:null,videoTransformCss:null,shotBtnDisabled:!0,videoHidden:!0,messageHidden:!0,requestBtnHidden:us(),l10nMessage:null,originalErrorMessage:null,cameraSelectOptions:null,cameraSelectHidden:!0,onCameraSelectChange:t=>{this._selectedCameraId=t.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}});d(this,"_onActivate",()=>{us()&&this._subscribePermissions(),this._capture()});d(this,"_onDeactivate",()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()});d(this,"_handlePermissionsChange",()=>{this._capture()});d(this,"_setPermissionsState",L(t=>{this.$.originalErrorMessage=null,this.classList.toggle("initialized",t==="granted"),t==="granted"?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):t==="prompt"?(this.$.l10nMessage=this.l10n("camera-permissions-prompt"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage=this.l10n("camera-permissions-denied"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())},300))}async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(t){console.log("Failed to use permissions API. Fallback to manual request mode.",t),this._capture()}}async _capture(){let t={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._selectedCameraId&&(t.video.deviceId={exact:this._selectedCameraId}),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let i=await navigator.mediaDevices.getUserMedia(t);i.addEventListener("inactive",()=>{this._setPermissionsState("denied")}),this.$.video=i,this._capturing=!0,this._setPermissionsState("granted")}catch(i){this._setPermissionsState("denied"),this.$.originalErrorMessage=i.message}}_stopCapture(){this._capturing&&(this.$.video?.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let t=Date.now(),i=`camera-${t}.png`;this._canvas.toBlob(r=>{let o=new File([r],i,{lastModified:t,type:"image/png"});this.addFileFromObject(o,{source:Z.CAMERA}),this.set$({"*currentActivity":b.activities.UPLOAD_LIST})})}async initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.subConfigValue("cameraMirror",t=>{this.$.videoTransformCss=t?"scaleX(-1)":null});try{let i=(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput").map((r,o)=>({text:r.label.trim()||`${this.l10n("caption-camera")} ${o+1}`,value:r.deviceId}));i.length>1&&(this.$.cameraSelectOptions=i,this.$.cameraSelectHidden=!1)}catch{}}};Le.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div set="@hidden: !cameraSelectHidden"><lr-icon name="camera"></lr-icon><span l10n="caption-camera"></span></div><lr-select class="camera-select" set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange" ></lr-select><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><video autoplay playsinline set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden" ref="video" ></video><div class="message-box" set="@hidden: messageHidden"><span>{{l10nMessage}}</span><span>{{originalErrorMessage}}</span><button type="button" set="onclick: onRequestPermissions; @hidden: requestBtnHidden" l10n="camera-permissions-request" ></button></div><button type="button" class="shot-btn" set="onclick: onShot; @disabled: shotBtnDisabled"><lr-icon name="camera"></lr-icon></button></div>`;var hs=class extends E{constructor(){super(...arguments);d(this,"requireCtxName",!0)}initCallback(){super.initCallback(),this.$["*eventEmitter"].bindTarget(this)}destroyCallback(){super.destroyCallback(),this.$["*eventEmitter"].unbindTarget(this)}},Mr=hs;var ke=class extends E{constructor(){super(...arguments);d(this,"activityType",b.activities.DETAILS);d(this,"pauseRender",!0);d(this,"init$",{...this.init$,checkerboard:!1,fileSize:null,fileName:"",cdnUrl:"",errorTxt:"",cloudEditBtnHidden:!0,onNameInput:null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.uid),this.historyBack()},onCloudEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=b.activities.CLOUD_IMG_EDIT)}})}showNonImageThumb(){let t=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),i=we(t,108,108);this.ref.filePreview.setImageUrl(i),this.set$({checkerboard:!1})}initCallback(){super.initCallback(),this.render(),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,{onDeactivate:()=>{this.ref.filePreview.clear()}}),this.sub("*focusedEntry",t=>{if(!t)return;this._entrySubs?this._entrySubs.forEach(o=>{this._entrySubs.delete(o),o.remove()}):this._entrySubs=new Set,this.entry=t;let i=t.getValue("file");if(i){this._file=i;let o=ye(this._file);o&&!t.getValue("cdnUrl")&&(this.ref.filePreview.setImageFile(this._file),this.set$({checkerboard:!0})),o||this.showNonImageThumb()}let r=(o,n)=>{this._entrySubs.add(this.entry.subscribe(o,n))};r("fileName",o=>{this.$.fileName=o,this.$.onNameInput=()=>{let n=this.ref.file_name_input.value;Object.defineProperty(this._file,"name",{writable:!0,value:n}),this.entry.setValue("fileName",n)}}),r("fileSize",o=>{this.$.fileSize=Number.isFinite(o)?this.fileSizeFmt(o):this.l10n("file-size-unknown")}),r("uploadError",o=>{this.$.errorTxt=o?.message}),r("externalUrl",o=>{o&&(this.entry.getValue("uuid")||this.showNonImageThumb())}),r("cdnUrl",o=>{let n=this.cfg.useCloudImageEditor&&o&&this.entry.getValue("isImage");if(o&&this.ref.filePreview.clear(),this.set$({cdnUrl:o,cloudEditBtnHidden:!n}),o&&this.entry.getValue("isImage")){let a=I(o,M("format/auto","preview"));this.ref.filePreview.setImageUrl(this.proxyUrl(a))}})})}};ke.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><span l10n="caption-edit-file"></span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><lr-tabs tab-list="tab-view, tab-details"><div tab-ctx="tab-details" class="details"><div class="info-block"><div class="info-block_name" l10n="file-name"></div><input name="name-input" ref="file_name_input" set="value: fileName; oninput: onNameInput; @disabled: !!cdnUrl" type="text" /></div><div class="info-block"><div class="info-block_name" l10n="file-size"></div><div>{{fileSize}}</div></div><div class="info-block"><div class="info-block_name" l10n="cdn-url"></div><a class="cdn-link" target="_blank" set="@href: cdnUrl; @disabled: !cdnUrl">{{cdnUrl}}</a></div><div>{{errorTxt}}</div></div><lr-file-preview tab-ctx="tab-view" set="@checkerboard: checkerboard;" ref="filePreview"></lr-file-preview></lr-tabs><div class="toolbar" set="@edit-disabled: cloudEditBtnHidden"><button type="button" class="edit-btn secondary-btn" set="onclick: onCloudEdit; @hidden: cloudEditBtnHidden;"><lr-icon name="edit"></lr-icon><span l10n="edit-image"></span></button><button type="button" class="remove-btn secondary-btn" set="onclick: onRemove"><lr-icon name="remove"></lr-icon><span l10n="remove-from-list"></span></button><div></div><button type="button" class="back-btn primary-btn" set="onclick: onBack"><span l10n="ok"></span></button></div></div>`;var ps=class{constructor(){d(this,"captionL10nStr","confirm-your-action");d(this,"messageL10Str","are-you-sure");d(this,"confirmL10nStr","yes");d(this,"denyL10nStr","no")}confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}},Ie=class extends b{constructor(){super(...arguments);d(this,"activityType",b.activities.CONFIRMATION);d(this,"_defaults",new ps);d(this,"init$",{...this.init$,activityCaption:"",messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)})}initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",t=>{t&&this.set$({"*currentActivity":b.activities.CONFIRMATION,activityCaption:this.l10n(t.captionL10nStr),messageTxt:this.l10n(t.messageL10Str),confirmBtnTxt:this.l10n(t.confirmL10nStr),denyBtnTxt:this.l10n(t.denyL10nStr),onDeny:()=>{t.denyAction()},onConfirm:()=>{t.confirmAction()}})})}};Ie.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><span>{{activityCaption}}</span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="message">{{messageTxt}}</div><div class="toolbar"><button type="button" class="deny-btn secondary-btn" set="onclick: onDeny">{{denyBtnTxt}}</button><button type="button" class="confirm-btn primary-btn" set="onclick: onConfirm">{{confirmBtnTxt}}</button></div>`;var Re=class extends E{constructor(){super(...arguments);d(this,"init$",{...this.init$,visible:!1,unknown:!1,value:0,"*commonProgress":0})}initCallback(){super.initCallback(),this._unobserveCollection=this.uploadCollection.observeProperties(()=>{let t=this.uploadCollection.items().some(i=>this.uploadCollection.read(i).getValue("isUploading"));this.$.visible=t}),this.sub("visible",t=>{t?this.setAttribute("active",""):this.removeAttribute("active")}),this.sub("*commonProgress",t=>{this.$.value=t})}destroyCallback(){super.destroyCallback(),this._unobserveCollection?.()}};Re.template=`<lr-progress-bar set="visible: visible; unknown: unknown; value: value"></lr-progress-bar>`;var $e=class extends _{constructor(){super(...arguments);d(this,"_value",0);d(this,"_unknownMode",!1);d(this,"init$",{...this.init$,width:0,opacity:0})}initCallback(){super.initCallback(),this.defineAccessor("value",t=>{t!==void 0&&(this._value=t,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))}),this.defineAccessor("visible",t=>{this.ref.line.classList.toggle("progress--hidden",!t)}),this.defineAccessor("unknown",t=>{this._unknownMode=t,this.ref.line.classList.toggle("progress--unknown",t)})}};$e.template='<div ref="line" class="progress"></div>';var q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";var ie=class extends _{constructor(){super();d(this,"init$",{...this.init$,checkerboard:!1,src:q})}initCallback(){super.initCallback(),this.sub("checkerboard",()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${$r()})`:"unset"})}destroyCallback(){super.destroyCallback(),URL.revokeObjectURL(this._lastObjectUrl)}setImage(t){this.$.src=t.src}setImageFile(t){let i=URL.createObjectURL(t);this.$.src=i,this._lastObjectUrl=i}setImageUrl(t){this.$.src=t}clear(){URL.revokeObjectURL(this._lastObjectUrl),this.$.src=q}};ie.template='<lr-img class="img-view" ref="img" set="@src: src; style.aa: src;" />';ie.bindAttributes({checkerboard:"checkerboard"});var Dr="--cfg-ctx-name",$=class extends _{get cfgCssCtxName(){return this.getCssData(Dr,!0)}get cfgCtxName(){let e=this.getAttribute("ctx-name")?.trim()||this.cfgCssCtxName||this.__cachedCfgCtxName;return this.__cachedCfgCtxName=e,e}connectedCallback(){if(!this.connectedOnce){let e=this.getAttribute("ctx-name")?.trim();e&&this.style.setProperty(Dr,`'${e}'`)}super.connectedCallback()}parseCfgProp(e){return{...super.parseCfgProp(e),ctx:w.getCtx(this.cfgCtxName)}}};function Nr(...s){return s.reduce((e,t)=>{if(typeof t=="string")return e[t]=!0,e;for(let i of Object.keys(t))e[i]=t[i];return e},{})}function N(...s){let e=Nr(...s);return Object.keys(e).reduce((t,i)=>(e[i]&&t.push(i),t),[]).join(" ")}function Pr(s,...e){let t=Nr(...e);for(let i of Object.keys(t))s.classList.toggle(i,t[i])}var Fr=s=>{if(!s)return j;let e=or(s).filter(t=>j.includes(t));return e.length===0?j:e};function Br(s){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},"*cropPresetList":[],"*tabList":j,"*tabId":R.CROP,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:q,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,cropPreset:"",tabs:Rt(j),"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let e=s.querySelectorAll("img");for(let t of e){let i=t.src;t.src=q,t.src=i}s.$["*networkProblems"]=!1},"*on.apply":e=>{if(!e)return;let t=s.$["*originalUrl"],i=M(At(e),"preview"),r=I(t,i),o={originalUrl:t,cdnUrlModifiers:i,cdnUrl:r,transformations:e};s.dispatchEvent(new CustomEvent("apply",{detail:o,bubbles:!0,composed:!0})),s.remove()},"*on.cancel":()=>{s.remove(),s.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}var Vr=`<div class="wrapper wrapper_desktop"><lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;"><div class="network_problems_content"><div class="network_problems_icon"><lr-icon size="20" name="sad"></lr-icon></div><div class="network_problems_text">Network error</div></div><div class="network_problems_footer"><lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui></div></lr-presence-toggle><div class="viewport"><div class="file_type_outer"><div class="file_type">{{fileType}}</div></div><div class="image_container" ref="img-container-el"><img src="${q}" class="image image_visible_from_editor" ref="img-el" /><lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper><lr-editor-image-fader ref="fader-el"></lr-editor-image-fader></div><div class="info_pan">{{msg}}</div></div><div class="toolbar"><lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="toolbar_content toolbar_content__editor"><lr-editor-toolbar></lr-editor-toolbar></div></div></div>`;var et=class extends ${constructor(){super();d(this,"_debouncedShowLoader",L(this._showLoader.bind(this),300));this.init$={...this.init$,...Br(this)}}get ctxName(){return this.autoCtxName}_showLoader(t){this.$.showLoader=t}_waitForSize(){return new Promise((i,r)=>{let o=setTimeout(()=>{r(new Error("[cloud-image-editor] timeout waiting for non-zero container size"))},3e3),n=new ResizeObserver(([a])=>{a.contentRect.width>0&&a.contentRect.height>0&&(i(),clearTimeout(o),n.disconnect())});n.observe(this)})}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async updateImage(){if(this.isConnected){if(await this._waitForSize(),this.$["*tabId"]===R.CROP?this.$["*cropperEl"].deactivate({reset:!0}):this.$["*faderEl"].deactivate(),this.$["*editorTransformations"]={},this.$.cdnUrl){let t=cr(this.$.cdnUrl);this.$["*originalUrl"]=Et(this.$.cdnUrl,t);let i=dr(this.$.cdnUrl),r=yr(i);this.$["*editorTransformations"]=r}else if(this.$.uuid)this.$["*originalUrl"]=Et(this.cfg.cdnCname,this.$.uuid);else throw new Error("No UUID nor CDN URL provided");try{let t=I(this.$["*originalUrl"],M("json")),i=await fetch(t).then(n=>n.json()),{width:r,height:o}=i;this.$["*imageSize"]={width:r,height:o},this.$["*tabId"]===R.CROP?this.$["*cropperEl"].activate(this.$["*imageSize"]):this.$["*faderEl"].activate({url:this.$["*originalUrl"]})}catch(t){t&&console.error("Failed to load image info",t)}}}async initEditor(){try{await this._waitForSize()}catch(t){this.isConnected&&console.error(t.message);return}this.ref["img-el"].addEventListener("load",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==q&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",t=>{let i=this.ref["img-el"];i.src!==t&&(this._imgLoading=!0,i.src=t||q)}),this.sub("cropPreset",t=>{this.$["*cropPresetList"]=pi(t)}),this.sub("tabs",t=>{this.$["*tabList"]=Fr(t)}),this.sub("*tabId",t=>{this.ref["img-el"].className=N("image",{image_hidden_to_cropper:t===R.CROP,image_hidden_effects:t!==R.CROP})}),this.classList.add("editor_ON"),this.sub("*networkProblems",t=>{this.$["presence.networkProblems"]=t,this.$["presence.modalCaption"]=!t}),this.sub("*editorTransformations",t=>{if(Object.keys(t).length===0)return;let i=this.$["*originalUrl"],r=M(At(t),"preview"),o=I(i,r),n={originalUrl:i,cdnUrlModifiers:r,cdnUrl:o,transformations:t};this.dispatchEvent(new CustomEvent("change",{detail:n,bubbles:!0,composed:!0}))},!1),this.sub("uuid",t=>t&&this.updateImage()),this.sub("cdnUrl",t=>t&&this.updateImage())}};d(et,"className","cloud-image-editor");et.template=Vr;et.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl","crop-preset":"cropPreset",tabs:"tabs"});var Ue=class extends ${constructor(){super(),this.init$={...this.init$,dragging:!1},this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if((e===""||e==="cc")&&t.height<=C&&t.width<=C)return!0;let i=t.height<=C&&(e.includes("n")||e.includes("s")),r=t.width<=C&&(e.includes("e")||e.includes("w"));return i||r}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:r,height:o}=e,n=this.ref["svg-el"],a=Y("mask",{id:"backdrop-mask"}),l=Y("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),c=Y("rect",{x:t,y:i,width:r,height:o,fill:"black"});a.appendChild(l),a.appendChild(c);let u=Y("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});n.appendChild(u),n.appendChild(a),this._backdropMask=a,this._backdropMaskInner=c}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask&&(this._backdropMask.style.display="block",st(this.cfg.ninemagskey)?.image_shape===As.CIRCLE&&(this._backdropMaskInner?.setAttribute("rx","50%"),this._backdropMaskInner?.setAttribute("ry","50%")))}))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:r,height:o}=e;this._backdropMaskInner&&ft(this._backdropMaskInner,{x:t,y:i,width:r,height:o})}_updateFrame(){let e=this.$["*cropBox"];if(!(!e||!this._frameGuides||!this._frameThumbs)){for(let t of Object.values(this._frameThumbs)){let{direction:i,pathNode:r,interactionNode:o,groupNode:n}=t,a=i==="",l=i==="cc",c=i.length===2,{x:u,y:p,width:h,height:f}=e;if(a)ft(o,{x:u,y:p,width:h,height:f});else if(l){let g=h/2/100*3.5,v={cx:u+h/2,cy:p+f/2,r:h/2-g*2};ft(o,v),o.previousElementSibling?.tagName=="circle"&&ft(o.previousElementSibling,v)}else{let g=Ct(Math.min(h,f)/(24*2+34)/2,0,1),{d:v,center:O}=c?Ys(e,i,g):Zs(e,i,g),y=Math.max(es*Ct(Math.min(h,f)/es/3,0,1),qs);ft(o,{x:O[0]-y,y:O[1]-y,width:y*2,height:y*2}),ft(r,{d:v})}let m=this._shouldThumbBeDisabled(i);n.setAttribute("class",N("thumb",{"thumb--hidden":m,"thumb--visible":!m}))}ft(this._frameGuides,{x:e.x-1*.5,y:e.y-1*.5,width:e.width+1,height:e.height+1})}}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let i=0;i<3;i++){let r=`${["n","","s"][t]}${["w","","e"][i]}`,o=Y("g");o.setAttribute("with-effects","");let n=Y("rect",{fill:"transparent"}),a=Y("path",{stroke:"currentColor",fill:"none","stroke-width":3});o.appendChild(a),o.appendChild(n),e[r]={direction:r,pathNode:a,interactionNode:n,groupNode:o},n.addEventListener("pointerdown",this._handlePointerDown.bind(this,r))}return e}_createGuides(){let e=Y("svg"),t=Y("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});e.appendChild(t);for(let i=1;i<=2;i++){let r=Y("line",{x1:`${_e*i}%`,y1:"0%",x2:`${_e*i}%`,y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(r)}for(let i=1;i<=2;i++){let r=Y("line",{x1:"0%",y1:`${_e*i}%`,x2:"100%",y2:`${_e*i}%`,stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(r)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),i=this._createGuides();t.appendChild(i);let r=this._createThumbs();for(let{groupNode:o}of Object.values(r))t.appendChild(o);e.appendChild(t),this._frameThumbs=r,this._frameGuides=i}_handlePointerDown(e,t){if(!this._frameThumbs)return;let i=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let r=this.$["*cropBox"],{x:o,y:n}=this.ref["svg-el"].getBoundingClientRect(),a=t.x-o,l=t.y-n;this.$.dragging=!0,this._draggingThumb=i,this._dragStartPoint=[a,l],this._dragStartCrop={...r}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging||!this._dragStartPoint||!this._draggingThumb)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:i,y:r}=t.getBoundingClientRect(),o=e.x-i,n=e.y-r,a=o-this._dragStartPoint[0],l=n-this._dragStartPoint[1],{direction:c}=this._draggingThumb,u=this._calcCropBox(c,[a,l]);u&&(this.$["*cropBox"]=u)}_calcCropBox(e,t){let[i,r]=t,o=this.$["*imageBox"],n=this._dragStartCrop??this.$["*cropBox"],a=this.$["*cropPresetList"]?.[0],l=a?a.width/a.height:void 0;if(e===""||e==="cc"?n=Qs({rect:n,delta:[i,r],imageBox:o}):n=tr({rect:n,delta:[i,r],direction:e,aspectRatio:l,imageBox:o}),!Object.values(n).every(c=>Number.isFinite(c)&&c>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:n});return}return zt(Gt(n),this.$["*imageBox"])}_handleSvgPointerMove_(e){if(!this._frameThumbs)return;let t=Object.values(this._frameThumbs).find(i=>{if(this._shouldThumbBeDisabled(i.direction))return!1;let o=i.interactionNode.getBoundingClientRect(),n={x:o.x,y:o.y,width:o.width,height:o.height};return er(n,[e.x,e.y])});this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;this.ref["svg-el"].style.cursor=e?Js(e.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){this._frameThumbs&&Object.values(this._frameThumbs).map(({groupNode:t})=>t).forEach(t=>{t.setAttribute("class",N("thumb",{"thumb--hidden":!e,"thumb--visible":e}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",e=>{e&&(this._guidesHidden=e.height<=C||e.width<=C,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",e=>{this._frameGuides&&this._frameGuides.setAttribute("class",N({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}};Ue.template='<svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg>';var gt=class extends ${constructor(){super(...arguments);d(this,"init$",{...this.init$,active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",t=>{this._titleEl&&(this._titleEl.style.display=t?"block":"none")}),this.sub("active",t=>{this.className=N({active:t,not_active:!t})}),this.sub("on.click",t=>{this.onclick=t})}};gt.template=`<div class="before"></div><lr-icon size="20" set="@name: icon;"></lr-icon><div class="title" ref="title-el">{{title}}</div>`;function Jn(s){let e=s+90;return e=e>=360?0:e,e}function Qn(s,e){return s==="rotate"?Jn(e):["mirror","flip"].includes(s)?!e:null}var se=class extends gt{initCallback(){super.initCallback(),this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e)}),this.$["on.click"]=e=>{let t=this.$["*cropperEl"].getValue(this._operation),i=Qn(this._operation,t);this.$["*cropperEl"].setValue(this._operation,i)}}};var Me={FILTER:"filter",COLOR_OPERATION:"color_operation"},lt="original",De=class extends ${constructor(){super(...arguments);d(this,"init$",{...this.init$,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":t=>{this.$["*faderEl"].set(t),this.$.value=t}})}setOperation(t,i){this._controlType=t==="filter"?Me.FILTER:Me.COLOR_OPERATION,this._operation=t,this._iconName=t,this._title=t.toUpperCase(),this._filter=i,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===lt?void 0:this.$.value,filter:this._filter===lt?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:t,zero:i}=J[this._operation],[r,o]=t;this.$.min=r,this.$.max=o,this.$.zero=i;let n=this.$["*editorTransformations"][this._operation];if(this._controlType===Me.FILTER){let a=o;if(n){let{name:l,amount:c}=n;a=l===this._filter?c:o}this.$.value=a,this.$.defaultValue=a}if(this._controlType===Me.COLOR_OPERATION){let a=typeof n<"u"?n:i;this.$.value=a,this.$.defaultValue=a}}apply(){let t;this._controlType===Me.FILTER?this._filter===lt?t=null:t={name:this._filter,amount:this.$.value}:t=this.$.value;let i={...this.$["*editorTransformations"],[this._operation]:t};this.$["*editorTransformations"]=i}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",t=>{this._originalUrl=t}),this.sub("value",t=>{let i=`${J[this._operation]?.label||this._filter||this._operation} ${t}`;this.$["*operationTooltip"]=i})}};De.template=`<lr-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;" ></lr-slider-ui>`;function Ne(s){let e=new Image;return{promise:new Promise((r,o)=>{e.src=s,e.onload=r,e.onerror=o}),image:e,cancel:()=>{e.naturalWidth===0&&(e.src=q)}}}function Pe(s){let e=[];for(let o of s){let n=Ne(o);e.push(n)}let t=e.map(o=>o.image);return{promise:Promise.allSettled(e.map(o=>o.promise)),images:t,cancel:()=>{e.forEach(o=>{o.cancel()})}}}var Mt=class extends gt{constructor(){super(...arguments);d(this,"init$",{...this.init$,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let t=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),i=window.devicePixelRatio,r=Math.ceil(i*t),o=i>=2?"lightest":"normal",n=100,a={...this.$["*editorTransformations"]};return a[this._operation]=this._filter!==lt?{name:this._filter,amount:n}:void 0,I(this._originalUrl,M(_i,At(a),`quality/${o}`,`scale_crop/${r}x${r}/center`))}_observerCallback(t,i){if(t[0].isIntersecting){let o=this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"],{promise:a,cancel:l}=Ne(o);this._cancelPreload=l,a.catch(c=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:c})}).finally(()=>{n.style.backgroundImage=`url(${o})`,n.setAttribute("loaded",""),i.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=i=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",i=>{this._operation="filter",this._filter=i,this.$.isOriginal=i===lt,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let t=this.$["*originalUrl"];this._originalUrl=t,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",i=>{this.$.active=i&&i===this._filter}),this.sub("isOriginal",i=>{this.$.iconSize=i?40:20}),this.sub("active",i=>{if(this.$.isOriginal)return;let r=this.ref["icon-el"];r.style.opacity=i?"1":"0";let o=this.ref["preview-el"];i?o.style.opacity="0":o.style.backgroundImage&&(o.style.opacity="1")}),this.sub("*networkProblems",i=>{if(!i){let r=this.proxyUrl(this._previewSrc()),o=this.ref["preview-el"];o.style.backgroundImage&&(o.style.backgroundImage="none",o.style.backgroundImage=`url(${r})`)}})}destroyCallback(){super.destroyCallback(),this._observer?.disconnect(),this._cancelPreload&&this._cancelPreload()}};Mt.template=`<div class="before"></div><div class="preview" ref="preview-el"></div><lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>`;var re=class extends gt{constructor(){super(...arguments);d(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",t=>{t&&(this._operation=t,this.$.icon=t,this.$.title=this.l10n(t))}),this.sub("*editorTransformations",t=>{if(!this._operation)return;let{zero:i}=J[this._operation],r=t[this._operation],o=typeof r<"u"?r!==i:!1;this.$.active=o})}};var zr=(s,e)=>{let t,i,r;return(...o)=>{t?(clearTimeout(i),i=setTimeout(()=>{Date.now()-r>=e&&(s(...o),r=Date.now())},Math.max(e-(Date.now()-r),0))):(s(...o),r=Date.now(),t=!0)}};function Hr(s,e){let t={};for(let i of e){let r=s[i];(s.hasOwnProperty(i)||r!==void 0)&&(t[i]=r)}return t}function oe(s,e,t){let r=window.devicePixelRatio,o=Math.min(Math.ceil(e*r),3e3),n=r>=2?"lightest":"normal";return I(s,M(_i,At(t),`quality/${n}`,`stretch/off/-/resize/${o}x`))}function ta(s){return s?[({dimensions:t,coords:i})=>[...t,...i].every(r=>Number.isInteger(r)&&Number.isFinite(r)),({dimensions:t,coords:i})=>t.every(r=>r>0)&&i.every(r=>r>=0)].every(t=>t(s)):!0}var Fe=class extends ${constructor(){super(),this.init$={...this.init$,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}},this._commitDebounced=L(this._commit.bind(this),300),this._handleResizeThrottled=zr(this._handleResize.bind(this),100),this._imageSize={width:0,height:0}}_handleResize(){!this.isConnected||!this._isActive||(this._initCanvas(),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let e=this.$["*editorTransformations"],t=Hr(e,Object.keys(this.$["*operations"])),i={...this.$["*operations"],...t};this.$["*operations"]=i}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),i=this.offsetWidth,r=this.offsetHeight,o=window.devicePixelRatio;e.style.width=`${i}px`,e.style.height=`${r}px`,e.width=i*o,e.height=r*o,t?.scale(o,o),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],i=this.$["*operations"],{rotate:r}=i,o={width:this.offsetWidth,height:this.offsetHeight},n=Ht({width:e.naturalWidth,height:e.naturalHeight},r),a;if(n.width>o.width-t*2||n.height>o.height-t*2){let l=n.width/n.height,c=o.width/o.height;if(l>c){let u=o.width-t*2,p=u/l,h=0+t,f=t+(o.height-t*2)/2-p/2;a={x:h,y:f,width:u,height:p}}else{let u=o.height-t*2,p=u*l,h=t+(o.width-t*2)/2-p/2,f=0+t;a={x:h,y:f,width:p,height:u}}}else{let{width:l,height:c}=n,u=t+(o.width-t*2)/2-l/2,p=t+(o.height-t*2)/2-c/2;a={x:u,y:p,width:l,height:c}}this.$["*imageBox"]=Gt(a)}_alignCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:r}=i,o=this.$["*editorTransformations"].crop,{width:n,x:a,y:l}=this.$["*imageBox"];if(o){let{dimensions:[p,h],coords:[f,m]}=o,{width:g}=Ht(this._imageSize,r),v=n/g;e=zt(Gt({x:a+f*v,y:l+m*v,width:p*v,height:h*v}),this.$["*imageBox"])}let c=this.$["*cropPresetList"]?.[0],u=c?c.width/c.height:void 0;if(!ir(e,t)||u&&!sr(e,u)){let p=t.width/t.height,h=t.width,f=t.height;u&&(p>u?h=Math.min(t.height*u,t.width):f=Math.min(t.width/u,t.height)),e={x:t.x+t.width/2-h/2,y:t.y+t.height/2-f/2,width:h,height:f}}this.$["*cropBox"]=zt(Gt(e),this.$["*imageBox"])}_drawImage(){let e=this._ctx;if(!e)return;let t=this.$.image,i=this.$["*imageBox"],r=this.$["*operations"],{mirror:o,flip:n,rotate:a}=r,l=Ht({width:i.width,height:i.height},a);e.save(),e.translate(i.x+i.width/2,i.y+i.height/2),e.rotate(a*Math.PI*-1/180),e.scale(o?-1:1,n?-1:1),e.drawImage(t,-l.width/2,-l.height/2,l.width,l.height),e.restore()}_draw(){if(!this._isActive||!this.$.image||!this._canvas||!this._ctx)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=N({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1})}))}_getCropDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:r}=i,{width:o,height:n}=t,{width:a,height:l}=Ht(this._imageSize,r),{width:c,height:u}=e,p=o/a,h=n/l;return[Ct(Math.round(c/p),1,a),Ct(Math.round(u/h),1,l)]}_getCropTransformation(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:r}=i,{width:o,height:n,x:a,y:l}=t,{width:c,height:u}=Ht(this._imageSize,r),{x:p,y:h}=e,f=o/c,m=n/u,g=this._getCropDimensions(),v={dimensions:g,coords:[Ct(Math.round((p-a)/f),0,c-g[0]),Ct(Math.round((h-l)/m),0,u-g[1])]};if(!ta(v)){console.error("Cropper is trying to create invalid crop object",{payload:v});return}if(!(g[0]===c&&g[1]===u))return v}_commit(){if(!this.isConnected)return;let e=this.$["*operations"],{rotate:t,mirror:i,flip:r}=e,o=this._getCropTransformation(),a={...this.$["*editorTransformations"],crop:o,rotate:t,mirror:i,flip:r};this.$["*editorTransformations"]=a}setValue(e,t){console.log(`Apply cropper operation [${e}=${t}]`),this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}={}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset);try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._animateIn({fromViewer:t})}catch(i){console.error("Failed to activate cropper",{error:i})}this._observer=new ResizeObserver(([i])=>{i.contentRect.width>0&&i.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeThrottled()}),this._observer.observe(this)}}deactivate({reset:e=!1}={}){this._isActive&&(!e&&this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=N({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}),this._observer?.disconnect())}_transitionToCrop(){let e=this._getCropDimensions(),t=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,i=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,r=Math.min(t,i),o=this.$["*cropBox"].x+this.$["*cropBox"].width/2,n=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${r}) translate(${(this.offsetWidth/2-o)/r}px, ${(this.offsetHeight/2-n)/r}px)`,this.style.transformOrigin=`${o}px ${n}px`}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,t=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${e}px ${t}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let i=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let r=this.proxyUrl(oe(e,i,t)),{promise:o,cancel:n,image:a}=Ne(r),l=this._handleImageLoading(r);return a.addEventListener("load",l,{once:!0}),a.addEventListener("error",l,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=n,o.then(()=>a).catch(c=>(console.error("Failed to load image",{error:c}),this.$["*networkProblems"]=!0,Promise.resolve(a)))}_handleImageLoading(e){let t="crop",i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{i?.get(t)?.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}initCallback(){super.initCallback(),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",()=>{this.$.image&&this._commitDebounced()}),this.sub("*cropPresetList",()=>{this._alignCrop()}),setTimeout(()=>{this.sub("*networkProblems",e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){super.destroyCallback(),this._observer?.disconnect()}};Fe.template=`<canvas class="canvas" ref="canvas-el"></canvas><lr-crop-frame ref="frame-el"></lr-crop-frame>`;function ms(s,e,t){let i=Array(t);t--;for(let r=t;r>=0;r--)i[r]=Math.ceil((r*e+(t-r)*s)/t);return i}function ea(s){return s.reduce((e,t,i)=>i<s.length-1?[...e,[t,s[i+1]]]:e,[])}function ia(s,e,t){let i=ea(s).find(([r,o])=>r<=e&&e<=o);return s.map(r=>{let o=Math.abs(i[0]-i[1]),n=Math.abs(e-i[0])/o;return i[0]===r?e>t?1:1-n:i[1]===r?e>=t?n:1:0})}function sa(s,e){return s.map((t,i)=>t<e?s.length-i:i)}function Gr(s,e){let t=J[s].keypointsNumber,{range:i,zero:r}=J[s];return[...new Set([...ms(i[0],r,t+1),...ms(r,i[1],t+1),r,e])].sort((o,n)=>o-n)}var Si=class extends ${constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=L(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(e){let t=this._operation,i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{i?.get(t)?.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let e of this._keypoints){let{image:t}=e;t&&(t.style.opacity=e.opacity.toString(),t.style.zIndex=e.zIndex.toString())}})}_imageSrc({url:e=this._url,filter:t=this._filter,operation:i,value:r}={}){let o={...this._transformations};i&&(o[i]=t?{name:t,amount:r}:r);let n=this.offsetWidth;return this.proxyUrl(oe(e,n,o))}_constructKeypoint(e,t){return{src:this._imageSrc({operation:e,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(e,t){return this._operation===e&&this._filter===t}_addKeypoint(e,t,i){let r=()=>!this._isSame(e,t)||this._value!==i||!!this._keypoints.find(l=>l.value===i);if(r())return;let o=this._constructKeypoint(e,i),n=new Image;n.src=o.src;let a=this._handleImageLoading(o.src);n.addEventListener("load",a,{once:!0}),n.addEventListener("error",a,{once:!0}),o.image=n,n.classList.add("fader-image"),n.addEventListener("load",()=>{if(r())return;let l=this._keypoints,c=l.findIndex(p=>p.value>i),u=c<l.length?l[c].image:null;!this._container||u&&!this._container.contains(u)||(l.splice(c,0,o),this._container.insertBefore(n,u),this._update(e,i))},{once:!0}),n.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(e){e=typeof e=="string"?parseInt(e,10):e,this._update(this._operation,e),this._addKeypointDebounced(this._operation,this._filter,e)}_update(e,t){this._operation=e,this._value=t;let{zero:i}=J[e],r=this._keypoints.map(a=>a.value),o=ia(r,t,i),n=sa(r,i);for(let[a,l]of Object.entries(this._keypoints))l.opacity=o[a],l.zIndex=n[a];this._flush()}_createPreviewImage(){let e=new Image;return e.classList.add("fader-image","fader-image--preview"),e.style.opacity="0",e}async _initNodes(){let e=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&e.appendChild(this._previewImage);let t=document.createElement("div");e.appendChild(t);let i=this._keypoints.map(c=>c.src),{images:r,promise:o,cancel:n}=Pe(i);r.forEach(c=>{let u=this._handleImageLoading(c.src);c.addEventListener("load",u),c.addEventListener("error",u)}),this._cancelLastImages=()=>{n(),this._cancelLastImages=void 0};let a=this._operation,l=this._filter;await o,this._isActive&&this._isSame(a,l)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach((c,u)=>{let p=r[u];p.classList.add("fader-image"),c.image=p,this._container.appendChild(p)}),this.appendChild(e),this._flush())}setTransformations(e){if(this._transformations=e,this._previewImage){let t=this._imageSrc(),i=this._handleImageLoading(t);this._previewImage.src=t,this._previewImage.addEventListener("load",i,{once:!0}),this._previewImage.addEventListener("error",i,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:e,filter:t,operation:i,value:r}){this._cancelBatchPreload&&this._cancelBatchPreload();let n=Gr(i,r).map(l=>this._imageSrc({url:e,filter:t,operation:i,value:l})),{cancel:a}=Pe(n);this._cancelBatchPreload=a}_setOriginalSrc(e){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===e){t.style.opacity="1",t.style.transform="scale(1)",this.className=N({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1});return}t.style.opacity="0";let i=this._handleImageLoading(e);t.addEventListener("error",i,{once:!0}),t.src=e,t.addEventListener("load",()=>{i(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=N({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))},{once:!0}),t.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:e,operation:t,value:i,filter:r,fromViewer:o}){if(this._isActive=!0,this._hidden=!1,this._url=e,this._operation=t||"initial",this._value=i,this._filter=r,this._fromViewer=o,typeof i!="number"&&!r){let a=this._imageSrc({operation:t,value:i});this._setOriginalSrc(a),this._container&&this._container.remove();return}this._keypoints=Gr(t,i).map(a=>this._constructKeypoint(t,a)),this._update(t,i),this._initNodes()}deactivate({hide:e=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),e&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=N({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}};var ra=1,Be=class extends ${initCallback(){super.initCallback(),this.addEventListener("wheel",e=>{e.preventDefault();let{deltaY:t,deltaX:i}=e;Math.abs(i)>ra?this.scrollLeft+=i:this.scrollLeft+=t})}};Be.template=" <slot></slot> ";function oa(s){return`<lr-presence-toggle class="tab-toggle" set="visible: presence.tabToggle.${s}; styles: presence.tabToggleStyles;"><lr-btn-ui theme="boring" ref="tab-toggle-${s}" data-id="${s}" icon="${s}" tabindex="0" set="onclick: on.clickTab;" ></lr-btn-ui></lr-presence-toggle>`}function na(s){return`<lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${s}; styles: presence.tabContentStyles"><lr-editor-scroller hidden-scrollbar><div class="controls-list_align"><div class="controls-list_inner" ref="controls-list-${s}"></div></div></lr-editor-scroller></lr-presence-toggle>`}var Ve=class extends ${constructor(){super();d(this,"_updateInfoTooltip",L(()=>{let t=this.$["*editorTransformations"],i=this.$["*currentOperation"],r="",o=!1;if(this.$["*tabId"]===R.FILTERS)if(o=!0,this.$["*currentFilter"]&&t?.filter?.name===this.$["*currentFilter"]){let n=t?.filter?.amount||100;r=this.l10n(this.$["*currentFilter"])+" "+n}else r=this.l10n(lt);else if(this.$["*tabId"]===R.TUNING&&i){o=!0;let n=t?.[i]||J[i].zero;r=(J[i]?.label||i)+" "+n}o&&(this.$["*operationTooltip"]=r),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",o)},0));this.init$={...this.init$,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":lt,"*currentOperation":null,showLoader:!1,filters:Er,colorOperations:Cr,cropOperations:Ar,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabToggles":!0,"presence.tabContent.crop":!1,"presence.tabContent.tuning":!1,"presence.tabContent.filters":!1,"presence.tabToggle.crop":!0,"presence.tabToggle.tuning":!0,"presence.tabToggle.filters":!0,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"presence.tabToggleStyles":{hidden:"tab-toggle--hidden",visible:"tab-toggle--visible"},"presence.tabTogglesStyles":{hidden:"tab-toggles--hidden",visible:"tab-toggles--visible"},"on.cancel":()=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":()=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":()=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":()=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":t=>{let i=t.currentTarget.getAttribute("data-id");i&&this._activateTab(i,{fromViewer:!1})}},this._debouncedShowLoader=L(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===R.TUNING&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(t){let i=new re;return i.operation=t,i}_createFilterControl(t){let i=new Mt;return i.filter=t,i}_createToggleControl(t){let i=new se;return i.operation=t,i}_renderControlsList(t){let i=this.ref[`controls-list-${t}`],r=document.createDocumentFragment();t===R.CROP?this.$.cropOperations.forEach(o=>{let n=this._createToggleControl(o);r.appendChild(n)}):t===R.FILTERS?[lt,...this.$.filters].forEach(o=>{let n=this._createFilterControl(o);r.appendChild(n)}):t===R.TUNING&&this.$.colorOperations.forEach(o=>{let n=this._createOperationControl(o);r.appendChild(n)}),[...r.children].forEach((o,n)=>{n===r.childNodes.length-1&&o.classList.add("controls-list_last-item")}),i.innerHTML="",i.appendChild(r)}_activateTab(t,{fromViewer:i}){this.$["*tabId"]=t,t===R.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:i})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:i}),this.$["*cropperEl"].deactivate());for(let r of j){let o=r===t,n=this.ref[`tab-toggle-${r}`];n.active=o,o?(this._renderControlsList(t),this._syncTabIndicator()):this._unmountTabControls(r),this.$[`presence.tabContent.${r}`]=o}}_unmountTabControls(t){let i=this.ref[`controls-list-${t}`];i&&(i.innerHTML="")}_syncTabIndicator(){let t=this.ref[`tab-toggle-${this.$["*tabId"]}`],i=this.ref["tabs-indicator"];i.style.transform=`translateX(${t.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let t=this.$["*imgContainerEl"].offsetWidth,i=this.proxyUrl(oe(this.$["*originalUrl"],t,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:r}=Pe([i]);this._cancelPreload=()=>{r(),this._cancelPreload=void 0}}}_showLoader(t){this.$.showLoader=t}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",t=>{t&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",t=>{let i=t?.filter?.name;this.$["*currentFilter"]!==i&&(this.$["*currentFilter"]=i)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",()=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",t=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(t)}),this.sub("*loadingOperations",t=>{let i=!1;for(let[,r]of t.entries()){if(i)break;for(let[,o]of r.entries())if(o){i=!0;break}}this._debouncedShowLoader(i)}),this.sub("*showSlider",t=>{this.$["presence.subToolbar"]=t,this.$["presence.mainToolbar"]=!t}),this.sub("*tabList",t=>{this.$["presence.tabToggles"]=t.length>1;for(let i of j){this.$[`presence.tabToggle.${i}`]=t.includes(i);let r=this.ref[`tab-toggle-${i}`];r.style.gridColumn=t.indexOf(i)+1}t.includes(this.$["*tabId"])||this._activateTab(t[0],{fromViewer:!1})}),this._updateInfoTooltip()}};Ve.template=`<lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="info-tooltip_container"><div class="info-tooltip_wrapper"><div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div></div></div><div class="toolbar-container"><lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"><div class="tab-content-row">${j.map(na).join("")}</div><div class="controls-row"><lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"></lr-btn-ui><lr-presence-toggle class="tab-toggles" set="visible: presence.tabToggles; styles: presence.tabTogglesStyles"><div ref="tabs-indicator" class="tab-toggles_indicator"></div> ${j.map(oa).join("")} </lr-presence-toggle><lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"></lr-btn-ui></div></lr-presence-toggle><lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"><div class="slider"><lr-editor-slider ref="slider-el"></lr-editor-slider></div><div class="controls-row"><lr-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"></lr-btn-ui><lr-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"></lr-btn-ui></div></lr-presence-toggle></div>`;var ne=class extends _{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.init$,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return N("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",e=>{this._iconSingle=!this.$.text,this._iconHidden=!e,this.$.iconCss=this._iconCss()}),this.sub("theme",e=>{e!=="custom"&&(this.className=e)}),this.sub("text",e=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(e){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}};ne.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});ne.template=`<lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon><div class="text">{{text}}</div>`;var ze=class extends _{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",e=>{typeof e=="boolean"&&(e?this._start():this._stop())})}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${e}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}};ze.template=`<div class="inner"><div class="line" ref="line-el"></div></div>`;var Li={transition:"transition",visible:"visible",hidden:"hidden"},He=class extends _{constructor(){super(),this._visible=!1,this._visibleStyle=Li.visible,this._hiddenStyle=Li.hidden,this._externalTransitions=!1,this.defineAccessor("styles",e=>{e&&(this._externalTransitions=!0,this._visibleStyle=e.visible,this._hiddenStyle=e.hidden)}),this.defineAccessor("visible",e=>{typeof e=="boolean"&&(this._visible=e,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",Pr(this,{[Li.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(Li.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}};He.template=" <slot></slot> ";var Ge=class extends _{constructor(){super();d(this,"init$",{...this.init$,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t),this.$.onInput&&this.$.onInput(t)},"on.sliderChange":()=>{let t=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(t)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",i=>{this.$.disabled=i}),this.defineAccessor("min",i=>{this.$.min=i}),this.defineAccessor("max",i=>{this.$.max=i}),this.defineAccessor("defaultValue",i=>{this.$.defaultValue=i,this.ref["input-el"].value=i,this._updateValue(i)}),this.defineAccessor("zero",i=>{this._zero=i}),this.defineAccessor("onInput",i=>{i&&(this.$.onInput=i)}),this.defineAccessor("onChange",i=>{i&&(this.$.onChange=i)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let i=parseInt(this.ref["input-el"].value,10);this._updateValue(i)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let i=parseInt(this.ref["input-el"].value,10);this._updateValue(i)},0),this.sub("disabled",i=>{let r=this.ref["input-el"];i?r.setAttribute("disabled","disabled"):r.removeAttribute("disabled")});let t=this.ref["input-el"];t.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),t.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(t){this._updateZeroDot(t);let{width:i}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(t-this.$.min)*(i-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${n}px)`})}_updateZeroDot(t){if(!this._zeroDotEl)return;t===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:i}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(i-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${n}px)`})}_updateSteps(){let i=this.ref["steps-el"],{width:r}=i.getBoundingClientRect(),o=Math.ceil(r/2),n=Math.ceil(o/15)-2;if(this._stepsCount===n)return;let a=document.createDocumentFragment(),l=document.createElement("div"),c=document.createElement("div");l.className="minor-step",c.className="border-step",a.appendChild(c);for(let p=0;p<n;p++)a.appendChild(l.cloneNode());a.appendChild(c.cloneNode());for(let p=0;p<n;p++)a.appendChild(l.cloneNode());a.appendChild(c.cloneNode());let u=document.createElement("div");u.className="zero-dot",a.appendChild(u),this._zeroDotEl=u,i.innerHTML="",i.appendChild(a),this._stepsCount=n}destroyCallback(){this._observer?.disconnect()}};Ge.template=`<div class="steps" ref="steps-el"></div><div ref="thumb-el" class="thumb"></div><input class="input" type="range" ref="input-el" tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;" />`;var ki=class extends E{constructor(){super();d(this,"couldBeCtxOwner",!0);d(this,"activityType",b.activities.CLOUD_IMG_EDIT);this.init$={...this.init$,cdnUrl:null}}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.sub("*focusedEntry",t=>{t&&(this.entry=t,this.entry.subscribe("cdnUrl",i=>{i&&(this.$.cdnUrl=i)}))}),this.subConfigValue("cropPreset",t=>{this._instance&&this._instance.getAttribute("crop-preset")!==t&&this._instance.setAttribute("crop-preset",t)}),this.subConfigValue("cloudImageEditorTabs",t=>{this._instance&&this._instance.getAttribute("tabs")!==t&&this._instance.setAttribute("tabs",t)})}handleApply(t){if(!this.entry)return;let i=t.detail;this.entry.setMultipleValues({cdnUrl:i.cdnUrl,cdnUrlModifiers:i.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let t=new et,i=this.$.cdnUrl,r=this.cfg.cropPreset,o=this.cfg.cloudImageEditorTabs;t.setAttribute("ctx-name",this.ctxName),t.setAttribute("cdn-url",i),r&&t.setAttribute("crop-preset",r),o&&t.setAttribute("tabs",o),t.addEventListener("apply",n=>this.handleApply(n)),t.addEventListener("cancel",()=>this.handleCancel()),this.innerHTML="",this.appendChild(t),this._mounted=!0,this._instance=t}unmountEditor(){this._instance=void 0,this.innerHTML=""}};var aa=function(s){return s.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},Xr=function(s,e="i"){let t=s.split("*").map(aa);return new RegExp("^"+t.join(".+")+"$",e)};var la=s=>Object.keys(s).reduce((t,i)=>{let r=s[i],o=Object.keys(r).reduce((n,a)=>{let l=r[a];return n+`${a}: ${l};`},"");return t+`${i}{${o}}`},"");function jr({textColor:s,backgroundColor:e,linkColor:t,linkColorHover:i,shadeColor:r}){let o=`solid 1px ${r}`;return la({body:{color:s,"background-color":e},".side-bar":{background:"inherit","border-right":o},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:r},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":o},".list-table-body .list-items":{"border-bottom":o},".bread-crumbs a":{color:t},".bread-crumbs a:hover":{color:i},".main-content.loading":{background:`${e} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:t},".source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu a:hover":{color:i},".side-bar-menu a":{color:t},".side-bar-menu a:hover":{color:i},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:i},".source-vk .side-bar-menu a":{color:t},".source-vk .side-bar-menu a:hover":{color:i,background:"none"},".welcome-button, .big-button":{"background-color":"#ffffff !important",border:`1px solid ${t} !important`,color:`${t} !important`,"border-radius":"8px important"},".welcome-button:hover, .big-button:hover":{"background-color":`${i} important`,border:`1px solid ${t} important`,color:`${t} important`},".list-icons-item":{width:"31% !important",height:"auto !important","padding-top":"31% !important","background-color":r},".menu-item":{display:"inline-block",margin:"0 5px !important"},".side-bar-menu":{"text-align":"center !important"}})+`@media (min-width: 660px) { .side-bar-menu { text-align: left !important; } .menu-item { margin: 0 !important; display: block; } }`}var Tt={};window.addEventListener("message",s=>{let e;try{e=JSON.parse(s.data)}catch{return}if(e?.type in Tt){let t=Tt[e.type];for(let[i,r]of t)s.source===i&&r(e)}});var Kr=function(s,e,t){s in Tt||(Tt[s]=[]),Tt[s].push([e,t])},Wr=function(s,e){s in Tt&&(Tt[s]=Tt[s].filter(t=>t[0]!==e))};function qr(s){let e=[];for(let[t,i]of Object.entries(s))i==null||typeof i=="string"&&i.length===0||e.push(`${t}=${encodeURIComponent(i)}`);return e.join("&")}var Xe=class extends E{constructor(){super();d(this,"couldBeCtxOwner",!0);d(this,"activityType",b.activities.EXTERNAL);d(this,"_iframe",null);d(this,"updateCssData",()=>{this.isActivityActive&&(this._inheritedUpdateCssData(),this.applyStyles())});d(this,"_inheritedUpdateCssData",this.updateCssData);this.init$={...this.init$,activityIcon:"",activityCaption:"",selectedList:[],counter:0,multiple:!1,onDone:()=>{for(let t of this.$.selectedList){let i=this.extractUrlFromMessage(t),{filename:r}=t,{externalSourceType:o}=this.activityParams;this.addFileFromUrl(i,{fileName:r,source:o})}this.$["*currentActivity"]=b.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()}}}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:t}=this.activityParams;this.set$({activityCaption:`${t?.[0].toUpperCase()}${t?.slice(1)}`,activityIcon:t}),this.mountIframe()}}),this.sub("*currentActivity",t=>{t!==this.activityType&&this.unmountIframe()}),this.sub("selectedList",t=>{this.$.counter=t.length}),this.subConfigValue("multiple",t=>{this.$.multiple=t})}extractUrlFromMessage(t){if(t.alternatives){let i=D(this.cfg.externalSourcesPreferredTypes);for(let r of i){let o=Xr(r);for(let[n,a]of Object.entries(t.alternatives))if(o.test(n))return a}}return t.url}sendMessage(t){this._iframe?.contentWindow?.postMessage(JSON.stringify(t),"*")}async handleFileSelected(t){!this.$.multiple&&this.$.selectedList.length||(this.$.selectedList=[...this.$.selectedList,t],(!this.$.multiple||this.cfg.multipleMax===this.$["*uploadList"]?.length+this.$.selectedList?.length)&&this.$.onDone())}handleIframeLoad(){this.applyStyles()}getCssValue(t){return window.getComputedStyle(this).getPropertyValue(t).trim()}applyStyles(){let t={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:this.getCssValue("--clr-accent"),linkColorHover:this.getCssValue("--clr-accent-light")};this.sendMessage({type:"embed-css",style:jr(t)})}remoteUrl(){let t=this.cfg.pubkey,i="false",{externalSourceType:r}=this.activityParams,o={lang:this.getCssData("--l10n-locale-name")?.split("-")?.[0]||"en",public_key:t,images_only:i,pass_window_open:!1,session_key:this.cfg.remoteTabSessionKey},n=new URL(this.cfg.socialBaseUrl);return n.pathname=`/window3/${r}`,n.search=qr(o),n.toString()}mountIframe(){let t=me({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});t.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(t),Kr("file-selected",t.contentWindow,this.handleFileSelected.bind(this)),this._iframe=t,this.$.selectedList=[]}unmountIframe(){this._iframe&&Wr("file-selected",this._iframe.contentWindow),this.ref.iframeWrapper.innerHTML="",this._iframe=null,this.$.selectedList=[],this.$.counter=0}};Xe.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div><lr-icon set="@name: activityIcon"></lr-icon><span>{{activityCaption}}</span></div><button type="button" class="mini-btn close-btn" set="onclick: *historyBack"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><div ref="iframeWrapper" class="iframe-wrapper"></div><div class="toolbar"><button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button><div></div><div set="@hidden: !multiple" class="selected-counter"><span l10n="selected-count"></span>{{counter}}</div><button type="button" class="done-btn primary-btn" set="onclick: onDone; @disabled: !counter"><lr-icon name="check"></lr-icon></button></div></div>`;var ae=class extends _{setCurrentTab(e){if(!e)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach(i=>{i.getAttribute("tab-ctx")===e?i.removeAttribute("hidden"):i.setAttribute("hidden","")});for(let i in this._tabMap)i===e?this._tabMap[i].setAttribute("current",""):this._tabMap[i].removeAttribute("current")}initCallback(){super.initCallback(),this._tabMap={},this.defineAccessor("tab-list",e=>{if(!e)return;D(e).forEach(i=>{let r=me({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(i)}}});r.textContent=this.l10n(i),this.ref.row.appendChild(r),this._tabMap[i]=r})}),this.defineAccessor("default",e=>{this.setCurrentTab(e)}),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}};ae.bindAttributes({"tab-list":null,default:null});ae.template=`<div ref="row" class="tabs-row"></div><div ref="context" class="tabs-context"><slot></slot></div>`;var Ii=class extends E{constructor(){super();d(this,"processInnerHtml",!0);d(this,"requireCtxName",!0);this.init$={...this.init$,output:null}}get dict(){return fs.dict}get validationInput(){return this._validationInputElement}initCallback(){if(super.initCallback(),this.hasAttribute(this.dict.FORM_INPUT_ATTR)){this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer);let t=document.createElement("input");t.type="text",t.name="__UPLOADCARE_VALIDATION_INPUT__",t.required=this.hasAttribute(this.dict.INPUT_REQUIRED),t.tabIndex=-1,Yi(t,{opacity:0,height:0,width:0}),this.appendChild(t),this._validationInputElement=t}this.sub("output",t=>{if(this.hasAttribute(this.dict.FIRE_EVENT_ATTR)&&this.dispatchEvent(new CustomEvent(this.dict.EVENT_NAME,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:t}})),this.hasAttribute(this.dict.FORM_INPUT_ATTR)&&this._dynamicInputsContainer){this._dynamicInputsContainer.innerHTML="";let i=[],r=[];Array.isArray(t)?(i=t.map(o=>o.cdnUrl),r=t):t?.files&&(i=t.groupData?[t.groupData.cdnUrl]:[],r=t.files);for(let o of i){let n=document.createElement("input");n.type="hidden",n.name=this.getAttribute(this.dict.INPUT_NAME_ATTR)||this.ctxName,n.value=o??"",this._dynamicInputsContainer.appendChild(n)}if(this._validationInputElement){this._validationInputElement.value=i.length?"__VALUE__":"";let o=r.find(c=>!c.isValid),n=o?.validationErrorMessage??o?.uploadError?.message,a=this.$["*message"];a=a?.isError?`${a.caption}. ${a.text}`:void 0;let l=n??a;l?this._validationInputElement.setCustomValidity(l):this._validationInputElement.setCustomValidity("")}}this.hasAttribute(this.dict.CONSOLE_ATTR)},!1),this.sub(this.dict.SRC_CTX_KEY,async t=>{if(!t||!t.length){this.$.output=null;return}if(this.cfg.groupOutput||this.hasAttribute(this.dict.GROUP_ATTR)){if(!t.every(a=>a.isUploaded&&a.isValid)){this.$.output={groupData:void 0,files:t};return}let r=this.getUploadClientOptions(),o=t.map(a=>a.uuid+(a.cdnUrlModifiers?`/${a.cdnUrlModifiers}`:"")),n=await Ms(o,r);this.$.output={groupData:n,files:t}}else this.$.output=t},!1)}};Ii.dict=Object.freeze({SRC_CTX_KEY:"*outputData",EVENT_NAME:"lr-data-output",FIRE_EVENT_ATTR:"use-event",CONSOLE_ATTR:"use-console",GROUP_ATTR:"use-group",FORM_INPUT_ATTR:"use-input",INPUT_NAME_ATTR:"input-name",INPUT_REQUIRED:"input-required"});var fs=Ii;var Ri=class extends b{};var je=class extends _{constructor(){super(...arguments);d(this,"init$",{...this.init$,currentText:"",options:[],selectHtml:"",onSelect:t=>{t.preventDefault(),t.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=this.$.options.find(i=>i.value==this.value)?.text||"",this.dispatchEvent(new Event("change"))}})}initCallback(){super.initCallback(),this.sub("options",t=>{this.$.currentText=t?.[0]?.text||"";let i="";t?.forEach(r=>{i+=`<option value="${r.value}">${r.text}</option>`}),this.$.selectHtml=i})}};je.template=`<button> {{currentText}} <lr-icon name="select"></lr-icon><select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select></button>`;var K={PLAY:"play",PAUSE:"pause",FS_ON:"fullscreen-on",FS_OFF:"fullscreen-off",VOL_ON:"unmute",VOL_OFF:"mute",CAP_ON:"captions",CAP_OFF:"captions-off"},Yr={requestFullscreen:s=>{s.requestFullscreen?s.requestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()},exitFullscreen:()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}},le=class s extends _{constructor(){super(...arguments);d(this,"init$",{...this.init$,src:"",ppIcon:K.PLAY,fsIcon:K.FS_ON,volIcon:K.VOL_ON,capIcon:K.CAP_OFF,totalTime:"00:00",currentTime:"00:00",progressCssWidth:"0",hasSubtitles:!1,volumeDisabled:!1,volumeValue:0,onPP:()=>{this.togglePlay()},onFs:()=>{this.toggleFullscreen()},onCap:()=>{this.toggleCaptions()},onMute:()=>{this.toggleSound()},onVolChange:t=>{let i=parseFloat(t.currentTarget.$.value);this.setVolume(i)},progressClicked:t=>{let i=this.progress.getBoundingClientRect();this._video.currentTime=this._video.duration*(t.offsetX/i.width)}})}togglePlay(){this._video.paused||this._video.ended?this._video.play():this._video.pause()}toggleFullscreen(){(document.fullscreenElement||document.webkitFullscreenElement)===this?Yr.exitFullscreen():Yr.requestFullscreen(this)}toggleCaptions(){this.$.capIcon===K.CAP_OFF?(this.$.capIcon=K.CAP_ON,this._video.textTracks[0].mode="showing",window.localStorage.setItem(s.is+":captions","1")):(this.$.capIcon=K.CAP_OFF,this._video.textTracks[0].mode="hidden",window.localStorage.removeItem(s.is+":captions"))}toggleSound(){this.$.volIcon===K.VOL_ON?(this.$.volIcon=K.VOL_OFF,this.$.volumeDisabled=!0,this._video.muted=!0):(this.$.volIcon=K.VOL_ON,this.$.volumeDisabled=!1,this._video.muted=!1)}setVolume(t){window.localStorage.setItem(s.is+":volume",t);let i=t?t/100:0;this._video.volume=i}get progress(){return this.ref.progress}_getUrl(t){return t.includes("/")?t:`https://ucarecdn.com/${t}/`}_desc2attrs(t){let i=[];for(let r in t){let o=r==="src"?this._getUrl(t[r]):t[r];i.push(`${r}="${o}"`)}return i.join(" ")}_timeFmt(t){let i=new Date(Math.round(t)*1e3);return[i.getMinutes(),i.getSeconds()].map(r=>r<10?"0"+r:r).join(":")}_initTracks(){[...this._video.textTracks].forEach(t=>{t.mode="hidden"}),window.localStorage.getItem(s.is+":captions")&&this.toggleCaptions()}_castAttributes(){let t=["autoplay","loop","muted"];[...this.attributes].forEach(i=>{t.includes(i.name)&&this._video.setAttribute(i.name,i.value)})}initCallback(){super.initCallback(),this._video=this.ref.video,this._castAttributes(),this._video.addEventListener("play",()=>{this.$.ppIcon=K.PAUSE,this.setAttribute("playback","")}),this._video.addEventListener("pause",()=>{this.$.ppIcon=K.PLAY,this.removeAttribute("playback")}),this.addEventListener("fullscreenchange",i=>{document.fullscreenElement===this?this.$.fsIcon=K.FS_OFF:this.$.fsIcon=K.FS_ON}),this.sub("src",i=>{if(!i)return;let r=this._getUrl(i);this._video.src=r}),this.sub("video",async i=>{if(!i)return;let r=await(await window.fetch(this._getUrl(i))).json();r.poster&&(this._video.poster=this._getUrl(r.poster));let o="";r?.sources.forEach(n=>{o+=`<source ${this._desc2attrs(n)} />`}),r.tracks&&(r.tracks.forEach(n=>{o+=`<track ${this._desc2attrs(n)} />`}),this.$.hasSubtitles=!0),this._video.innerHTML+=o,this._initTracks()}),this._video.addEventListener("loadedmetadata",i=>{this.$.currentTime=this._timeFmt(this._video.currentTime),this.$.totalTime=this._timeFmt(this._video.duration)}),this._video.addEventListener("timeupdate",i=>{let r=Math.round(100*(this._video.currentTime/this._video.duration));this.$.progressCssWidth=r+"%",this.$.currentTime=this._timeFmt(this._video.currentTime)});let t=window.localStorage.getItem(s.is+":volume");if(t){let i=parseFloat(t);this.setVolume(i),this.$.volumeValue=i}}};le.template=`<div class="video-wrapper"><video ref="video" preload="metadata" crossorigin="anonymous"></video></div><div class="toolbar"><div class="progress" ref="progress" set -onclick="progressClicked"><div class="bar" set -style.width="progressCssWidth"></div></div><div class="tb-block"><button set -onclick="onPP"><lr-icon set -@name="ppIcon"></lr-icon></button><div class="timer">{{currentTime}} / {{totalTime}}</div></div><div class="tb-block"><button set -onclick="onCap" -@hidden="!hasSubtitles"><lr-icon set -@name="capIcon"></lr-icon></button><button set -onclick="onMute"><lr-icon set -@name="volIcon"></lr-icon></button><lr-range type="range" set -onchange="onVolChange" -@disabled="volumeDisabled" -value="volumeValue"></lr-range><button set -onclick="onFs"><lr-icon set -@name="fsIcon"></lr-icon></button></div></div>`;le.bindAttributes({video:"video",src:"src"});var ca="css-src";function Ke(s){return class extends s{constructor(){super(...arguments);d(this,"renderShadow",!0);d(this,"pauseRender",!0);d(this,"requireCtxName",!0)}shadowReadyCallback(){}initCallback(){super.initCallback(),this.setAttribute("hidden",""),di({element:this,attribute:ca,onSuccess:t=>{this.attachShadow({mode:"open"});let i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t,i.onload=()=>{window.requestAnimationFrame(()=>{this.render(),window.setTimeout(()=>{this.removeAttribute("hidden"),this.shadowReadyCallback()})})},this.shadowRoot.prepend(i)},onTimeout:()=>{console.error("Attribute `css-src` is required and it is not set. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/")}})}}}var ce=class extends Ke(_){};var We=class extends _{initCallback(){super.initCallback(),this.subConfigValue("removeCopyright",e=>{this.toggleAttribute("hidden",!!e)})}};d(We,"template",`<a href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4" target="_blank noopener" class="credits" >Powered by Uploadcare</a >`);var qe=class extends _{constructor(){super(),this.init$={...this.init$}}};qe.template=`<div class="mtn-files-item"><img src="{{cdnURL}}" /></div>`;var Ye=class extends E{constructor(){super();d(this,"couldBeCtxOwner",!0);d(this,"historyTracked",!0);d(this,"activityType",b.activities.MTN_ACCEPT_SCREEN);d(this,"_debouncedHandleCollectionUpdate",L(()=>{this.isConnected&&(this._updateUploadsState(),this._updateCountLimitMessage(),!this.couldOpenActivity&&this.$["*currentActivity"]===this.activityType&&this.historyBack(),this.ckeckFiles())},0));this.init$={...this.init$,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",previewURLs:[],hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.uploadAll(),this._updateUploadsState()},onDone:()=>{this.doneFlow()},onCancel:()=>{let t=this.getOutputData(i=>!!i.getValue("fileInfo"));this.emit(S.REMOVE,t,{debounce:!0}),this.uploadCollection.clearAll()}}}ckeckFiles(){let t=this.uploadCollection.items(),i=[];for(let r of t){let o=this.uploadCollection.read(r);i.push({cdnURL:o.getValue("cdnUrl")})}this.$.previewURLs=i}_validateFilesCount(){let t=!!this.cfg.multiple,i=t?this.cfg.multipleMin??0:1,r=t?this.cfg.multipleMax??0:1,o=this.uploadCollection.size,n=i?o<i:!1,a=r?o>r:!1;return{passed:!n&&!a,tooFew:n,tooMany:a,min:i,max:r,exact:r===o}}_updateCountLimitMessage(){let t=this.uploadCollection.size,i=this._validateFilesCount();if(t&&!i.passed){let r=new ee,o=i.tooFew?"files-count-limit-error-too-few":"files-count-limit-error-too-many";r.caption=this.l10n("files-count-limit-error-title"),r.text=this.l10n(o,{min:i.min,max:i.max,total:t}),r.isError=!0,this.set$({"*message":r})}else this.set$({"*message":null})}_updateUploadsState(){let t=this.uploadCollection.items(),r={total:t.length,succeed:0,uploading:0,failed:0,limitOverflow:0};for(let f of t){let m=this.uploadCollection.read(f);m.getValue("fileInfo")&&!m.getValue("validationErrorMsg")&&(r.succeed+=1),m.getValue("isUploading")&&(r.uploading+=1),(m.getValue("validationErrorMsg")||m.getValue("uploadError"))&&(r.failed+=1),m.getValue("validationMultipleLimitMsg")&&(r.limitOverflow+=1)}let{passed:o,tooMany:n,exact:a}=this._validateFilesCount(),l=r.failed===0&&r.limitOverflow===0,c=!1,u=!1,p=!1;r.total-r.succeed-r.uploading-r.failed>0&&o?c=!0:(u=!0,p=r.total===r.succeed&&o&&l),this.set$({doneBtnVisible:u,doneBtnEnabled:p,uploadBtnVisible:c,addMoreBtnEnabled:r.total===0||!n&&!a,addMoreBtnVisible:!a||this.cfg.multiple,headerText:window.UploadCareLocales?.text.dialog_title||"Product Preview"})}get couldOpenActivity(){return this.cfg.showEmptyList||this.uploadCollection.size>0}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.$["*headerTitle"]="Upload imag",this.subConfigValue("multiple",this._debouncedHandleCollectionUpdate),this.subConfigValue("multipleMin",this._debouncedHandleCollectionUpdate),this.subConfigValue("multipleMax",this._debouncedHandleCollectionUpdate),this.sub("*currentActivity",t=>{!this.couldOpenActivity&&t===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observeProperties(this._debouncedHandleCollectionUpdate),this.sub("*uploadList",t=>{this._debouncedHandleCollectionUpdate(),this.set$({hasFiles:t.length>0}),this.cfg.confirmUpload||this.add$({"*uploadTrigger":{}},!0)})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._debouncedHandleCollectionUpdate)}};Ye.template=`<div class="accept-screen"><div class="accept-screen__files"><div class="no-files" set="@hidden: hasFiles"><slot name="empty"><span l10n="no-files"></span></slot></div><div class="mtn-files" repeat="previewURLs" repeat-item-tag="lr-mtn-file-item"></div></div><div class="accept-screen__form">Accept conditions?</div></div><div class="toolbar"><button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button><div class="toolbar-spacer"></div><button type="button" class="add-more-btn secondary-btn" set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible" ><lr-icon name="add"></lr-icon><span l10n="add-more"></span></button><button type="button" class="upload-btn primary-btn" set="@hidden: !uploadBtnVisible; onclick: onUpload;" l10n="upload" ></button><button type="button" class="done-btn primary-btn" set="@hidden: !doneBtnVisible; onclick: onDone; @disabled: !doneBtnEnabled" l10n="done" ></button></div><lr-drop-area ghost></lr-drop-area>`;var Ot=class extends ce{constructor(){super(...arguments);d(this,"requireCtxName",!0);d(this,"init$",ui(this));d(this,"_template",null)}static set template(t){this._template=t+"<slot></slot>"}static get template(){return this._template}};var Dt=class extends Ot{};Dt.template=`<lr-simple-btn class="open-dialog"></lr-simple-btn><lr-modal strokes block-body-scrolling><lr-start-from><lr-drop-area with-icon clickable></lr-drop-area><div class="alternative-source info-text">${window.UploadCareLocales?.text?.chooseFrom||"or choose from"}</div><lr-source-list wrap></lr-source-list><button type="button" class="secondary-btn" set="onclick: *historyBack"> ${window.UploadCareLocales?.actions.cancel_btn||"Cancel"} </button><lr-copyright></lr-copyright></lr-start-from><lr-upload-list></lr-upload-list><lr-camera-source></lr-camera-source><lr-url-source></lr-url-source><lr-external-source></lr-external-source><lr-mtn-accept-screen></lr-mtn-accept-screen><lr-cloud-image-editor-activity></lr-cloud-image-editor-activity><lr-end-screen></lr-end-screen></lr-modal><lr-progress-bar-common></lr-progress-bar-common><slot></slot>`;var Ze=class extends Ot{constructor(){super(...arguments);d(this,"pauseRender",!0)}shadowReadyCallback(){let t=this.ref.uBlock;this.sub("*currentActivity",i=>{i||(this.$["*currentActivity"]=t.initActivity||b.activities.START_FROM)}),this.sub("*uploadList",i=>{i?.length>0?this.$["*currentActivity"]=b.activities.UPLOAD_LIST:this.$["*currentActivity"]=t.initActivity||b.activities.START_FROM}),this.subConfigValue("sourceList",i=>{i!=="local"&&(this.cfg.sourceList="local")}),this.subConfigValue("confirmUpload",i=>{i!==!1&&(this.cfg.confirmUpload=!1)})}};Ze.template=`<lr-start-from><lr-drop-area clickable l10n="choose-file"></lr-drop-area><lr-copyright></lr-copyright></lr-start-from><lr-upload-list ref="uBlock"></lr-upload-list><lr-message-box></lr-message-box>`;var Je=class extends Ot{constructor(){super(),this.init$={...this.init$,couldCancel:!1,cancel:()=>{this.couldHistoryBack?this.$["*historyBack"]():this.couldShowList&&(this.$["*currentActivity"]=b.activities.UPLOAD_LIST)}}}get couldHistoryBack(){let e=this.$["*history"];return e.length>1&&e[e.length-1]!==b.activities.START_FROM}get couldShowList(){return this.cfg.showEmptyList||this.$["*uploadList"].length>0}shadowReadyCallback(){let e=this.ref.uBlock;this.sub("*currentActivity",t=>{t||(this.$["*currentActivity"]=e.initActivity||b.activities.START_FROM)}),this.sub("*uploadList",t=>{t?.length>0&&this.$["*currentActivity"]===(e.initActivity||b.activities.START_FROM)&&(this.$["*currentActivity"]=b.activities.UPLOAD_LIST)}),this.sub("*history",()=>{this.$.couldCancel=this.couldHistoryBack||this.couldShowList})}};Je.template=`<lr-start-from><lr-drop-area with-icon clickable></lr-drop-area><lr-source-list wrap></lr-source-list><button type="button" l10n="start-from-cancel" class="cancel-btn secondary-btn" set="onclick: cancel; @hidden: !couldCancel" ></button><lr-copyright></lr-copyright></lr-start-from><lr-upload-list ref="uBlock"></lr-upload-list><lr-camera-source></lr-camera-source><lr-url-source></lr-url-source><lr-external-source></lr-external-source><lr-message-box></lr-message-box><lr-progress-bar></lr-progress-bar><lr-cloud-image-editor-activity></lr-cloud-image-editor-activity>`;var $i=class extends Ke(et){shadowReadyCallback(){this.__shadowReady=!0,this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async initEditor(){this.__shadowReady&&await super.initEditor()}};function de(s){for(let e in s){let t=[...e].reduce((i,r)=>(r.toUpperCase()===r&&(r="-"+r.toLowerCase()),i+=r),"");t.startsWith("-")&&(t=t.replace("-","")),t.startsWith("lr-")||(t="lr-"+t),s[e].reg&&s[e].reg(t)}}var bs="LR";async function Zr(s,e=!1){return new Promise((t,i)=>{if(typeof document!="object"){t(null);return}if(typeof window=="object"&&window[bs]){t(window[bs]);return}let r=document.createElement("script");r.async=!0,r.src=s,r.onerror=()=>{i()},r.onload=()=>{let o=window[bs];e&&de(o),t(o)},document.head.appendChild(r)})}var Wf=import.meta.url,_s=window.CSS_PATH,ys=class{constructor(e){d(this,"config");d(this,"state");d(this,"uploader");d(this,"form");d(this,"btnsContainer");d(this,"imageBoxCarts");d(this,"quantityEl");d(this,"attrs");console.log("Constructor executed for "+e.key),console.log(window[`${e.key}`]),this.config={...window[`${e.key}`]},this.attrs=e,this.checkDefault(),this.state={},this.config.variant_id!==0&&(this.addUploaderBox(),this.uploader=document.querySelector(`.${e.uploader}`)||void 0,this.form=this.uploader?.closest('form[action="/cart/add"]')||void 0,this.uploader&&this.uploader.closest("product-info")?(this.quantityEl=this.uploader.closest("product-info")?.querySelector(".quantity__input")||document.querySelector(this.config.quantity_selector)||void 0,this.quantityWatcher()):(this.quantityEl=document.querySelector(this.config.quantity_selector),this.quantityEl&&this.quantityWatcher()),this.btnsContainer,this.imageBoxCarts=document.querySelectorAll(`.${e.imageBoxCart}`),this.state={atcBtns:"enabled"},this.downloadCss(()=>{this.addUploader(),this.onUpload(),this.initUploadCare(),console.log("here"),window.dispatchEvent(new Event("lr-file-uploader-loaded"))})),this.productFormWatcher(),this.updateCartPreviews()}hideFakeButton(){let e=document.querySelector(".pdp-uploadcare-uploader__placeholder");e&&(e.style.display="none")}addCartCss(){document.head.insertAdjacentHTML("beforeend",`<link typs="text/css" rel="stylesheet" href="${_s}">`)}removeBtnPlaceholder(){let e=document.querySelector(".pdp-uploadcare-uploader__placeholder");e&&e.remove()}checkDefault(){let e={pubkey:"",action:"",ctx_name:"lr-wgt-common",multiple_min:2,multiple_max:2,accent_color:"#ff0000",crop_preset:"1:1",atc_form_btns_selector:"",hide_atc_form_btns:!0,btn_width:"100%",btn_padding:"20px 30px 20px 30px !important",btn_margin:"10px 0 1em 0",btn_text_color:"#333333",btn_background:"#ffffff",btn_hover_background:"#909090",btn_border:"1px solid #000",btn_hover_border:"1px solid #000",btn_border_radius:"0px",btn_open_dialog_text:"Upload pictures",btn_atc_text:window.UploadCareLocales?.actions.add_to_cart_btn||"Add to cart",btn_out_of_stock_text:"Sold out",image_shape:"square",upload_images_messsage:"Please, upload pictures first",thumb_size:800,cart_items_selector:".cart-items",bind_btn_selector:"",atc_btns_selectors:"",variant_id:0,providers:"local, instagram, gphotos, url, camera, dropbox, gdrive, facebook"};Object.keys(e).forEach(t=>{this.config[t]=this.config[t]||e[t]}),this.config.providers.includes("local")||(this.config.providers+=", local"),window[this.attrs.key]={...this.config}}addUploaderBox(){let e=document.querySelector(this.config.atc_form_btns_selector),t=document.createElement("div");t.classList.add(this.attrs.uploader),e?.parentElement?.insertBefore(t,e)}hideAtcBtns(){let e=document.querySelector(this.config.atc_form_btns_selector);this.config.hide_atc_form_btns&&e&&(e.style.display="none")}downloadCss(e){let t=document.createElement("link");t.rel="stylesheet",t.href=_s,t.onload=()=>{this.hideAtcBtns(),e()},document.head.appendChild(t)}addUploader(){this.uploader.innerHTML=`<div class="uploadcare-wrapper"><div class="uploadcare-inner lr-wgt-common"><lr-config pubkey="${this.config.pubkey}" ctx-name="${this.config.ctx_name}" max-local-file-size-bytes="${ue}" img-only="true" multiple-max="${this.config.multiple_max}" multiple-min="${this.config.multiple_min}" useCloudImageEditor="true" cropPreset="${this.config.crop_preset}" thumbSize="${this.config.thumb_size}" removeCopyright="true" confirmUpload="false" debug="true" source-list="${this.config.providers}" ninemagskey="${this.config.ninemags_key}" ></lr-config><lr-file-uploader-regular ctx-name="${this.config.ctx_name}" css-src="${_s}" ></lr-file-uploader-regular><lr-upload-ctx-provider ctx-name="${this.config.ctx_name}"></lr-upload-ctx-provider><lr-data-output ctx-name="${this.config.ctx_name}" use-console use-input use-group use-event ></lr-data-output><div class="uploadcare-line-items"></div></div></div>`}quantityWatcher(){this.quantityEl&&this.quantityEl.addEventListener("change",()=>{window[this.attrs.key].quantity=this.quantityEl.value})}onUpload(){document.querySelectorAll("lr-data-output").forEach(t=>{let i=t.parentElement.querySelector(".uploadcare-line-items");t.addEventListener("lr-data-output",r=>{let o=r.detail?.data?.groupData,n=r.detail?.data?.files,a=[],l="",c={};if(n&&n.forEach(h=>{a.push(h.cdnUrl)}),o&&(l+=`<p class="line-item-property__field"><input id="__image_group" type="hidden" name="properties[_image_group]" value="${o.cdnUrl}"><input id="__image_group_id" type="hidden" name="properties[_image_group_id]" value="${o.uuid}"><input id="__image_previews" type="hidden" name="properties[_image_previews]" value='${JSON.stringify(a)}'></p>`,c={__image_group:o.cdnUrl,__image_group_id:o.uuid,__image_previews:JSON.stringify(a)},window.location.host==="heartprinted.com"&&(c._custom_image=o.cdnUrl,c._custom_image_group=o.uuid),i.innerHTML=l),window.location.host==="magnetmemories.shop"){let h=document.querySelectorAll('.product-ninemags .product-form input[type="radio"]');h?.length&&(c["Usage of Photo"]=Array.from(h)?.find(f=>f.checked)?.value)}let u=h=>{h&&(h.getAttribute("type")==="radio"?h.checked&&(c[h.getAttribute("name")||Date.now()]=h.value):c[h.getAttribute("name")||Date.now()]=h.value)};if(document.querySelectorAll('[js-data="ninemags-property"]').forEach(h=>{u(h)}),this.config.property_element_selectors)try{JSON.parse(this.config.property_element_selectors)?.forEach(h=>{let f=document.querySelector(h);u(f)})}catch{}window[this.attrs.key].lineItemsJson=c,o&&+this.config.multiple_min<=+o.filesCount&&+o.filesCount<=+this.config.multiple_max?this.toggleATCBtns(!0,t.closest('form[action="/cart/add"]')):this.toggleATCBtns(!1,t.closest('form[action="/cart/add"]'))})})}toggleATCBtns(e,t){this.config.hide_atc_form_btns&&t&&t.querySelectorAll(this.config.atc_btns_selectors)?.forEach(i=>{e?(this.state.atcBtns="enabled",i.removeAttribute("disabled"),this.btnsContainer.dispatchEvent(new Event("mouseover"))):(this.state.atcBtns="disabled",i.setAttribute("disabled","disabled"),i.style.display="none")})}productFormWatcher(){window.addEventListener("uploadcare:cart-update",e=>{this.updateCartPreviews()})}updateCartPreviews(){this.addCartCss(),document.querySelectorAll(".uploadcare-cart-previews").forEach(t=>{t.style.setProperty("--preview-image-display","none");let i="",r=JSON.parse(t.dataset.galPreviews);t.style.setProperty("--grid-side",Math.ceil(Math.sqrt(r.length))),r.forEach((o,n)=>{i+=`<img src='${o}-/resize/100x/' style="display: var(--preview-image-display);" loading="lazy" alt='Preview image #${n+1}' />`}),t.innerHTML=i})}initUploadCare(){let e=this.config.image_shape=="circle"?"50%":"0";Dt.shadowStyles=`
      :where(.lr-wgt-l10n_en-US, .lr-wgt-common),
      :host {
        --l10n-upload-files: '${this.config.btn_open_dialog_text}' !important;
        --l10n-btn_atc_text: '${this.config.btn_atc_text}' !important;
        --l10n-upload-disabled: '${this.config.available==="false"}' !important;
        --l10n-upload-disabled-text: '${this.config.btn_out_of_stock_text}' !important;
      }


      :where(.lr-wgt-l10n_en-US, .lr-wgt-common),
      :host {
        --l10n-files-count-limit-error-too-many: '${window.UploadCareLocales?.errors.limit_max_error||"You\u2019ve chosen too many files. {{max}} are maximum."}' !important;
        --l10n-drop-files-here:  '${window.UploadCareLocales?.actions.add_files_area||"Add files"}' !important;
        --l10n-file-type-not-allowed: '${window.UploadCareLocales?.errors.file_type_error||"Uploading of these file types is not allowed."}' !important;
        --l10n-file-size-limit-error: '${window.UploadCareLocales?.errors.file_size_over_error||"File size is over {{maxFileSize}}."}' !important;
        --l10n-files-max-size-limit-error: '${window.UploadCareLocales?.errors.file_size_limit_error||"One or more files are over {{maxFileSize}}. Please review uploaded images and replace."}' !important;
        --l10n-camera-permissions-denied: '${window.UploadCareLocales?.errors.camera_acces_error||"Camera access denied"}' !important;
         --l10n-cancel: '${window.UploadCareLocales?.editor?.cancel_btn||"Cancel"}' !important;
        --l10n-camera-permissions-prompt: '${window.UploadCareLocales?.text.camera_access||"Please allow access to the camera"}' !important;
        --l10n-camera-permissions-request: '${window.UploadCareLocales?.text.request_access||"Request access"}' !important;
        --l10n-upload-url: '${window.UploadCareLocales?.actions.import_btn||"Import"}' !important;
        --l10n-caption-from-url: '${window.UploadCareLocales?.text.import_from_link||"Import from link"}' !important;
      }

      :where(.lr-wgt-l10n_en-US, .lr-wgt-common),
      :host {
        --l10n-src-type-local: '${window.UploadCareLocales?.providers.from_device||"From device"}' !important;
        --l10n-src-type-from-url: '${window.UploadCareLocales?.providers.from_link||"From link"}' !important;
        --l10n-src-type-camera: '${window.UploadCareLocales?.providers.camera||"Camera"}' !important;
        --l10n-src-type-facebook: '${window.UploadCareLocales?.providers.facebook||"Facebook"}' !important;
        --l10n-src-type-dropbox: '${window.UploadCareLocales?.providers.dropbox||"Dropbox"}' !important;
        --l10n-src-type-gdrive: '${window.UploadCareLocales?.providers.google_drive||"Google Drive"}' !important;
        --l10n-src-type-gphotos: '${window.UploadCareLocales?.providers.google_photos||"Google Photos"}' !important;
        --l10n-src-type-instagram: '${window.UploadCareLocales?.providers.instagram||"Instagram"}' !important;
        --l10n-clear: '${window.UploadCareLocales?.actions.cancel_btn||"Clear"}' !important;
      }

      :host(.lr-cloud-image-editor),
      .lr-cloud-image-editor,
      :where(.lr-wgt-l10n_en-US, .lr-wgt-common),
      :host {
        --l10n-cancel: '${window.UploadCareLocales?.editor?.cancel_btn||"Cancel"}' !important;
        --l10n-apply: '${window.UploadCareLocales?.editor?.apply_btn||"Apply"}' !important;
        --l10n-brightness: '${window.UploadCareLocales?.editor?.brightness||"Brightness"}' !important;
        --l10n-exposure: '${window.UploadCareLocales?.editor?.exposure||"Exposure"}' !important;
        --l10n-gamma: '${window.UploadCareLocales?.editor?.gamma||"Gamma"}' !important;
        --l10n-contrast: '${window.UploadCareLocales?.editor?.contrast||"Contrast"}' !important;
        --l10n-saturation: '${window.UploadCareLocales?.editor?.saturation||"Saturation"}' !important;
        --l10n-vibrance: '${window.UploadCareLocales?.editor?.vibrance||"Vibrance"}' !important;
        --l10n-warmth: '${window.UploadCareLocales?.editor?.warmth||"Warmth"}' !important;
        --l10n-enhance: '${window.UploadCareLocales?.editor?.enhance||"Enhance"}' !important;
        --l10n-original: '${window.UploadCareLocales?.editor?.original||"Original"}' !important;
        --l10n-start-from-cancel: '${window.UploadCareLocales?.editor?.cancel_btn||"Cancel"}' !important;
      }


      :where(.lr-wgt-theme,.lr-wgt-common), :host {
        --darkmode: 0;
        --ctx-name: '${this.config.ctx_name}';
        --cfg-pubkey: '${this.config.pubkey}';
        --h-accent: ${vs(this.config.accent_color).h} !important;
        --s-accent: ${vs(this.config.accent_color).s}% !important;
        --l-accent: ${vs(this.config.accent_color).l}% !important;
        --image-shape-radius: ${e};
        --accept-message: "${JSON.stringify(this.config.accept_message)}";
        --btn-radius: ${this.config.buttons_radius}px;
      }

      :host lr-simple-btn.open-dialog button {
        letter-spacing: .1rem;
        padding-right: 0;
        width: ${this.config.btn_width};
        background: ${this.config.btn_background};
        padding: ${this.config.btn_padding};
        margin: ${this.config.btn_margin};
        border: ${this.config.btn_border};
        border-radius: ${this.config.btn_border_radius};
        color: ${this.config.btn_text_color};
      }

      :host lr-file-item .thumb {
        aspect-ratio: ${this.config.crop_preset.split(":")[0]} / ${this.config.crop_preset.split(":")[1]};
      }

      :host lr-simple-btn button:hover {
        background: ${this.config.btn_hover_background};
        border: ${this.config.btn_hover_border};
      }

      lr-simple-btn {
        width: ${this.config.btn_width};
      }

      :host {
        --lr-providers-grid-columns: ${this.config.providers.split(",").length===5?2:this.config.providers.split(",").length<4?this.config.providers.split(",").length-1:this.config.providers.split(",").length-1>6?4:3};
      }
      `,de(gs),this.hideFakeButton()}};function vs(s){let e=0,t=0,i=0;s.length==4?(e=`0x${s[1]}${s[1]}`,t=`0x${s[2]}${s[2]}`,i=`0x${s[3]}${s[3]}`):s.length==7&&(e=`0x${s[1]}${s[2]}`,t=`0x${s[3]}${s[4]}`,i=`0x${s[5]}${s[6]}`),e/=255,t/=255,i/=255;let r=Math.min(e,t,i),o=Math.max(e,t,i),n=o-r,a=0,l=0,c=0;return n==0?a=0:o==e?a=(t-i)/n%6:o==t?a=(i-e)/n+2:a=(e-t)/n+4,a=Math.round(a*60),a<0&&(a+=360),c=(o+r)/2,l=n==0?0:n/(1-Math.abs(2*c-1)),l=+(l*100).toFixed(1),c=+(c*100).toFixed(1),{h:a,s:l,l:c}}window.MTN_CLASS=ys;export{b as ActivityBlock,Ri as ActivityHeader,kt as BaseComponent,_ as Block,Le as CameraSource,$i as CloudImageEditor,ki as CloudImageEditorActivity,et as CloudImageEditorBlock,wr as Config,Ie as ConfirmationDialog,We as Copyright,Ue as CropFrame,w as Data,fs as DataOutput,Yt as DropArea,se as EditorCropButtonControl,Mt as EditorFilterControl,Fe as EditorImageCropper,Si as EditorImageFader,re as EditorOperationControl,Be as EditorScroller,De as EditorSlider,Ve as EditorToolbar,xe as EndScreen,Xe as ExternalSource,Jt as FileItem,ie as FilePreview,Je as FileUploaderInline,Ze as FileUploaderMinimal,Dt as FileUploaderRegular,Xt as Icon,Ti as Img,ze as LineLoaderUi,ne as LrBtnUi,Te as MessageBox,te as Modal,Ye as MtnAcceptScreen,qe as MtnFileItem,is as PACKAGE_NAME,ss as PACKAGE_VERSION,He as PresenceToggle,$e as ProgressBar,Re as ProgressBarCommon,je as Select,ce as ShadowWrapper,Wt as SimpleBtn,Ge as SliderUi,Zt as SourceBtn,Oi as SourceList,Ae as StartFrom,ae as Tabs,Mr as UploadCtxProvider,ke as UploadDetails,Oe as UploadList,E as UploaderBlock,Se as UrlSource,le as Video,Zr as connectBlocksFrom,de as registerBlocks,Ke as shadowed,rt as toKebabCase};
